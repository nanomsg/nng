---
version: tip
layout: manpage_v2
title: nng_opts_parse(3supp)
---
<h1>nng_opts_parse(3supp)</h1>
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.21">
<title>nng_opts_parse(3supp)</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<link rel="stylesheet" href="./asciidoctor.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="./rouge-github.css">
</head>
<body class="article">
<div id="header">
<h1>nng_opts_parse(3supp)</h1>
</div>
<div id="content">
<div class="sect1">
<h2 id="_name">NAME</h2>
<div class="sectionbody">
<div class="paragraph">
<p>nng_opts_parse - parse command line options</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_synopsis">SYNOPSIS</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c"><span class="cp">#include</span> <span class="cpf">&lt;nng/nng.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;nng/supplemental/util/options.h&gt;</span><span class="cp">
</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">nng_optspec</span> <span class="p">{</span>
    <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">o_name</span><span class="p">;</span>  <span class="c1">// Long style name (may be NULL for short only)</span>
    <span class="kt">int</span>         <span class="n">o_short</span><span class="p">;</span> <span class="c1">// Short option (no clustering!)</span>
    <span class="kt">int</span>         <span class="n">o_val</span><span class="p">;</span>   <span class="c1">// Value stored on a good parse (&gt;0)</span>
    <span class="n">bool</span>        <span class="n">o_arg</span><span class="p">;</span>   <span class="c1">// Option takes an argument if true</span>
<span class="p">}</span> <span class="n">nng_optspec</span><span class="p">;</span>

<span class="kt">int</span> <span class="nf">nng_opts_parse</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="k">const</span> <span class="o">*</span><span class="n">argv</span><span class="p">,</span> <span class="k">const</span> <span class="n">nng_optspec</span> <span class="o">*</span><span class="n">spec</span><span class="p">,</span> <span class="kt">int</span> <span class="o">*</span><span class="n">val</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">arg</span><span class="p">,</span> <span class="kt">int</span> <span class="o">*</span><span class="n">idx</span><span class="p">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_description">DESCRIPTION</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>nng_opts_parse()</code> is function is a supplemental function intended to
facilitate parsing command line arguments.
This function exists largely to stand in for <code>getopt()</code> from POSIX
systems, but it is available everywhere that <em>NNG</em> is, and it includes
some capabilities missing from <code>getopt()</code>.</p>
</div>
<div class="paragraph">
<p>The function parses arguments from <code>main()</code> (using <em>argc</em> and <em>argv</em>),
starting at the index referenced by <em>idx</em>.
(New invocations typically set the value pointed to by <em>idx</em> to 1.)</p>
</div>
<div class="paragraph">
<p>Options are parsed as specified by <em>spec</em> (see <a href="#_option_specification">Option Specification</a>.)
The value of the parsed option will be stored at the address indicated by
<em>val</em>, and the value of <em>idx</em> will be incremented to reflect the next
option to parse.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
For using this to parse command-line like strings that do not include
the command name itself, set the value referenced by <em>idx</em> to zero
instead of one.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If the option had an argument, a pointer to that is returned at the address
referenced by <em>arg</em>.</p>
</div>
<div class="paragraph">
<p>This function should be called repeatedly, until it returns either -1
(indicating the end of options is reached) or a non-zero error code is
returned.</p>
</div>
<div class="sect2">
<h3 id="_option_specification">Option Specification</h3>
<div class="paragraph">
<p>The calling program must first create an array of <code>nng_optspec</code> structures
describing the options to be supported.
This structure has the following members:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>o_name</code></dt>
<dd>
<p>The long style name for the option, such as "verbose".
This will be parsed on the command line when it is prefixed with two dashes.
It may be <code>NULL</code> if only a short option is to be supported.</p>
</dd>
<dt class="hdlist1"><code>o_short</code></dt>
<dd>
<p>This is a single letter (at present only ASCII letters are supported).
These options appear as just a single letter, and are prefixed with a single dash on the command line.
The use of a slash in lieu of the dash is <em>not</em> supported, in order to avoid confusion with path name arguments.
This value may be set to 0 if no short option is needed.</p>
</dd>
<dt class="hdlist1"><code>o_val</code></dt>
<dd>
<p>This is a numeric value that is unique to this option.
This value is assigned by the application program, and must be non-zero
for a valid option.
If this is zero, then it indicates the end of the specifications, and the
rest of this structure is ignored.
The value will be returned to the caller in <em>val</em> by <code>nng_opts_parse()</code> when
this option is parsed from the command line.</p>
</dd>
<dt class="hdlist1"><code>o_arg</code></dt>
<dd>
<p>This value should be set to <code>true</code> if the option should take an argument.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="_long_options">Long Options</h3>
<div class="paragraph">
<p>Long options are parsed from the <em>argv</em> array, and are indicated when
the element being scanned starts with two dashes.
For example, the "verbose" option would be specified as <code>--verbose</code> on
the command line.
If a long option takes an argument, it can either immediately follow
the option as the next element in <em>argv</em>, or it can be appended to
the option, separated from the option by an equals sign (<code>=</code>) or a
colon (<code>:</code>).</p>
</div>
</div>
<div class="sect2">
<h3 id="_short_options">Short Options</h3>
<div class="paragraph">
<p>Short options appear by themselves in an <em>argv</em> element, prefixed by a
dash (<code>-</code>).
If the short option takes an argument, it can either be appended in the
same element of <em>argv</em>, or may appear in the next <em>argv</em> element.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Option clustering, where multiple options can be crammed together in
a single <em>argv</em> element, is not supported by this function (yet).
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_prefix_matching">Prefix Matching</h3>
<div class="paragraph">
<p>When using long options, the parser will match if it is equal to a prefix
of the <code>o_name</code> member of a option specification, provided that it do so
unambiguously (meaning it must not match any other option specification.)</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_example">EXAMPLE</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following program fragment demonstrates this function.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c">    <span class="k">enum</span> <span class="p">{</span> <span class="n">OPT_LOGFILE</span><span class="p">,</span> <span class="n">OPT_VERBOSE</span> <span class="p">};</span>
    <span class="kt">char</span> <span class="o">*</span><span class="n">logfile</span><span class="p">;</span> <span class="c1">// options to be set</span>
    <span class="n">bool</span> <span class="n">verbose</span><span class="p">;</span>

    <span class="k">static</span> <span class="n">nng_optspec</span> <span class="n">specs</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="p">{</span>
            <span class="p">.</span><span class="n">o_name</span> <span class="o">=</span> <span class="s">"logfile"</span><span class="p">,</span>
            <span class="p">.</span><span class="n">o_short</span> <span class="o">=</span> <span class="sc">'D'</span><span class="p">,</span>
            <span class="p">.</span><span class="n">o_val</span> <span class="o">=</span> <span class="n">OPT_LOGFILE</span><span class="p">,</span>
            <span class="p">.</span><span class="n">o_arg</span> <span class="o">=</span> <span class="nb">true</span><span class="p">,</span>
        <span class="p">},</span> <span class="p">{</span>
            <span class="p">.</span><span class="n">o_name</span> <span class="o">=</span> <span class="s">"verbose"</span><span class="p">,</span>
            <span class="p">.</span><span class="n">o_short</span> <span class="o">=</span> <span class="sc">'V'</span><span class="p">,</span>
            <span class="p">.</span><span class="n">o_val</span> <span class="o">=</span> <span class="n">OPT_VERBOSE</span><span class="p">,</span>
            <span class="p">.</span><span class="n">o_arg</span> <span class="o">=</span> <span class="nb">false</span><span class="p">,</span>
        <span class="p">},</span> <span class="p">{</span>
            <span class="p">.</span><span class="n">o_val</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">// Terminate array</span>
        <span class="p">}</span>
    <span class="p">};</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">idx</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;;)</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">rv</span><span class="p">,</span> <span class="n">opt</span><span class="p">;</span>
        <span class="kt">char</span> <span class="o">*</span><span class="n">arg</span><span class="p">;</span>
        <span class="n">rv</span> <span class="o">=</span> <span class="n">nng_opts_parse</span><span class="p">(</span><span class="n">argc</span><span class="p">,</span> <span class="n">argv</span><span class="p">,</span> <span class="n">specs</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">opt</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">arg</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">idx</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">rv</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">switch</span> <span class="p">(</span><span class="n">opt</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">case</span> <span class="n">OPT_LOGFILE</span><span class="p">:</span>
            <span class="n">logfile</span> <span class="o">=</span> <span class="n">arg</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="n">OPT_VERBOSE</span><span class="p">:</span>
            <span class="n">verbose</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">rv</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"Options error: %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">nng_strerror</span><span class="p">(</span><span class="n">rv</span><span class="p">));</span>
        <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_return_values">RETURN VALUES</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This function returns 0 if an option parsed correctly, -1 if
no more options are available to be parsed, or an error number otherwise.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_errors">ERRORS</h2>
<div class="sectionbody">
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<code>NNG_EAMBIGUOUS</code>
</td>
<td class="hdlist2">
<p>Parsed option matches more than one specification.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>NNG_ENOARG</code>
</td>
<td class="hdlist2">
<p>Option requires an argument, but one is not present.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>NNG_EINVAL</code>
</td>
<td class="hdlist2">
<p>An invalid (unknown) argument is present.</p>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_see_also">SEE ALSO</h2>
<div class="sectionbody">
<div class="paragraph text-left">
<p><a href="nng_strerror.3.html">nng_strerror(3)</a>,
<a href="nng.7.html">nng(7)</a></p>
</div>
</div>
</div>
</div>
</body>
</html>
