<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>NNG Reference Manual (DRAFT)</title>
        <meta name="robots" content="noindex">


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="theme/pagetoc.css">


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "searchindex.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">NNG Reference Manual (DRAFT)</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <i class="fa fa-spinner fa-spin"></i>
                            </div>
                        </div>
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<svg class="right" width="50px" fill="currentColor" height="50px" viewBox="0 0 177 177" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:1.41421;">
<g transform="matrix(1,0,0,1,-70.1035,-169.345)">
<g id="path3747" transform="matrix(1,0,0,1,15.3535,24.2051)">
<path d="M143.25,145.14C192.094,145.14 231.75,184.795 231.75,233.64C231.75,282.484 192.094,322.14 143.25,322.14C94.405,322.14 54.75,282.484 54.75,233.64C54.75,184.795 94.405,145.14 143.25,145.14ZM171.502,287.978C177.304,288.006 183.141,288.681 188.202,291.626C190.127,292.746 189.414,296.365 186.067,294.446C183.368,292.916 180.298,292.15 177.258,291.739C168.585,290.564 151.97,293.04 137.146,295.307C125.365,297.091 113.273,299.265 101.915,296.699C101.915,296.699 100.47,296.31 100.338,295.132C99.991,292.046 106.736,294.239 112.527,294.253C131.669,294.299 150.562,288.293 170.005,287.986C170.504,287.98 171.003,287.977 171.502,287.978ZM173.055,273.796C183.495,273.866 194.089,276.36 202.377,282.618C203.541,283.497 204.02,285.771 201.921,286.045C200.654,286.211 199.185,284.585 197.712,283.652C185.78,276.093 170.106,276.725 156.729,278.604C136.741,281.411 116.471,287.036 97.663,283.098C92.381,281.992 87.228,280.083 82.59,277.395C81.358,276.68 81.01,274.528 82.809,274.054C84.097,273.715 85.82,275.217 87.488,276.016C103.055,283.469 121.855,280.855 138.032,278.128C149.644,276.153 161.265,273.787 173.055,273.796ZM88.862,261.291C83.181,267.107 159.272,267.634 177.99,263.832L193.198,260.141C181.182,259.267 102.749,255.867 88.862,261.291ZM125.643,163.201C125.444,228.641 119.731,223.713 105.672,257.662C107.609,257.624 142.421,246.015 204.879,259.387C187.552,223.36 161.846,190.044 125.643,163.201ZM108.825,170.917C108.786,170.769 108.746,170.621 108.705,170.472C108.705,170.719 108.725,170.842 108.825,170.917C116.941,201.681 94.564,232.842 84.031,247.129C93.03,245.261 102.361,243.719 108.047,244.497C121.595,221.639 121.561,197.981 122.852,177.052C111.676,170.509 109.308,171.279 108.825,170.917Z"/>
</g>
</g>
</svg>
<p>Copyright © 2025 Staysail Systems, Inc.<br />
San Marcos, California, United States of America</p>
<blockquote>
<p>If you find this book or NNG useful, please consider sponsoring
the project.</p>
</blockquote>
<div class="mdbook-alerts mdbook-alerts-tip">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  tip
</p>
<p>This book is a work in progress, adapted from earlier sources
and updated for the current version of NNG.</p>
</div>
<div class="mdbook-alerts mdbook-alerts-note">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  note
</p>
<blockquote>
<p>This document is supplied under the terms of the MIT License, a
copy of which should be located in the distribution where this
file was obtained (LICENSE.txt), and reproduced below.</p>
</blockquote>
<blockquote>
<p>Third party contributions to this document were made under the
same license terms, and may be covered under one of the following
copyrights:</p>
<ul>
<li>Copyright 2018 Capitar IT Group BV.</li>
<li>Copyright 2019 Devolutions.</li>
<li>Copyright 2020 Dirac Research.</li>
</ul>
</blockquote>
</div>
<h2 id="the-mit-license"><a class="header" href="#the-mit-license">The MIT License</a></h2>
<p>Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the “Software”),
to deal in the Software without restriction, including without limitation
the rights to use, copy, modify, merge, publish, distribute, sublicense,
and/or sell copies of the Software, and to permit persons to whom
the Software is furnished to do so, subject to the following conditions:</p>
<p>The above copyright notice and this permission notice shall be included
in all copies or substantial portions of the Software.</p>
<p>THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL
THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
IN THE SOFTWARE.</p>
<div style="break-before: page; page-break-before: always;"></div><style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="dedication"><a class="header" href="#dedication">Dedication</a></h1>
<p>— <em>For Jenichka</em></p>
<p><em>The sun always shines when you are home.</em></p>
<div style="break-before: page; page-break-before: always;"></div><style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="preface"><a class="header" href="#preface">Preface</a></h1>
<div class="mdbook-alerts mdbook-alerts-important">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  important
</p>
<p>This is a <em>DRAFT</em> version of this reference manual,
and much is still in progress. There may be errors,
and large omissions as content is still be moved from
the previous ASCIIDOCTOR format and updated for NNG 2.0.</p>
</div>
<h2 id="preface-for-the-first-edition"><a class="header" href="#preface-for-the-first-edition">Preface for the First Edition</a></h2>
<p>At the time of this writing, we are wrapping up NNG for its formal
1.0.0 release.
It’s a good time for reflection on the road that we took to get here.
Like the road on the cover of this book, it was windy (if quite a bit longer),
but what we find at the end has made the journey worthwhile.</p>
<p>Originally the NNG project was conceived as a relatively modest effort
to rewrite nanomsg based on threads, with a more readily extensible
internal architecture so that we could more easily undertake projects like the
ZeroTier and TLS transports.</p>
<p>It would not be incorrect to say that the initial NNG effort was started
in “anger”, as we were frustrated with nanomsg’s very complex internal
state machines.
Looking back on it now, those complex state state machines don’t seem nearly
as insane as they did just a year ago.</p>
<p>The simple, naïve, approach we would have preferred, and the one we
originally started with, involved significant use of threads, inspired by the
work we did in mangos, which uses Go’s goroutines heavily.
Goroutines are excellent.
Threads, it turns out, are not.
Scalable, asynchronous, <em>portable</em> I/O is a lot harder than it looks.</p>
<blockquote>
<p>Our experience with in-kernel threads on illumos and Solaris
spoiled us, and left us utterly unprepared for cesspool that really is
large amounts of userspace programming.</p>
</blockquote>
<p>Instead, we have created our own, completely asynchronous core, giving
us advanced multiprocessing and concurrency capabilities, without either
sacrificing portability or settling for some unhappy least common denominator.
This core is a robust foundation for NNG and handling the
“Scalability Protocols”, but if we’re being completely honest, we think this
core has braod applicability for beyond just the Scalability Protocols.
It will be interesting to see if others come to the same conclusion.</p>
<p>Builting upon this robust foundation, we have engineered a substantial
project, with capabilities far in exceess of the original nanomsg, while
still preserving compatibility with the the network protocols that
form the backbone of the nanomsg ecosystem,
and even a compatible programming interface for nanomsg library users.
In addition to compatibility with nanomsg, we find that NNG has greatly
increased scalability, reliability, and usability (especially when developing
concurrent applications).</p>
<p>NNG also has complete HTTP server and client
implementations, support for TLS, and a plethora of other capabilities.
Much of this is made possible by a the aforementioned asynchronous I/O
framework.</p>
<p>We’ve tried to stay true to the core nanomsg goals about being light-weight,
liberally licensed, and implemented in C.
(After all, those were the things that drew us to nanomsg in the first place!)
In addition we added a couple of new ones.
Specifically, reliability, performance, and extensibility (in that order)
were added as core goals for the project.</p>
<p>We believe that NNG represents a substantial step forward over other
messaging frameworks, and have enjoyed creating it.
We hope you find it useful.
There is still a lot more we want to do, and future release of NNG
will continue to expand it’s capabilities.
We’re just getting started.</p>
<p><strong>— Garrett D’Amore</strong>, May 30, 2018</p>
<h2 id="acknowledgements"><a class="header" href="#acknowledgements">Acknowledgements</a></h2>
<p>We would like to thank Janjaap Bos, at Capitar IT Group BV.
Without his patronage, neither NNG nor this book would be possible.</p>
<p>We would also like thank Martin Sústrik for creating the original
nanomsg project, the foundation upon which all of this work is based.</p>
<p>And certainly not least of all, we would like to thank the various
members of the community who have followed
and supported the NNG project in so many different ways.</p>
<h3 id="conventions"><a class="header" href="#conventions">Conventions</a></h3>
<p>Throughout this book there are occasional warnings, notices, and tips.
These are visually distinguished as follows:</p>
<div class="mdbook-alerts mdbook-alerts-tip">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  tip
</p>
<p>Tips are things that the reader may find useful, such as suggestions
for use or tim saving hints.</p>
</div>
<div class="mdbook-alerts mdbook-alerts-note">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  note
</p>
<p>Notes are things that the reader should be aware of, and provide
additional information or context that may aid in the understanding
or use of the topic.</p>
</div>
<div class="mdbook-alerts mdbook-alerts-important">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  important
</p>
<p>Warnings are used to denote important cautionary advice,
which should be carefully heeded.
Ignoring such advice may lead to crashses, unexpected behavior,
loss of revenue, or other undesirable conditions.</p>
</div>
<div style="break-before: page; page-break-before: always;"></div><style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="api-reference"><a class="header" href="#api-reference">API Reference</a></h1>
<p>This section is a reference guide for the <em>NNG</em> programming interfaces.
It is meant to serve as a reference, rather than as a tutorial.</p>
<p>The material here is organized by major areas of functionality.</p>
<p>Note that unless indicated otherwise, consumers of these interfaces must
include the <code>nng/nng.h</code> header file like so:</p>
<pre><code class="language-c">#include &lt;nng/nng.h&gt;
</code></pre>
<h2 id="sections"><a class="header" href="#sections">Sections</a></h2>
<ul>
<li><a href="api/init.html">Initialization</a></li>
<li><a href="api/msg.html">Messages</a></li>
<li><a href="api/sock.html">Sockets</a></li>
<li><a href="api/ctx.html">Contexts</a></li>
<li><a href="api/pipe.html">Pipes</a></li>
<li><a href="api/memory.html">Memory</a></li>
<li><a href="api/time.html">Time</a></li>
<li><a href="api/url.html">URLs</a></li>
<li><a href="api/synch.html">Synchronization</a></li>
<li><a href="api/thr.html">Threads</a></li>
<li><a href="api/logging.html">Logging</a></li>
<li><a href="api/stats.html">Statistics</a></li>
<li><a href="api/http.html">HTTP</a></li>
<li><a href="api/misc.html">Miscellaneous</a></li>
<li><a href="api/errors.html">Errors</a></li>
<li><a href="api/id_map.html">ID Map</a></li>
<li><a href="api/cmd_opts.html">Command Options</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="initialization--finalization"><a class="header" href="#initialization--finalization">Initialization &amp; Finalization</a></h1>
<p>This chapter details the function used to initialize
the library before first use, and the function used to
finalize the library and deallocate any resources used by the library.</p>
<h2 id="initialization"><a class="header" href="#initialization">Initialization</a></h2>
<pre><code class="language-c">typedef struct {
    int16_t num_task_threads;
    int16_t max_task_threads;
    int16_t num_expire_threads;
    int16_t max_expire_threads;
    int16_t num_poller_threads;
    int16_t max_poller_threads;
    int16_t num_resolver_threads;
} nng_init_params;

extern nng_err nng_init(nng_init_params *params);
</code></pre>
<p>Before using other interfaces in this library, it is necessary to initialize
the library. The <a name="a001"></a><code>nng_init</code> function performs this initialization.</p>
<p>The function is idempotent, although on tear down, every call to <code>nng_init</code> must
be paired with a call to <a href="api//api/init.html#finalization"><code>nng_fini</code></a> or no resources will be released.
This allows for libraries consuming these interfaces to safely initialize and finalize
the library without disrupting other consumers in the same process.</p>
<p>Further, only the first call to this function may have a value of <em>params</em> other than <code>NULL</code>.
If <em>params</em> is not <code>NULL</code>, and the library has already been intiazed, then <code>nng_init</code> will
return <a href="api//api/errors.html#NNG_EBUSY"><code>NNG_EBUSY</code></a>.</p>
<p>In some cases it is desirable to tune certain runtime parameters for the library, which
can be done by supplying a non-<code>NULL</code> <em>params</em> argument.</p>
<h3 id="parameters"><a class="header" href="#parameters">Parameters</a></h3>
<p>The individual fields of the <code>nng_init_params</code> structure can be used to adjust certain
runtime tunables for the library. There is no guarantee that these tunables are implemented,
and applications should not depend upon them for correct operation.</p>
<p>Any member of <code>nng_init_params</code> that is set to zero will be ignored, and any built in default
will be used instead for that value.</p>
<div class="mdbook-alerts mdbook-alerts-note">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  note
</p>
<p>Applications should make sure that structure is zero initialized before calling <code>nng_init</code>.</p>
</div>
<p>The following parameters are present:</p>
<ul>
<li>
<p><code>num_task_threads</code> and <code>max_task_threads</code> <br />
Configures the number of threads to use for tasks, which are used principally for completion
callbacks. The maximum value can be used to provide an upper limit while still allowing
for a dynamically calculated value to be used, as long as it does not exceed the maximum.</p>
</li>
<li>
<p><code>num_expire_threads</code> and <code>max_expire_threads</code> <br />
Configures the number of threads used for expiring operations. Using a larger value will
reduce contention on some common locks, and may improve performance.</p>
</li>
<li>
<p><code>num_poller_threads</code> and <code>max_poller_threads</code> <br />
Configures the number of threads to be used for performing I/O. Not all configurations support
changing these values.</p>
</li>
<li>
<p><code>num_resolver_threads</code> <br />
Changes the number of threads used for asynchronous DNS look ups.</p>
</li>
</ul>
<h2 id="finalization"><a class="header" href="#finalization">Finalization</a></h2>
<pre><code class="language-c">extern void nng_fini(void);
</code></pre>
<p>When the consumer is ready to deallocate any resources allocated by the library, it should call
the <a name="a002"></a><code>nng_fini</code> function. Each call to <code>nng_fini</code> should be paired with an earlier call to
<a href="api//api/init.html#initialization"><code>nng_init</code></a>.</p>
<p>After calling <code>nng_fini</code>, the consuming application must not make any other calls to NNG functions,
except that it may use <code>nng_init</code> to initialize the application for further use.</p>
<!-- Symbol cross reference -->
<!-- HTTP -->
<!-- Macros -->
<!-- Protocols -->
<!-- Transports -->
<!-- Concept index -->
<div style="break-before: page; page-break-before: always;"></div><style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="messages"><a class="header" href="#messages">Messages</a></h1>
<p>Messages <a name="a001"></a> in Scalability Protocols are the fundamental unit of
transmission and reception, as these protocols are fundamentally message-oriented.</p>
<p>Messages have a <a href="api//api/msg.html#message-body">body</a><a name="a002"></a>, containing the application-supplied
payload, and a <a href="api//api/msg.html#message-header">header</a><a name="a003"></a>, containing protocol specific routing and similar
related information.</p>
<div class="mdbook-alerts mdbook-alerts-tip">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  tip
</p>
<p>Only applications using <a href="api//api/sock.html#raw-mode-sockets">raw mode</a> need to access the message header.
Very few <em>NNG</em> applications do this.</p>
</div>
<h2 id="message-structure"><a class="header" href="#message-structure">Message Structure</a></h2>
<pre><code class="language-c">typedef struct nng_msg nng_msg;
</code></pre>
<p>The <a name="a004"></a><code>nng_msg</code> structure represents a single message. It carries a body
and a header.</p>
<h3 id="create-a-message"><a class="header" href="#create-a-message">Create a Message</a></h3>
<pre><code class="language-c">int nng_msg_alloc(nng_msg **msgp, size_t size);
</code></pre>
<p>The <a name="a005"></a><code>nng_msg_alloc</code> function allocates a new message.
It takes a <em>size</em> argument, and returns a message
with a preallocated body of that size in the <em>msgp</em> parameter.</p>
<p>If it succeeds, it returns zero, otherwise this function may return <a href="api//api/errors.html#NNG_ENOMEM"><code>NNG_ENOMEM</code></a>,
indicating that insufficient memory is available to allocate a new message.</p>
<h3 id="destroy-a-message"><a class="header" href="#destroy-a-message">Destroy a Message</a></h3>
<pre><code class="language-c">void nng_msg_free(nng_msg *msg);
</code></pre>
<p>The <a name="a006"></a><code>nng_msg_free</code> function deallocates a message.</p>
<h3 id="duplicate-a-message"><a class="header" href="#duplicate-a-message">Duplicate a Message</a></h3>
<pre><code class="language-c">int nng_msg_dup(nng_msg **dup, nng_msg *msg);
</code></pre>
<p>The <a name="a007"></a><code>nng_msg_dup</code> function duplicates the message <em>msg</em>, storing a pointer
to the new duplicate in <em>dup</em>. This function also returns zero on success, or <a href="api//api/errors.html#NNG_ENOMEM"><code>NNG_ENOMEM</code></a>
if memory is exhausted.</p>
<h2 id="message-size-and-capacity"><a class="header" href="#message-size-and-capacity">Message Size and Capacity</a></h2>
<pre><code class="language-c">size_t nng_msg_capacity(nng_msg *msg);
int nng_msg_realloc(nng_msg *msg, size_t size);
int nng_msg_reserve(nng_msg *msg, size_t capacity);
</code></pre>
<p>Messages have a certain amount of pre-reserved space, which may exceed the total
size of the message. This allows for content to be added to the message later,
without necessarily performing a reallocation.</p>
<p>The <a name="a008"></a><code>nng_msg_capacity</code> function returns the amount of prereserved space.
If a message size change is required, and the new size will fit within the capacity
reported by this function, then change will be done without a reallocation, and
likely without a data copy as well.</p>
<div class="mdbook-alerts mdbook-alerts-tip">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  tip
</p>
<p>The capacity reported by <code>nng_msg_capacity</code> may not include reserved headroom, which
is present to allow a very limited amount of content to be inserted in front of the
message without requiring the rest of the message to be copied.</p>
</div>
<p>The message size may be changed by use of the <a name="a009"></a><code>nng_msg_realloc</code> function. This
function will reallocate the underlying memory for the message <em>msg</em>,
preserving contents while doing so.
If the new size is smaller than the original message, it will
truncate the message, but not perform any allocations.
If reallocation fails due to insufficient memory, then the original is left intact.</p>
<p>The <a name="a010"></a><code>nng_msg_reserve</code> function ensures that the total message capacity
is at least <em>capacity</em> bytes. Use of this function to ensure the total anticipated
capacity is present in the message may help prevent many small allocations.</p>
<p>Both <code>nng_msg_realloc</code> and <code>nng_msg_reserve</code> return zero on success, or may return
<a href="api//api/errors.html#NNG_ENOMEM"><code>NNG_ENOMEM</code></a> if insufficient memory exists to preform allocation.</p>
<div class="mdbook-alerts mdbook-alerts-important">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  important
</p>
<p>Any pointers to message content obtained before a call to <code>nng_msg_realloc</code> or
<code>nng_msg_reserve</code> (or any other function that changes the message size) should be
treated as invalid, as the locations pointed to may be deallocated by these functions.</p>
</div>
<h2 id="message-body"><a class="header" href="#message-body">Message Body</a></h2>
<pre><code class="language-c">void *nng_msg_body(nng_msg *msg);
size_t nng_msg_len(nng_msg *msg);
</code></pre>
<p>The body and body length of <em>msg</em> are returned by <a name="a011"></a><code>nng_msg_body</code> and
<a name="a012"></a><code>nng_msg_len</code>, respectively.</p>
<h3 id="clear-the-body"><a class="header" href="#clear-the-body">Clear the Body</a></h3>
<pre><code class="language-c">void *nng_msg_clear(nng_msg *msg);
</code></pre>
<p>The <a name="a013"></a><code>nng_msg_clear</code> simply resets the total message body length to zero, but does
not affect the capacity. It does not change the underlying bytes of the message.</p>
<h3 id="add-to-body"><a class="header" href="#add-to-body">Add to Body</a></h3>
<pre><code class="language-c">int nng_msg_append(nng_msg *msg, const void *val, size_t size);
int nng_msg_append_u16(nng_msg *msg, uint16_t val16);
int nng_msg_append_u32(nng_msg *msg, uint32_t val32);
int nng_msg_append_u64(nng_msg *msg, uint64_t val64);

int nng_msg_insert(nng_msg *msg, const void *val, size_t size);
int nng_msg_insert_u16(nng_msg *msg, uint16_t val16);
int nng_msg_insert_u32(nng_msg *msg, uint32_t val32);
int nng_msg_insert_u64(nng_msg *msg, uint64_t val64);
</code></pre>
<p>Appending data to a message body is done by using the <a name="a014"></a><code>nng_msg_append</code> functions.
The base <code>nng_msg_append</code> function appends <em>size</em> bytes of untyped data to the end of the
message.</p>
<p>Use of the typed versions, ending in suffixes <code>_u16</code>, <code>_u32</code>, and <code>_u64</code> allows
for unsigned integers to be appended directly. The integers are encoded in network byte order, with
the most significant byte appearing first. The message body will by two, four, or eight
bytes accordingly.</p>
<p>Data may inserted before the rest of the message body by using the <a name="a015"></a><code>nng_msg_insert</code> functions.
This will attempt to use “headroom” in the message to avoid a data copy.
Otherwise they are like the <code>nng_msg_append</code> functions except that the put the data in front
of the messages instead of at the end.</p>
<div class="mdbook-alerts mdbook-alerts-tip">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  tip
</p>
<p>Message headroom is limited, so <code>nng_msg_insert</code> is best used sparingly.
It is much more efficient to build the message content from start to end
using <code>nng_msg_append</code>.</p>
</div>
<h3 id="consume-from-body"><a class="header" href="#consume-from-body">Consume From Body</a></h3>
<pre><code class="language-c">int nng_msg_chop(nng_msg *msg, size_t size);
int nng_msg_chop_u16(nng_msg *msg, uint16_t *val16);
int nng_msg_chop_u32(nng_msg *msg, uint32_t *val32);
int nng_msg_chop_u64(nng_msg *msg, uint64_t *val64);

int nng_msg_trim(nng_msg *msg, size_t size);
int nng_msg_trim_u16(nng_msg *msg, uint16_t *val16);
int nng_msg_trim_u32(nng_msg *msg, uint32_t *val32);
int nng_msg_trim_u64(nng_msg *msg, uint64_t *val64);
</code></pre>
<p>The <a name="a016"></a><code>nng_msg_chop</code> functions remove data from the end of the body of message <em>msg</em>,
reducing the message length by either <em>size</em>, or the appropriate value size.</p>
<p>The <a name="a017"></a><code>nng_msg_trim</code> functions remove data from the beginning of the message body of <em>msg</em>.
but are otherwise just like the <code>nng_msg_chop</code> functions.</p>
<p>If the message is not big enough to remove requisite amount of bytes, these functions
return <code>NNG_EINVAL</code>. Otherwise they return zero.</p>
<p>Additionally, functions with typed suffixes (<code>_u16</code>, <code>_u32</code>, <code>_u64</code>) decode the data and return it
through the appropriate <em>val</em> pointer.</p>
<p>The data is assumed to have been in network byte order in the message, but is returned in
the native machine byte order. The appropriate number of bytes is consumed for each of these types,
so two bytes for <code>_u16</code>, four bytes for <code>_u32</code>, and eight bytes for <code>_u64</code>.</p>
<h2 id="message-header"><a class="header" href="#message-header">Message Header</a></h2>
<pre><code class="language-c">void *nng_msg_header(nng_msg *msg);
size_t nng_msg_header_len(nng_msg *msg);
</code></pre>
<p>The header and header length of <em>msg</em> are returned by <a name="a018"></a><code>nng_msg_header</code> and
<a name="a019"></a><code>nng_msg_header_len</code>, respectively.</p>
<p>The message headers are generally intended for limited use, to store protocol headers.</p>
<div class="mdbook-alerts mdbook-alerts-important">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  important
</p>
<p>The message headers are for protocol and transport headers, and not for general
application payloads. Misuse of the header may prevent the application from functioning
properly.</p>
</div>
<h3 id="clear-the-header"><a class="header" href="#clear-the-header">Clear the Header</a></h3>
<pre><code class="language-c">void *nng_msg_header_clear(nng_msg *msg);
</code></pre>
<p>The <a name="a020"></a><code>nng_msg_header_clear</code> simply resets the total message header length to zero.</p>
<h3 id="append-or-insert-header"><a class="header" href="#append-or-insert-header">Append or Insert Header</a></h3>
<pre><code class="language-c">int nng_msg_header_append(nng_msg *msg, const void *val, size_t size);
int nng_msg_header_append_u16(nng_msg *msg, uint16_t val16);
int nng_msg_header_append_u32(nng_msg *msg, uint32_t val32);
int nng_msg_header_append_u64(nng_msg *msg, uint64_t val64);

int nng_msg_header_insert(nng_msg *msg, const void *val, size_t size);
int nng_msg_header_insert_u16(nng_msg *msg, uint16_t val16);
int nng_msg_header_insert_u32(nng_msg *msg, uint32_t val32);
int nng_msg_header_insert_u64(nng_msg *msg, uint64_t val64);
</code></pre>
<p>Appending data to a message header is done by using the <a name="a021"></a><code>nng_msg_header_append</code> functions,
and inserting data in the header is done using the <a name="a022"></a><code>nng_msg_header_insert</code> functions.</p>
<p>These functions act just like the <a href="api//api/msg.html#add-to-body"><code>nng_msg_append</code></a> and <a href="api//api/msg.html#add-to-body"><code>nng_msg_insert</code></a> functions,
except that they operate on the message header rather than the message body.</p>
<h3 id="consume-from-header"><a class="header" href="#consume-from-header">Consume from Header</a></h3>
<pre><code class="language-c">int nng_msg_header_chop(nng_msg *msg, size_t size);
int nng_msg_header_chop_u16(nng_msg *msg, uint16_t *val16);
int nng_msg_header_chop_u32(nng_msg *msg, uint32_t *val32);
int nng_msg_header_chop_u64(nng_msg *msg, uint64_t *val64);

int nng_msg_header_trim(nng_msg *msg, size_t size);
int nng_msg_header_trim_u16(nng_msg *msg, uint16_t *val16);
int nng_msg_header_trim_u32(nng_msg *msg, uint32_t *val32);
int nng_msg_header_trim_u64(nng_msg *msg, uint64_t *val64);
</code></pre>
<p>The <a name="a023"></a><code>nng_msg_header_trim</code> functions remove data from the beginning of the message header,
and the <a name="a024"></a><code>nng_msg_header_chop</code> functions remove data from the end of the message header.</p>
<p>These functions act just like the <a href="api//api/msg.html#consume-from-body"><code>nng_msg_trim</code></a> and <a href="api//api/msg.html#consume-from-body"><code>nng_msg_chop</code></a> functions,
except that they operate the message header rather than the message body.</p>
<h2 id="message-pipe"><a class="header" href="#message-pipe">Message Pipe</a></h2>
<pre><code class="language-c">nng_pipe nng_msg_get_pipe(nng_msg *msg);
void nng_msg_get_pipe(nng_msg *msg, nng_pipe p);
</code></pre>
<p>The <a name="a025"></a><code>nng_msg_set_pipe</code> function sets the <a href="api//api/pipe.html">pipe</a> associated with <em>msg</em> to <em>p</em>.
This is most often useful when used with protocols that support directing
a message to a specific peer.
For example the <a href="api//proto/pair.html"><em>PAIR</em></a> version 1 protocol can do
this when <code>NNG_OPT_PAIR1_POLY</code> mode is set.</p>
<p>The <a name="a026"></a><code>nng_msg_get_pipe</code> function returns the pipe that was previously set on the message <em>m</em>,
either directly by the application, or when the message was received by the protocol.</p>
<div class="mdbook-alerts mdbook-alerts-note">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  note
</p>
<p>Not all protocols support overriding the destination pipe.</p>
</div>
<h2 id="examples"><a class="header" href="#examples">Examples</a></h2>
<h3 id="example-1-preparing-a-message-for-use"><a class="header" href="#example-1-preparing-a-message-for-use">Example 1: Preparing a message for use</a></h3>
<pre><code class="language-c">#include &lt;nng/nng.h&gt;

nng_msg *m;
if (nng_msg_alloc(&amp;m, strlen("content") + 1) != 0) {
  // handle error
}
strcpy(nng_msg_body(m), "content");
</code></pre>
<h3 id="example-2-preallocating-message-content"><a class="header" href="#example-2-preallocating-message-content">Example 2: Preallocating message content</a></h3>
<pre><code class="language-c">if (nng_msg_alloc(&amp;m, 1024) != 0) {
  // handle error
}
while ((val64 = next_datum()) != 0) {
  if (nng_msg_append_u64(m, val64) != 0) {
      // handle error
  }
}
</code></pre>
<!-- Symbol cross reference -->
<!-- HTTP -->
<!-- Macros -->
<!-- Protocols -->
<!-- Transports -->
<!-- Concept index -->
<div style="break-before: page; page-break-before: always;"></div><style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="sockets"><a class="header" href="#sockets">Sockets</a></h1>
<p>Sockets <a name="a001"></a> in Scalability Protocols provide the handle for communication
between peers. Sockets also encapsulate protocol specific semantics, such as
filtering subscriptions, or automatically retrying requests.</p>
<h2 id="socket-structure"><a class="header" href="#socket-structure">Socket Structure</a></h2>
<pre><code class="language-c">#define NNG_SOCKET_INITIALIZER // opaque value

typedef struct nng_socket_s nng_socket;
</code></pre>
<p>The <a name="a002"></a><code>nng_socket</code> structure represents socket. This is a handle, and
the members of it are opaque. However, unlike a pointer, it is usually
passed by value.</p>
<p>A socket may be initialized statically with the <code>NNG_SOCKET_INITIALIZER</code> macro,
to ensure that it cannot be confused with a valid open socket.</p>
<h2 id="socket-identity"><a class="header" href="#socket-identity">Socket Identity</a></h2>
<pre><code class="language-c">int nng_socket_id(nng_socket s);
int nng_socket_raw(nng_socket s, bool *raw);
int nng_socket_proto_id(nng_socket s, uint16_t *proto);
int nng_socket_peer_id(nng_socket s, uint16_t *proto);
int nng_socket_proto_name(nng_socket s, const char **name);
int nng_socket_peer_name(nng_socket s, const char **name);
</code></pre>
<p>These functions are used to provide fundamental information about the socket <em>s</em>.
Most applications will not need to use these functions.</p>
<p>The <a name="a003"></a><code>nng_socket_id</code> function returns the numeric id, which will be a non-negative
value, associated with the socket. If the socket is uninitialized (has never been opened),
then the return value may be <code>-1</code>.</p>
<p>The <a name="a004"></a><code>nng_socket_proto_id</code> and <a name="a005"></a><code>nng_socket_peer_id</code> functions provide the 16-bit
protocol identifier for the socket’s protocol, and of the protocol peers will use when
communicating with the socket.</p>
<p>The <a name="a006"></a><code>nng_socket_proto_name</code> and <a name="a007"></a><code>nng_socket_peer_name</code> functions provide the ASCII
names of the socket’s protocol, and of the protocol peers of the socket use.
The value stored in <em>name</em> is a fixed string located in program text, and must not be freed
or altered. It is guaranteed to remain valid while this library is present.</p>
<p>The <a name="a008"></a><code>nng_socket_raw</code> function determines whether the socket is in
<a href="api//api/sock.html#raw-mode-sockets">raw mode</a> or not, storing <code>true</code> in <em>raw</em> if it is, or <code>false</code> if it is not.</p>
<h2 id="opening-a-socket"><a class="header" href="#opening-a-socket">Opening a Socket</a></h2>
<pre><code class="language-c">int nng_bus0_open(nng_socket *s);
int nng_pub0_open(nng_socket *s);
int nng_pull0_open(nng_socket *s);
int nng_push0_open(nng_socket *s);
int nng_rep0_open(nng_socket *s);
int nng_req0_open(nng_socket *s);
int nng_respondent0_open(nng_socket *s);
int nng_sub0_open(nng_socket *s);
int nng_surveyor0_open(nng_socket *s);
</code></pre>
<p>These functions open a socket, returning it in <em>s</em>.
The constructors for sockets are protocol specific so please refer to protocol documentation
for more specific information.</p>
<p>The following functions open a socket in normal mode:</p>
<ul>
<li><a name="a009"></a><code>nng_bus0_open</code> - <a href="api//proto/bus.html">BUS</a> version 0</li>
<li><a name="a010"></a><code>nng_pair0_open</code> - <a href="api//proto/pair.html">PAIR</a> version 0</li>
<li><a name="a011"></a><code>nng_pair1_open</code> - <a href="api//proto/pair.html">PAIR</a> version 1</li>
<li><a name="a012"></a><code>nng_pair1_open_poly</code> - <a href="api//proto/pair.html">PAIR</a> version 1, <a href="api//proto/pair.html#polyamorous-mode">polyamorous</a> mode</li>
<li><a name="a013"></a><code>nng_pub0_open</code> - <a href="api//proto/pub.html">PUB</a> version 0</li>
<li><a name="a014"></a><code>nng_pull0_open</code> - <a href="api//proto/pull.html">PULL</a> version 0</li>
<li><a name="a015"></a><code>nng_push0_open</code> - <a href="api//proto/push.html">PUSH</a> version 0</li>
<li><a name="a016"></a><code>nng_rep0_open</code> - <a href="api//proto/rep.html">REP</a> version 0</li>
<li><a name="a017"></a><code>nng_req0_open</code> - <a href="api//proto/req.html">REQ</a> version 0</li>
<li><a name="a018"></a><code>nng_respondent0_open</code> - <a href="api//proto/respondent.html">RESPONDENT</a> version 0</li>
<li><a name="a019"></a><code>nng_sub0_open</code> - <a href="api//proto/sub.html">SUB</a> version 0</li>
<li><a name="a020"></a><code>nng_surveyor0_open</code> - <a href="api//proto/surveyor.html">SURVEYOR</a> version 0</li>
</ul>
<h2 id="raw-mode-sockets"><a class="header" href="#raw-mode-sockets">Raw Mode Sockets</a></h2>
<pre><code class="language-c">int nng_bus0_open_raw(nng_socket *s);
int nng_pub0_open_raw(nng_socket *s);
int nng_pull0_open_raw(nng_socket *s);
int nng_push0_open_raw(nng_socket *s);
int nng_rep0_open_raw(nng_socket *s);
int nng_req0_open_raw(nng_socket *s);
int nng_respondent0_open_raw(nng_socket *s);
int nng_sub0_open_raw(nng_socket *s);
int nng_surveyor0_open_raw(nng_socket *s);
</code></pre>
<p><a name="a021"></a>
Raw mode sockets are used in circumstances when the application needs direct access
to the message headers to control the protocol details.</p>
<p>Such sockets require greater sophistication on the part of the application to use,
as the application must process the protocol headers specifically.
The details of the protocol headers, and requirements, are described in the protocol
documentation for each protocol.</p>
<p>Raw mode sockets do not have any kind of state machine associated with them, as all of
the protocol specific processing must be performed by the application.</p>
<div class="mdbook-alerts mdbook-alerts-tip">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  tip
</p>
<p>Most applications do not need to use raw sockets.
The notable exception is when using <a href="api//TODO.html"><code>nng_device</code></a>, which requires raw sockets.
To obtain asynchronous behavior, consider using <a href="api//TODO.html">contexts</a> instead.</p>
</div>
<p>The following functions open a socket in <a href="api//api/sock.html#raw-mode-sockets">raw</a> mode:</p>
<ul>
<li><a name="a022"></a><code>nng_bus0_open_raw</code> - <a href="api//proto/bus.html">BUS</a> version 0, raw mode</li>
<li><a name="a023"></a><code>nng_pair0_open_raw</code> - <a href="api//proto/pair.html">PAIR</a> version 0, raw mode</li>
<li><a name="a024"></a><code>nng_pair1_open_raw</code> - <a href="api//proto/pair.html">PAIR</a> version 1, raw mode</li>
<li><a name="a025"></a><code>nng_pub0_open_raw</code> - <a href="api//proto/pub.html">PUB</a> version 0, raw mode</li>
<li><a name="a026"></a><code>nng_pull0_open_raw</code> - <a href="api//proto/pull.html">PULL</a> version 0, raw mode</li>
<li><a name="a027"></a><code>nng_push0_open_raw</code> - <a href="api//proto/push.html">PUSH</a> version 0, raw mode</li>
<li><a name="a028"></a><code>nng_rep0_open_raw</code> - <a href="api//proto/rep.html">REP</a> version 0, raw mode</li>
<li><a name="a029"></a><code>nng_req0_open_raw</code> - <a href="api//proto/req.html">REP</a> version 0, raw mode</li>
<li><a name="a030"></a><code>nng_respondent0_open_raw</code> - <a href="api//proto/respondent.html">RESPONDENT</a> version 0, raw mode</li>
<li><a name="a031"></a><code>nng_sub0_open_raw</code> - <a href="api//proto/sub.html">SUB</a> version 0, raw mode</li>
<li><a name="a032"></a><code>nng_surveyor0_open_raw</code> - <a href="api//proto/surveyor.html">SURVEYOR</a> version 0, raw mode</li>
</ul>
<h2 id="closing-a-socket"><a class="header" href="#closing-a-socket">Closing a Socket</a></h2>
<pre><code class="language-c">int nng_socket_close(nng_socket s);
</code></pre>
<p>The <a name="a033"></a><code>nng_socket_close</code> function closes a socket, releasing all resources
associated with it. Any operations that are in progress will be terminated with
a result of <a href="api//api/errors.html#NNG_ECLOSED"><code>NNG_ECLOSED</code></a>.</p>
<div class="mdbook-alerts mdbook-alerts-note">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  note
</p>
<p>Closing a socket also invalidates any <a href="api//TODO.html">dialers</a>, <a href="api//TODO.html">listeners</a>,
<a href="api//api/pipe.html">pipes</a>, or <a href="api//TODO.html">contexts</a> associated with it.</p>
</div>
<div class="mdbook-alerts mdbook-alerts-note">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  note
</p>
<p>This function will wait for any outstanding operations to be aborted, or to complete,
before returning. Consequently it is not safe to call this from contexts that cannot
block.</p>
</div>
<div class="mdbook-alerts mdbook-alerts-note">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  note
</p>
<p>Closing the socket may be disruptive to transfers that are still in progress.</p>
</div>
<h2 id="sending-messages"><a class="header" href="#sending-messages">Sending Messages</a></h2>
<pre><code class="language-c">int nng_send(nng_socket s, void *data, size_t size, int flags);
int nng_sendmsg(nng_socket s, nng_msg *msg, int flags);
void nng_socket_send(nng_socket s, nng_aio *aio);
</code></pre>
<p>These functions (<a name="a034"></a><code>nng_send</code>, <a name="a035"></a><code>nng_sendmsg</code>, and <a name="a036"></a><code>nng_socket_send</code>) send
messages over the socket <em>s</em>. The differences in their behaviors are as follows.</p>
<div class="mdbook-alerts mdbook-alerts-note">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  note
</p>
<p>The semantics of what sending a message means varies from protocol to
protocol, so examination of the protocol documentation is encouraged.
Additionally, some protocols may not support sending at all or may require other pre-conditions first.
(For example, <a href="api//proto/rep.html">REP</a> sockets cannot normally send data until they have first received a request,
while <a href="api//proto/sub.html">SUB</a> sockets can only receive data and never send it.)</p>
</div>
<h3 id="nng_send"><a class="header" href="#nng_send">nng_send</a></h3>
<p>The <code>nng_send</code> function is the simplest to use, but is the least efficient.
It sends the content in <em>data</em>, as a message of <em>size</em> bytes. The <em>flags</em> is a bit mask
made up of zero or more of the following values:</p>
<ul>
<li><a name="a037"></a><code>NNG_FLAG_NONBLOCK</code>: <a name="NNG_FLAG_NONBLOCK"></a>
If the socket cannot accept more data at this time, it does not block, but returns immediately
with a status of <a href="api//api/errors.html#NNG_EAGAIN"><code>NNG_EAGAIN</code></a>. If this flag is absent, the function will wait until data can be sent.</li>
</ul>
<div class="mdbook-alerts mdbook-alerts-note">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  note
</p>
<p>Regardless of the presence or absence of <code>NNG_FLAG_NONBLOCK</code>, there may
be queues between the sender and the receiver.
Furthermore, there is no guarantee that the message has actually been delivered.
Finally, with some protocols, the semantic is implicitly <code>NNG_FLAG_NONBLOCK</code>,
such as with <a href="api//proto/pub.html">PUB</a> sockets, which are best-effort delivery only.</p>
</div>
<h3 id="nng_sendmsg"><a class="header" href="#nng_sendmsg">nng_sendmsg</a></h3>
<p>The <code>nng_sendmsg</code> function sends the <em>msg</em> over the socket <em>s</em>.</p>
<p>If this function returns zero, then the socket will dispose of <em>msg</em> when the transmission is complete.
If the function returns a non-zero status, then the call retains the responsibility for disposing of <em>msg</em>.</p>
<p>The <em>flags</em> can contain the value <a href="api//TODO.html"><code>NNG_FLAG_NONBLOCK</code></a>, indicating that the function should not wait if the socket
cannot accept more data for sending. In such a case, it will return <a href="api//api/errors.html#NNG_EAGAIN"><code>NNG_EAGAIN</code></a>.</p>
<div class="mdbook-alerts mdbook-alerts-tip">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  tip
</p>
<p>This function is preferred over <a href="api//api/sock.html#nng_send"><code>nng_send</code></a>, as it gives access to the message structure and eliminates both
a data copy and allocation.</p>
</div>
<h3 id="nng_socket_send"><a class="header" href="#nng_socket_send">nng_socket_send</a></h3>
<p>The <code>nng_socket_send</code> function sends a message asynchronously, using the <a href="api//api/aio.html#asynchronous-io-handle"><code>nng_aio</code></a> <em>aio</em>, over the socket <em>s</em>.
The message to send must have been set on <em>aio</em> using the <a href="api//api/aio.html#messages"><code>nng_aio_set_msg</code></a> function.</p>
<p>If the operation completes successfully, then the socket will have disposed of the message.
However, if it fails, then callback of <em>aio</em> should arrange for a final disposition of the message.
(The message can be retrieved from <em>aio</em> with <a href="api//api/aio.html#messages"><code>nng_aio_get_msg</code></a>.)</p>
<p>Note that callback associated with <em>aio</em> may be called <em>before</em> the message is finally delivered to the recipient.
For example, the message may be sitting in queue, or located in TCP buffers, or even in flight.</p>
<div class="mdbook-alerts mdbook-alerts-tip">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  tip
</p>
<p>This is the preferred function to use for sending data on a socket. While it does require a few extra
steps on the part of the application, the lowest latencies and highest performance will be achieved by using
this function instead of <a href="api//api/sock.html#nng_send"><code>nng_send</code></a> or <a href="api//api/sock.html#nng_sendmsg"><code>nng_sendmsg</code></a>.</p>
</div>
<h2 id="receiving-messages"><a class="header" href="#receiving-messages">Receiving Messages</a></h2>
<pre><code class="language-c">int nng_recv(nng_socket s, void *data, size_t *sizep, int flags);
int nng_recvmsg(nng_socket s, nng_msg **msgp, int flags);
void nng_socket_recv(nng_socket s, nng_aio *aio);
</code></pre>
<p>These functions (<a name="a038"></a><code>nng_recv</code>, <a name="a039"></a><code>nng_recvmsg</code>, and <a name="a040"></a><code>nng_socket_recv</code>) receive
messages over the socket <em>s</em>. The differences in their behaviors are as follows.</p>
<div class="mdbook-alerts mdbook-alerts-note">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  note
</p>
<p>The semantics of what receiving a message means varies from protocol to
protocol, so examination of the protocol documentation is encouraged.
Additionally, some protocols may not support receiving at all or may require other pre-conditions first.
(For example, <a href="api//proto/req.html">REQ</a> sockets cannot normally receive data until they have first sent a request,
while <a href="api//proto/pub.html">PUB</a> sockets can only send data and never receive it.)</p>
</div>
<h3 id="nng_recv"><a class="header" href="#nng_recv">nng_recv</a></h3>
<p>The <code>nng_recv</code> function is the simplest to use, but is the least efficient.
It receives the content in <em>data</em>, as a message size (in bytes) of up to the value stored in <em>sizep</em>.</p>
<p>Upon success, the size of the message received will be stored in <em>sizep</em>.</p>
<p>The <em>flags</em> is a bit mask made up of zero or more of the following values:</p>
<ul>
<li><a name="a041"></a><code>NNG_FLAG_NONBLOCK</code>:
If the socket has no messages pending for reception at this time, it does not block, but returns immediately
with a status of <a href="api//api/errors.html#NNG_EAGAIN"><code>NNG_EAGAIN</code></a>. If this flag is absent, the function will wait until data can be received.</li>
</ul>
<h3 id="nng_recvmsg"><a class="header" href="#nng_recvmsg">nng_recvmsg</a></h3>
<p>The <code>nng_recvmsg</code> function receives a message and stores a pointer to the <a href="api//api/msg.html#message-structure"><code>nng_msg</code></a> for that message in <em>msgp</em>.</p>
<p>The <em>flags</em> can contain the value <a href="api//TODO.html"><code>NNG_FLAG_NONBLOCK</code></a>, indicating that the function should not wait if the socket
has no messages available to receive. In such a case, it will return <a href="api//api/errors.html#NNG_EAGAIN"><code>NNG_EAGAIN</code></a>.</p>
<div class="mdbook-alerts mdbook-alerts-tip">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  tip
</p>
<p>This function is preferred over <a href="api//TODO.html"><code>nng_recv</code></a>, as it gives access to the message structure and eliminates both
a data copy and allocation.</p>
</div>
<h3 id="nng_socket_recv"><a class="header" href="#nng_socket_recv">nng_socket_recv</a></h3>
<p>The <code>nng_socket_send</code> function receives a message asynchronously, using the <a href="api//api/aio.html#asynchronous-io-handle"><code>nng_aio</code></a> <em>aio</em>, over the socket <em>s</em>.
On success, the received message can be retrieved from the <em>aio</em> using the <a href="api//api/aio.html#messages"><code>nng_aio_get_msg</code></a> function.</p>
<div class="mdbook-alerts mdbook-alerts-note">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  note
</p>
<p>It is important that the application retrieves the message, and disposes of it accordingly.
Failure to do so will leak the memory.</p>
</div>
<div class="mdbook-alerts mdbook-alerts-tip">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  tip
</p>
<p>This is the preferred function to use for receiving data on a socket. While it does require a few extra
steps on the part of the application, the lowest latencies and highest performance will be achieved by using
this function instead of <a href="api//TODO.html"><code>nng_recv</code></a> or <a href="api//api/sock.html#nng_recvmsg"><code>nng_recvmsg</code></a>.</p>
</div>
<h2 id="socket-options"><a class="header" href="#socket-options">Socket Options</a></h2>
<pre><code class="language-c">int nng_socket_get_bool(nng_socket s, const char *opt, bool *valp);
int nng_socket_get_int(nng_socket s, const char *opt, int *valp);
int nng_socket_get_ms(nng_socket s, const char *opt, nng_duration *valp);
int nng_socket_get_size(nng_socket s, const char *opt, size_t *valp);

int nng_socket_set_bool(nng_socket s, const char *opt, int val);
int nng_socket_set_int(nng_socket s, const char *opt, int val);
int nng_socket_set_ms(nng_socket s, const char *opt, nng_duration val);
int nng_socket_set_size(nng_socket s, const char *opt, size_t val);
</code></pre>
<p>Protocols usually have protocol specific behaviors that can be adjusted via options.</p>
<p>These functions are used to retrieve or change the value of an option named <em>opt</em> from the context <em>ctx</em>.
The <code>nng_socket_get_</code> functions retrieve the value from the socket <em>s</em>, and store it in the location <em>valp</em> references.
The <code>nng_socket_set_</code> functions change the value for the socket <em>s</em>, taking it from <em>val</em>.</p>
<p>These functions access an option as a specific type. The protocol documentation will have details about which options
are available, whether they can be read or written, and the appropriate type to use.</p>
<div class="mdbook-alerts mdbook-alerts-note">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  note
</p>
<p>Socket options are are used to tune the behavior of the higher level protocol. To change the options
for an underlying transport, the option should be set on the <a href="api//TODO.html">dialer</a> or <a href="api//TODO.html">listener</a> instead of the <a href="api//TODO.html">socket</a>.</p>
</div>
<h3 id="common-options"><a class="header" href="#common-options">Common Options</a></h3>
<p>The following options are available for many protocols, and always use the same types and semantics described below.</p>
<div class="table-wrapper"><table><thead><tr><th>Option</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>NNG_OPT_MAXTTL</code><a name="NNG_OPT_MAXTTL"></a></td><td><code>int</code></td><td>Maximum number of traversals across an <a href="api//TODO.html"><code>nng_device</code></a> device, to prevent forwarding loops. May be 1-255, inclusive. Normally defaults to 8.</td></tr>
<tr><td><code>NNG_OPT_RECONNMAXT</code><a name="NNG_OPT_RECONNMAXT"></a></td><td><code>nng_duration</code></td><td>Maximum time <a href="api//TODO.html">dialers</a> will delay before trying after failing to connect.</td></tr>
<tr><td><code>NNG_OPT_RECONNMINT</code><a name="NNG_OPT_RECONNMINT"></a></td><td><code>nng_duration</code></td><td>Minimum time <a href="api//TODO.html">dialers</a> will delay before trying after failing to connect.</td></tr>
<tr><td><code>NNG_OPT_RECVBUF</code><a name="NNG_OPT_RECVBUF"></a></td><td><code>int</code></td><td>Maximum number of messages (0-8192) to buffer locally when receiving.</td></tr>
<tr><td><code>NNG_OPT_RECVMAXSZ</code><a name="NNG_OPT_RECVMAXSZ"></a></td><td><code>size_t</code></td><td>Maximum message size acceptable for receiving. Zero means unlimited. Intended to prevent remote abuse. Can be tuned independently on <a href="api//TODO.html">dialers</a> and <a href="api//TODO.html">listeners</a>.</td></tr>
<tr><td><code>NNG_OPT_RECVTIMEO</code><a name="NNG_OPT_RECVTIMEO"></a></td><td><code>nng_duration</code></td><td>Default timeout (ms) for receiving messages.</td></tr>
<tr><td><code>NNG_OPT_SENDBUF</code><a name="NNG_OPT_SENDBUF"></a></td><td><code>int</code></td><td>Maximum number of messages (0-8192) to buffer when sending messages.</td></tr>
<tr><td><code>NNG_OPT_SENDTIMEO</code><a name="NNG_OPT_SENDTIMEO"></a></td><td><code>nng_duration</code></td><td>Default timeout (ms) for sending messages.</td></tr>
</tbody></table>
</div>
<p> </p>
<div class="mdbook-alerts mdbook-alerts-note">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  note
</p>
<p>The <code>NNG_OPT_RECONNMAXT</code>, <code>NNG_OPT_RECONNMINT</code>, and <code>NNG_OPT_RECVMAXSZ</code> options are just the initial defaults that <a href="api//TODO.html">dialers</a>
(and for <code>NNG_OPT_RECVMAXSZ</code> also <a href="api//TODO.html">listeners</a>)
will use. After the dialer or listener is created, changes to the socket’s value will have no affect on that dialer or listener.</p>
</div>
<h2 id="polling-socket-events"><a class="header" href="#polling-socket-events">Polling Socket Events</a></h2>
<pre><code class="language-c">int nng_socket_get_recv_poll_fd(nng_socket s, int *fdp);
int nng_socket_get_send_poll_fd(nng_socket s, int *fdp);
</code></pre>
<p>Sometimes it is necessary to integrate a socket into a <code>poll</code> or <code>select</code> driven
<a name="a042"></a>event loop. (Or, on Linux, <code>epoll</code>, or on BSD derived systems like macOS <code>kqueue</code>).</p>
<p>For these occasions, a suitable file descriptor for polling is provided
by these two functions.</p>
<p>The <a name="a043"></a><code>nng_socket_get_recv_poll_fd</code> function obtains a file descriptor
that will poll as readable when a message is ready for receiving for the socket.</p>
<p>The <a name="a044"></a><code>nng_socket_get_send_poll_fd</code> function obtains a file descriptor
that will poll as readable when the socket can accept a message for sending.</p>
<p>These file descriptors should only be polled for readability, and no
other operation performed on them. The socket will read from, or write to,
these file descriptors to provide a level-signaled behavior automatically.</p>
<p>Additionally the socket will close these file descriptors when the socket itself is closed.</p>
<p>These functions replace the <code>NNG_OPT_SENDFD</code> and <code>NNG_OPT_RECVFD</code> socket options that
were available in previous versions of NNG.</p>
<div class="mdbook-alerts mdbook-alerts-note">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  note
</p>
<p>These functions are not compatible with <a href="api//TODO.html">contexts</a>.</p>
</div>
<div class="mdbook-alerts mdbook-alerts-note">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  note
</p>
<p>The file descriptors supplied by these functions is not used for transporting message data.
The only valid use of these file descriptors is for polling for the ability to send or receive
messages on the socket.</p>
</div>
<div class="mdbook-alerts mdbook-alerts-tip">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  tip
</p>
<p>Using these functions will force the socket to perform extra system calls, and thus
have a negative impact on performance and latency. It is preferable to use <a href="api//api/aio.html">asynchronous I/O</a>
when possible.</p>
</div>
<h2 id="examples-1"><a class="header" href="#examples-1">Examples</a></h2>
<h3 id="example-1-initializing-a-socket"><a class="header" href="#example-1-initializing-a-socket">Example 1: Initializing a Socket</a></h3>
<pre><code class="language-c">nng_socket s = NNG_SOCKET_INITIALIZER;
</code></pre>
<h3 id="example-2-publishing-a-timestamp"><a class="header" href="#example-2-publishing-a-timestamp">Example 2: Publishing a Timestamp</a></h3>
<p>This example demonstrates the use of <a href="api//api/aio.html#asynchronous-io-handle"><code>nng_aio</code></a>, <a href="api//api/sock.html#nng_socket_send"><code>nng_socket_send</code></a>, and <a href="api//api/time.html"><code>nng_sleep_aio</code></a> to
build a service that publishes a timestamp at one second intervals. Error handling is elided for the
sake of clarity.</p>
<pre><code class="language-c">#include &lt;stdlib.h&gt;
#include &lt;stdio.h&gt;
#include &lt;nng/nng.h&gt;
#include &lt;nng/protocol/pubsub0/pub.h&gt;

struct state {
    nng_socket s;
    bool sleeping;
    nng_aio *aio;
};

static struct state state;

void callback(void *arg) {
    nng_msg *msg;
    nng_time now;
    struct state *state = arg;
    if (nng_aio_result(state-&gt;aio) != 0) {
        fprintf(stderr, "Error %s occurred", nng_strerror(nng_aio_result(state-&gt;aio)));
        return; // terminate the callback loop
    }
    if (state-&gt;sleeping) {
        state-&gt;sleeping = false;
        nng_msg_alloc(&amp;msg, sizeof (nng_time));
        now = nng_clock();
        nng_msg_append(msg, &amp;now, sizeof (now)); // note: native endian
        nng_aio_set_msg(state-&gt;aio, msg);
        nng_socket_send(state-&gt;s, state-&gt;aio);
    } else {
        state-&gt;sleeping = true;
        nng_sleep_aio(1000, state-&gt;aio); // 1000 ms == 1 second
    }
}

int main(int argc, char **argv) {
    const char *url = argv[1]; // should check this

    nng_aio_alloc(&amp;state.aio, NULL, NULL);
    nng_pub0_open(&amp;state.s);
    nng_listen(state.s, url, NULL, 0);
    state.sleeping = 0;
    nng_sleep_aio(1, state.aio); // kick it off right away
    for(;;) {
        nng_msleep(0x7FFFFFFF); // infinite, could use pause or sigsuspend
    }
}
</code></pre>
<h3 id="example-3-watching-a-periodic-timestamp"><a class="header" href="#example-3-watching-a-periodic-timestamp">Example 3: Watching a Periodic Timestamp</a></h3>
<p>This example demonstrates the use of <a href="api//api/aio.html#asynchronous-io-handle"><code>nng_aio</code></a>, <a href="api//api/sock.html#nng_socket_recv"><code>nng_socket_recv</code></a>, to build a client to
watch for messages received from the service created in Example 2.
Error handling is elided for the sake of clarity.</p>
<pre><code class="language-c">#include &lt;stdlib.h&gt;
#include &lt;stdio.h&gt;
#include &lt;string.h&gt;&gt;
#include &lt;nng/nng.h&gt;
#include &lt;nng/protocol/pubsub0/sub.h&gt;

struct state {
    nng_socket s;
    nng_aio *aio;
};

static struct state state;

void callback(void *arg) {
    nng_msg *msg;
    nng_time now;
    struct state *state = arg;
    if (nng_aio_result(state-&gt;aio) != 0) {
        fprintf(stderr, "Error %s occurred", nng_strerror(nng_aio_result(state-&gt;aio)));
        return; // terminate the callback loop
    }
    msg = nng_aio_get_msg(state-&gt;aio);
    memcpy(&amp;now, nng_msg_body(msg), sizeof (now)); // should check the length!
    printf("Timestamp is %lu\n", (unsigned long)now);
    nng_msg_free(msg);
    nng_aio_set_msg(state-&gt;aio, NULL);
    nng_socket_recv(state-&gt;s, state-&gt;aio);
}

int main(int argc, char **argv) {
    const char *url = argv[1]; // should check this

    nng_aio_alloc(&amp;state.aio, NULL, NULL);
    nng_sub0_open(&amp;state.s);
    nng_sub0_socket_subscribe(state.s, NULL, 0); // subscribe to everything
    nng_dial(state.s, url, NULL, 0);
    nng_socket_recv(state.s, state.aio); // kick it off right away
    for(;;) {
        nng_msleep(0x7FFFFFFF); // infinite, could use pause or sigsuspend
    }
}
</code></pre>
<!-- Symbol cross reference -->
<!-- HTTP -->
<!-- Macros -->
<!-- Protocols -->
<!-- Transports -->
<!-- Concept index -->
<div style="break-before: page; page-break-before: always;"></div><style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="contexts"><a class="header" href="#contexts">Contexts</a></h1>
<p>Contexts <a name="a001"></a> in Scalability Protocols provide for isolation of protocol-specific
state machines and associated data, allowing multiple <a name="a002"></a>concurrent <a name="a003"></a>state machines (or transactions)
to coexist on a single <a href="api//TODO.html">socket</a>.</p>
<p>For example, a <a href="api//proto/rep.html">REP</a> server may wish to allow many requests to be serviced concurrently,
even though some jobs may take significant time to process. Contexts provide for this ability.</p>
<p>Not all protocols have contexts, because many protocols simply have no state to manage.
The following protocols support contexts:</p>
<ul>
<li><a href="api//proto/rep.html">REP</a></li>
<li><a href="api//proto/req.html">REQ</a></li>
<li><a href="api//proto/respondent.html">RESPONDENT</a></li>
<li><a href="api//proto/surveyor.html">SURVEYOR</a></li>
<li><a href="api//proto/sub.html">SUB</a></li>
</ul>
<p>For these protocols, the socket will also have a single, default, context that is used when
performing send or receive operations on the socket directly.</p>
<p>Other protocols are stateless, at least with respect to message processing, and have no use for
contexts. For the same reason, <a href="api//api/sock.html#raw-mode-sockets">raw</a> mode sockets do not support contexts.</p>
<div class="mdbook-alerts mdbook-alerts-tip">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  tip
</p>
<p>Developers with experience with [libnanomsg] may be used to using <a href="api//api/sock.html#raw-mode-sockets">raw</a> sockets for concurrency.
Contexts provide a superior solution, as they are much easier to use, less error prone, and allow
for easy control of the amount of concurrency used on any given socket.</p>
</div>
<p>One drawback of contexts is that they cannot be used with file descriptor polling using
<a href="api//api/sock.html#polling-socket-events"><code>nng_socket_get_recv_poll_fd</code></a> or <a href="api//api/sock.html#polling-socket-events"><code>nng_socket_get_send_poll_fd</code></a>.</p>
<h2 id="context-structure"><a class="header" href="#context-structure">Context Structure</a></h2>
<pre><code class="language-c">#define NNG_CTX_INITIALIZER // opaque value

typedef struct nng_ctx_s nng_ctx;
</code></pre>
<p>The <a name="a004"></a><code>nng_ctx</code> structure represents context. This is a handle, and
the members of it are opaque. However, unlike a pointer, it is passed by value.</p>
<p>A context may be initialized statically with the <a name="a005"></a><code>NNG_CTX_INITIALIZER</code> macro,
to ensure that it cannot be confused with a valid open context.</p>
<h2 id="creating-a-context"><a class="header" href="#creating-a-context">Creating a Context</a></h2>
<pre><code class="language-c">int nng_ctx_open(nng_ctx *ctxp, nng_socket s);
</code></pre>
<p>The <a name="a006"></a><code>nng_ctx_open</code> function creates a separate context to be used with the <a href="api//TODO.html">socket</a> <em>s</em>,
and returns it at the location pointed by <em>ctxp</em>.</p>
<h2 id="context-identity"><a class="header" href="#context-identity">Context Identity</a></h2>
<pre><code class="language-c">int nng_ctx_id(nng_ctx c);
</code></pre>
<p>The <a name="a007"></a><code>nng_ctx_id</code> function returns a positive identifier for the context <em>c</em> if it is valid.
Otherwise it returns <code>-1</code>.</p>
<p>A context is considered valid if it was ever opened with <a href="api//api/ctx.html#creating-a-context"><code>nng_ctx_open</code></a> function.
Contexts that are allocated on the stack or statically should be initialized with the macro <a href="api//api/ctx.html#context-structure"><code>NNG_CTX_INITIALIZER</code></a>
to ensure that they cannot be confused with a valid context before they are opened.</p>
<h2 id="closing-a-context"><a class="header" href="#closing-a-context">Closing a Context</a></h2>
<pre><code class="language-c">int nng_ctx_close(nng_ctx ctx);
</code></pre>
<p>The <a name="a008"></a><code>nng_ctx_close</code> function closes the context <em>ctx</em>.
Messages that have been submitted for sending may be flushed or delivered,
depending upon the transport.</p>
<p>Further attempts to use the context after this call returns will result in <code>NNG_ECLOSED</code>.
Threads waiting for operations on the context when this
call is executed may also return with an <code>NNG_ECLOSED</code> result.</p>
<div class="mdbook-alerts mdbook-alerts-note">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  note
</p>
<p>Closing the socket associated with <em>ctx</em> using <a href="api//api/sock.html#closing-a-socket"><code>nng_socket_close</code></a> also closes this context.</p>
</div>
<h2 id="sending-messages-1"><a class="header" href="#sending-messages-1">Sending Messages</a></h2>
<pre><code class="language-c">int nng_ctx_sendmsg(nng_ctx ctx, nng_msg *msg, int flags);
void nng_ctx_send(nng_ctx ctx, nng_aio *aio);
</code></pre>
<p>These functions (<a name="a009"></a><code>nng_ctx_sendmsg</code> and <a name="a010"></a><code>nng_ctx_send</code>) send
messages over the socket <em>s</em>. The differences in their behaviors are as follows.</p>
<div class="mdbook-alerts mdbook-alerts-note">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  note
</p>
<p>The semantics of what sending a message means varies from protocol to
protocol, so examination of the protocol documentation is encouraged.
Additionally, some protocols may not support sending at all or may require other pre-conditions first.
(For example, <a href="api//proto/rep.html">REP</a> sockets cannot normally send data until they have first received a request,
while <a href="api//proto/sub.html">SUB</a> sockets can only receive data and never send it.)</p>
</div>
<h3 id="nng_ctx_sendmsg"><a class="header" href="#nng_ctx_sendmsg">nng_ctx_sendmsg</a></h3>
<p>The <code>nng_ctx_sendmsg</code> function sends the <em>msg</em> over the context <em>ctx</em>.</p>
<p>If this function returns zero, then the socket will dispose of <em>msg</em> when the transmission is complete.
If the function returns a non-zero status, then the call retains the responsibility for disposing of <em>msg</em>.</p>
<p>The <em>flags</em> can contain the value <a href="api//TODO.html"><code>NNG_FLAG_NONBLOCK</code></a>, indicating that the function should not wait if the socket
cannot accept more data for sending. In such a case, it will return <a href="api//api/errors.html#NNG_EAGAIN"><code>NNG_EAGAIN</code></a>.</p>
<h3 id="nng_ctx_send"><a class="header" href="#nng_ctx_send">nng_ctx_send</a></h3>
<p>The <code>nng_ctx_send</code> function sends a message asynchronously, using the <a href="api//api/aio.html#asynchronous-io-handle"><code>nng_aio</code></a> <em>aio</em>, over the context <em>ctx</em>.
The message to send must have been set on <em>aio</em> using the <a href="api//api/aio.html#messages"><code>nng_aio_set_msg</code></a> function.</p>
<p>If the operation completes successfully, then the context will have disposed of the message.
However, if it fails, then callback of <em>aio</em> should arrange for a final disposition of the message.
(The message can be retrieved from <em>aio</em> with <a href="api//api/aio.html#messages"><code>nng_aio_get_msg</code></a>.)</p>
<p>Note that callback associated with <em>aio</em> may be called <em>before</em> the message is finally delivered to the recipient.
For example, the message may be sitting in queue, or located in TCP buffers, or even in flight.</p>
<div class="mdbook-alerts mdbook-alerts-tip">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  tip
</p>
<p>This is the preferred function to use for sending data on a context. While it does require a few extra
steps on the part of the application, the lowest latencies and highest performance will be achieved by using
this function instead of <a href="api//api/ctx.html#nng_ctx_sendmsg"><code>nng_ctx_sendmsg</code></a>.</p>
</div>
<h2 id="receiving-messages-1"><a class="header" href="#receiving-messages-1">Receiving Messages</a></h2>
<pre><code class="language-c">int nng_ctx_recvmsg(nng_ctx ctx, nng_msg **msgp, int flags);
void nng_ctx_recv(nng_ctx ctx, nng_aio *aio);
</code></pre>
<p>These functions (, <a name="a011"></a><code>nng_ctx_recvmsg</code> and <a name="a012"></a><code>nng_ctx_recv</code>) receive
messages over the context <em>ctx</em>. The differences in their behaviors are as follows.</p>
<div class="mdbook-alerts mdbook-alerts-note">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  note
</p>
<p>The semantics of what receiving a message means varies from protocol to
protocol, so examination of the protocol documentation is encouraged.
Additionally, some protocols may not support receiving at all or may require other pre-conditions first.
(For example, <a href="api//proto/req.html">REQ</a> sockets cannot normally receive data until they have first sent a request.)</p>
</div>
<h3 id="nng_recvmsg-1"><a class="header" href="#nng_recvmsg-1">nng_recvmsg</a></h3>
<p>The <code>nng_ctx_recvmsg</code> function receives a message and stores a pointer to the <a href="api//api/msg.html#message-structure"><code>nng_msg</code></a> for that message in <em>msgp</em>.</p>
<p>The <em>flags</em> can contain the value <a href="api//TODO.html"><code>NNG_FLAG_NONBLOCK</code></a>, indicating that the function should not wait if the socket
has no messages available to receive. In such a case, it will return <a href="api//api/errors.html#NNG_EAGAIN"><code>NNG_EAGAIN</code></a>.</p>
<h3 id="nng_socket_recv-1"><a class="header" href="#nng_socket_recv-1">nng_socket_recv</a></h3>
<p>The <code>nng_ctx_send</code> function receives a message asynchronously, using the <a href="api//api/aio.html#asynchronous-io-handle"><code>nng_aio</code></a> <em>aio</em>, over the context <em>ctx</em>.
On success, the received message can be retrieved from the <em>aio</em> using the <a href="api//api/aio.html#messages"><code>nng_aio_get_msg</code></a> function.</p>
<div class="mdbook-alerts mdbook-alerts-note">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  note
</p>
<p>It is important that the application retrieves the message, and disposes of it accordingly.
Failure to do so will leak the memory.</p>
</div>
<div class="mdbook-alerts mdbook-alerts-tip">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  tip
</p>
<p>This is the preferred function to use for receiving data on a context. While it does require a few extra
steps on the part of the application, the lowest latencies and highest performance will be achieved by using
this function instead of <a href="api//api/ctx.html#nng_ctx_recvmsg"><code>nng_ctx_recvmsg</code></a>.</p>
</div>
<h2 id="context-options"><a class="header" href="#context-options">Context Options</a></h2>
<pre><code class="language-c">int nng_ctx_get_bool(nng_ctx ctx, const char *opt, bool *valp);
int nng_ctx_get_int(nng_ctx ctx, const char *opt, int *valp);
int nng_ctx_get_ms(nng_ctx ctx, const char *opt, nng_duration *valp);
int nng_ctx_get_size(nng_ctx ctx, const char *opt, size_t *valp);

int nng_ctx_set_bool(nng_ctx ctx, const char *opt, int val);
int nng_ctx_set_int(nng_ctx ctx, const char *opt, int val);
int nng_ctx_set_ms(nng_ctx ctx, const char *opt, nng_duration val);
int nng_ctx_set_size(nng_ctx ctx, const char *opt, size_t val);
</code></pre>
<p>Some protocols support certain options that affect the behavior of a specific context.
For example, most protocols will let you set the defaults timeouts associated with
send or receive separately for different contexts.</p>
<p>These functions are used to retrieve or change the value of an option named <em>opt</em> from the context <em>ctx</em>.
The <code>nng_ctx_get_</code> functions retrieve the value from <em>ctx</em>, and store it in the location <em>valp</em> references.
The <code>nng_ctx_set_</code> functions change the value for the <em>ctx</em>, taking it from <em>val</em>.</p>
<p>These functions access an option as a specific type. The protocol documentation will have details about which options
are available for contexts, whether they can be read or written, and the appropriate type to use.</p>
<h2 id="examples-2"><a class="header" href="#examples-2">Examples</a></h2>
<p>These examples show building blocks for a concurrent service based on contexts.</p>
<h3 id="example-1-context-echo-server"><a class="header" href="#example-1-context-echo-server">Example 1: Context Echo Server</a></h3>
<p>The following program fragment demonstrates the use of contexts to implement
a concurrent <a href="api//proto/rep.html">REP</a> service that simply echos messages back
to the sender.</p>
<pre><code class="language-c">struct echo_context {
    nng_ctx ctx;
    nng_aio *aio;
    enum { INIT, RECV, SEND } state;
};

void
echo(void *arg)
{
    struct echo_context *ec = arg;

    switch (ec-&gt;state) {
    case INIT:
        ec-&gt;state = RECV;
        nng_ctx_recv(ec-&gt;ctx, ec-&gt;aio);
        return;
    case RECV:
        if (nng_aio_result(ec-&gt;aio) != 0) {
            // ... handle error
        }
        // We reuse the message on the ec-&gt;aio
        ec-&gt;state = SEND;
        nng_ctx_send(ec-&gt;ctx, ec-&gt;aio);
        return;
    case SEND:
        if (nng_aio_result(ec-&gt;aio) != 0) {
            // ... handle error
        }
        ec-&gt;state = RECV;
        nng_ctx_recv(ec-&gt;ctx, ec-&gt;aio);
        return;
    }
}
</code></pre>
<h3 id="example-2-starting-the-echo-service"><a class="header" href="#example-2-starting-the-echo-service">Example 2: Starting the Echo Service</a></h3>
<p>Given the above fragment, the following example shows setting up the service.
It assumes that the <a href="api//TODO.html">socket</a> has already been
created and any transports set up as well with functions such as <a href="api//TODO.html"><code>nng_dial</code></a> or <a href="api//TODO.html"><code>nng_listen</code></a>.</p>
<pre><code class="language-c">
#define CONCURRENCY 1024

static struct echo_context ecs[CONCURRENCY];

void
start_echo_service(nng_socket rep_socket)
{
    for (int i = 0; i &lt; CONCURRENCY; i++) {
        // error checks elided for clarity
        nng_ctx_open(&amp;ecs[i].ctx, rep_socket);
        nng_aio_alloc(&amp;ecs[i].aio, echo, ecs+i);
        ecs[i].state = INIT;
        echo(ecs+i); // start it running
    }
}
</code></pre>
<!-- Symbol cross reference -->
<!-- HTTP -->
<!-- Macros -->
<!-- Protocols -->
<!-- Transports -->
<!-- Concept index -->
<div style="break-before: page; page-break-before: always;"></div><style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="pipes"><a class="header" href="#pipes">Pipes</a></h1>
<pre><code class="language-c">typedef struct nng_pipe_s nng_pipe;
</code></pre>
<p>An <a name="a001"></a><code>nng_pipe</code> is a handle to a <a name="a002"></a>pipe object, which can be thought of as a single <a name="a003"></a>connection.
(In most cases this is actually the case – the pipe is an abstraction for a single TCP or IPC connection.)
Pipes are associated with either the listener or dialer that created them,
and therefore are also automatically associated with a single socket.</p>
<div class="mdbook-alerts mdbook-alerts-note">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  note
</p>
<p>The <code>nng_pipe</code> structure is always passed by value (both
for input parameters and return values), and should be treated opaquely.
Passing structures this way gives the compiler a chance to perform
accurate type checks in functions passing values of this type.</p>
</div>
<div class="mdbook-alerts mdbook-alerts-tip">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  tip
</p>
<p>Most applications should never concern themselves with individual pipes.
However it is possible to access a pipe when more information about the
source of a message is needed, or when more control is required over message delivery.</p>
</div>
<p>Pipe objects are created by <a href="api//TODO.html">dialers</a> and and <a href="api//TODO.html">listeners</a>.</p>
<h2 id="initialization-1"><a class="header" href="#initialization-1">Initialization</a></h2>
<p>A pipe may be initialized using the macro <a name="a004"></a><code>NNG_PIPE_INITIALIZER</code>
before it is opened, to prevent confusion with valid open pipes.</p>
<p>For example:</p>
<pre><code class="language-c">nng_pipe p = NNG_PIPE_INITIALIZER;
</code></pre>
<h2 id="pipe-identity"><a class="header" href="#pipe-identity">Pipe Identity</a></h2>
<pre><code class="language-c">int nng_pipe_id(nng_pipe p);
</code></pre>
<p>The <a name="a005"></a><code>nng_pipe_id</code> function returns a positive identifier for the pipe <em>p</em>, if it is valid.
Otherwise it returns <code>-1</code>.</p>
<div class="mdbook-alerts mdbook-alerts-note">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  note
</p>
<p>A pipe is considered valid if it was ever created by the socket.
Pipes that are allocated on the stack or statically should be initialized with the macro
<a href="api//api/pipe.html#initialization"><code>NNG_PIPE_INITIALIZER</code></a> to ensure that they cannot be confused with a valid pipe.</p>
</div>
<h2 id="closing-a-pipe"><a class="header" href="#closing-a-pipe">Closing a Pipe</a></h2>
<pre><code class="language-c">nng_err nng_pipe_close(nng_pipe p);
</code></pre>
<p>The <a name="a006"></a><code>nng_pipe_close</code> function closes the supplied pipe, <em>p</em>.
Messages that have been submitted for sending may be flushed or delivered,
depending upon the transport.</p>
<p>Further attempts to use the pipe after this call returns will result in <a href="api//api/errors.html#NNG_ECLOSED"><code>NNG_ECLOSED</code></a>.</p>
<div class="mdbook-alerts mdbook-alerts-tip">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  tip
</p>
<p>Pipes are automatically closed when their creator closes, or when the
remote peer closes the underlying connection.</p>
</div>
<h2 id="pipe-creator"><a class="header" href="#pipe-creator">Pipe Creator</a></h2>
<pre><code class="language-c">nng_dialer nng_pipe_dialer(nng_pipe p);
nng_listener nng_pipe_listener(nng_pipe p);
nng_socket nng_pipe_socket(nng_pipe p);
</code></pre>
<p><a name="a007"></a>
<a name="a008"></a>
<a name="a009"></a>
These functions return the <a href="api//TODO.html">socket</a>, <a href="api//TODO.html">dialer</a>, or <a href="api//TODO.html">listener</a> that created or owns the pipe.</p>
<p>If the pipe was does not have an associated dialer or listener, then the associated will
return [<code>NNG_DIALER_INITIALIZER</code>] or [<code>NNG_LISTENER_INITIALIZER</code>], as appropriate, and
either [<code>nng_dialer_id</code>] or [<code>nng_listener_id</code>] for the returned object will return -1.</p>
<div class="mdbook-alerts mdbook-alerts-note">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  note
</p>
<p>The socket, or the endpoint, returned by these functions may be in the process of closing,
and might not be further usable as a result. (Other functions will result in <a href="api//api/errors.html#NNG_ECLOSED"><code>NNG_ECLOSED</code></a>.)</p>
</div>
<h2 id="pipe-options"><a class="header" href="#pipe-options">Pipe Options</a></h2>
<pre><code class="language-c">nng_err nng_pipe_get_bool(nng_pipe p, const char *opt, bool *valp);
nng_err nng_pipe_get_int(nng_pipe p, const char *opt, int *valp);
nng_err nng_pipe_get_ms(nng_pipe p, const char *opt, nng_duration *valp);
nng_err nng_pipe_get_size(nng_pipe p, const char *opt, size_t *valp);
nng_err nng_pipe_get_addr(nng_pipe p, const char *opt, nng_sockaddr *valp);
nng_err nng_pipe_get_string(nng_pipe p, const char *opt, const char **valp);
nng_err nng_pipe_get_strcpy(nng_pipe p, const char *opt, char *val, size_t len);
nng_err nng_pipe_get_strdup(nng_pipe p, const char *opt, char **valp);
nng_err nng_pipe_get_strlen(nng_pipe p, const char *opt, size_t *lenp);
</code></pre>
<p><a name="a010"></a>
<a name="a011"></a>
<a name="a012"></a>
<a name="a013"></a>
<a name="a014"></a>
<a name="a015"></a>
<a name="a016"></a>
<a name="a017"></a>
These functions are used to obtain value of an option named <em>opt</em> from the pipe <em>p</em>, and store it in the location
referenced by <em>valp</em>.</p>
<p>These functions access an option as a specific type. The transport layer will have details about which options
are available, and which type they may be accessed using.</p>
<p>In the case of <code>nng_pipe_get_string</code>, the underlying string may only be valid for as long as the pipe is valid.
Thus, this function can only be safely called in a pipe event callback set up with <a href="api//api/pipe.html#pipe-notifications"><code>nng_pipe_notify</code></a>.</p>
<p>The <code>nng_pipe_get_strdup</code> function is like <code>nng_pipe_get_string</code>, but makes a copy into a newly allocated buffer, so that the string must be freed by the caller using <a href="api//api/memory.html#free-string"><code>nng_strfree</code></a>.</p>
<p>The <code>nng_pipe_get_strcpy</code> function is also like <code>nng_pipe_get_string</code>, but it makes a copy into a buffer
supplied by the caller. The buffer is passed in <em>val</em>, and the size of the buffer is passed in <em>len</em>.
The value of <em>len</em> must be large enough to hold the string and the terminating zero byte.</p>
<p>The <code>nng_pipe_get_strlen</code> function is used to obtain the length of the string. This can be useful
to find the size of the buffer needed by the <code>nng_pipe_get_strcpy</code> function for a property.
Note that like <code>strlen</code>, this size does not account for the zero byte to terminate the string.</p>
<h2 id="pipe-notifications"><a class="header" href="#pipe-notifications">Pipe Notifications</a></h2>
<pre><code class="language-c">typedef enum {
        NNG_PIPE_EV_ADD_PRE,
        NNG_PIPE_EV_ADD_POST,
        NNG_PIPE_EV_REM_POST,
} nng_pipe_ev;

typedef void (*nng_pipe_cb)(nng_pipe, nng_pipe_ev, void *);

nng_err nng_pipe_notify(nng_socket s, nng_pipe_ev ev, nng_pipe_cb cb, void *arg);
</code></pre>
<p>The <a name="a018"></a><code>nng_pipe_notify</code> function registers the callback function <em>cb</em>
to be called whenever the pipe event specified by
<em>ev</em> occurs on the socket <em>s</em>.
The callback <em>cb</em> will be passed <em>arg</em> as its final argument.</p>
<p>A different callback may be supplied for each event.
Each event may have at most one callback registered.
Registering a callback implicitly unregisters any previously registered.</p>
<p>The following pipe events are supported:</p>
<div class="table-wrapper"><table><thead><tr><th>Event</th><th>Description</th></tr></thead><tbody>
<tr><td><a name="a019"></a><code>NNG_PIPE_EV_ADD_PRE</code><a name="NNG_PIPE_EV_ADD_PRE"></a></td><td>This event occurs after a connection and negotiation has completed, but before the pipe is added to the socket. If the pipe is closed (using <a href="api//api/pipe.html#closing-a-pipe"><code>nng_pipe_close</code></a>) at this point, the socket will never see the pipe, and no further events will occur for the given pipe.</td></tr>
<tr><td><a name="a020"></a><code>NNG_PIPE_EV_ADD_POST</code><a name="NNG_PIPE_EV_ADD_POST"></a></td><td>This event occurs after the pipe is fully added to the socket. Prior to this time, it is not possible to communicate over the pipe with the socket.</td></tr>
<tr><td><a name="a021"></a><code>NNG_PIPE_EV_REM_POST</code><a name="NNG_PIPE_EV_REM_POST"></a></td><td>This event occurs after the pipe has been removed from the socket. The underlying transport may be closed at this point, and it is not possible communicate using this pipe.</td></tr>
</tbody></table>
</div><div class="mdbook-alerts mdbook-alerts-warning">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  warning
</p>
<p>The callback <em>cb</em> function must <em>not</em> attempt to perform any
accesses to the socket, as it is called with a lock on the socket held!
Doing so would thus result in a deadlock.</p>
</div>
<div class="mdbook-alerts mdbook-alerts-tip">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  tip
</p>
<p>The callback <em>cb</em> may close a pipe for any reason by simply closing it using <a href="api//api/pipe.html#closing-a-pipe"><code>nng_pipe_close</code></a>.
For example, this might be done to prevent an unauthorized peer from connecting to the socket,
if an authorization check made during <code>NNG_PIPE_EV_ADD_PRE</code> fails.</p>
</div>
<div class="mdbook-alerts mdbook-alerts-note">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  note
</p>
<p>This function ignores invalid values for <em>ev</em>.</p>
</div>
<!-- Symbol cross reference -->
<!-- HTTP -->
<!-- Macros -->
<!-- Protocols -->
<!-- Transports -->
<!-- Concept index -->
<div style="break-before: page; page-break-before: always;"></div><style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="memory"><a class="header" href="#memory">Memory</a></h1>
<p>Managing <a name="a001"></a>memory and <a name="a002"></a>allocations is something that every C program has to deal with.
In the case of <em>NNG</em>, it can be more complicated because the underlying platform
code can provide different allocators that might not be compatible with the use
system allocator used by <code>malloc</code> and <code>free</code>.</p>
<h2 id="allocate-memory"><a class="header" href="#allocate-memory">Allocate Memory</a></h2>
<pre><code class="language-c">void *nng_alloc(size_t size);
</code></pre>
<p>The <a name="a003"></a><code>nng_alloc</code> function allocates a contiguous memory region of
at least <em>size</em> bytes, and returns a pointer to it.
The memory will be 64-bit aligned.
Note that the memory may have random data in it, just like with <code>malloc</code>.</p>
<p>If memory cannot be allocated for any reason, then <code>NULL</code> will be returned.
Applications that experience this should treat this like <a href="api//api/errors.html#NNG_ENOMEM"><code>NNG_ENOMEM</code></a>.</p>
<p>Memory returned by <code>nng_alloc</code> should be freed when no longer needed using <a href="api//api/memory.html#deallocate-memory"><code>nng_free</code></a>.</p>
<div class="mdbook-alerts mdbook-alerts-important">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  important
</p>
<p>Do not use the system <code>free</code> function (or the C++ <code>delete</code> operator) to release this memory.
On some configurations this may work, but on others it will lead to a crash or
other unpredictable behavior.</p>
</div>
<h2 id="deallocate-memory"><a class="header" href="#deallocate-memory">Deallocate Memory</a></h2>
<pre><code class="language-c">void nng_free(void *ptr, size_t size);
</code></pre>
<p>The <a name="a004"></a><code>nng_free</code> function deallocates memory previously allocated by <a href="api//api/memory.html#allocate-memory"><code>nng_alloc</code></a>.</p>
<p>The <em>size</em> argument must exactly match the <em>size</em> argument that was supplied to
<a href="api//api/memory.html#allocate-memory"><code>nng_alloc</code></a> when the memory was allocated.</p>
<h2 id="duplicate-string"><a class="header" href="#duplicate-string">Duplicate String</a></h2>
<pre><code class="language-c">char *nng_strdup(const char *src);
</code></pre>
<p>The <a name="a005"></a><code>nng_strdup</code> duplicates the string <em>src</em> and returns it.</p>
<p>This is logically equivalent to using <a href="api//api/memory.html#allocate-memory"><code>nng_alloc</code></a>
to allocate a region of memory of <code>strlen(s) + 1</code> bytes, and then
using <code>strcpy</code> to copy the string into the destination before
returning it.</p>
<p>The returned string should be deallocated with
<a href="api//api/memory.html#free-string"><code>nng_strfree</code></a>, or may be deallocated using the
<a href="api//api/memory.html#deallocate-memory"><code>nng_free</code></a> using the length of the returned string plus
one (for the <code>NUL</code> terminating byte).</p>
<h2 id="free-string"><a class="header" href="#free-string">Free String</a></h2>
<pre><code class="language-c">void nng_strfree(char *str);
</code></pre>
<p>The <a name="a006"></a><code>nng_strfree</code> function is a convenience function that
can be used to deallocate strings allocated with <a href="api//api/memory.html#duplicate-string"><code>nng_strdup</code></a>.</p>
<p>It is effectively the same as <code>nng_free(strlen(str) + 1)</code>.</p>
<!-- Symbol cross reference -->
<!-- HTTP -->
<!-- Macros -->
<!-- Protocols -->
<!-- Transports -->
<!-- Concept index -->
<div style="break-before: page; page-break-before: always;"></div><style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="time"><a class="header" href="#time">Time</a></h1>
<p><em>NNG</em> supports has support for time in the form of access to a
system clock, and supporting timeouts for certain operations.</p>
<h2 id="time-type"><a class="header" href="#time-type">Time Type</a></h2>
<pre><code class="language-c">typedef uint64_t nng_time;
</code></pre>
<p>The <a name="a001"></a><code>nng_time</code> type is used to represent a clock offset from a common base time,
measured in milliseconds.</p>
<p>The reference, or zero value, is some arbitrary point in time, most often system boot, but can
be process start time or any other convenient reference.</p>
<p>All threads within a process will use the same reference time, but be aware that different processes
may use a different reference time.</p>
<h2 id="duration-type"><a class="header" href="#duration-type">Duration Type</a></h2>
<pre><code class="language-c">typedef int64_t nng_duration;

#define NNG_DURATION_INFINITE (-1)
#define NNG_DURATION_DEFAULT  (-2)
#define NNG_DURATION_ZERO     (0)
</code></pre>
<p>The <a name="a002"></a><code>nng_duration</code> time measures a time <a name="a003"></a>duration in milliseconds.
Normally durations are positive, but some specific negative values are reserved.</p>
<ul>
<li>
<p><a name="a004"></a><code>NNG_DURATION_INFINITE</code>: The duration essentially means forever.
This is most often used with a timeout to indicate that there is no timeout, the
operation should wait until it is complete, even forever.</p>
</li>
<li>
<p><a name="a005"></a><code>NNG_DURATION_DEFAULT</code>: This special value is used in some circumstances to
prevent overriding a default timeout. Some operations have a default maximum time,
and this value means that the previously established default should be used.
The precise meaning is context-specific.</p>
</li>
<li>
<p><a name="a006"></a><code>NNG_DURATION_ZERO</code>: A zero length duration is used to performan an immediate
poll.</p>
</li>
</ul>
<h2 id="get-the-current-time"><a class="header" href="#get-the-current-time">Get the Current Time</a></h2>
<pre><code class="language-c">nng_time nng_clock(void);
</code></pre>
<p>The <a name="a007"></a><code>nng_clock</code><a name="a008"></a> function returns the number of elapsed
milliseconds since some arbitrary time in the past.
The resolution of the clock depends on the underlying timing facilities of the system.
This function may be used for timing, but applications should not expect
very fine-grained values.</p>
<h2 id="wait-for-duration"><a class="header" href="#wait-for-duration">Wait for Duration</a></h2>
<pre><code class="language-c">void nng_msleep(nng_duration msec);
</code></pre>
<p>The <a name="a009"></a><code>nng_msleep</code> function blocks the calling thread for at least the specified
number of milliseconds.</p>
<div class="mdbook-alerts mdbook-alerts-tip">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  tip
</p>
<p>This function may block for longer than requested.
The actual wait time is determined by the capabilities of the
underlying system.</p>
</div>
<h2 id="wait-asynchronously"><a class="header" href="#wait-asynchronously">Wait Asynchronously</a></h2>
<pre><code class="language-c">void nng_sleep_aio(nng_duration msec, nng_aio *aio);
</code></pre>
<p>It is possible to wait as the action on an <a href="api//api/aio.html#asynchronous-io-handle"><code>nng_aio</code></a>, which in effect
acts like <a name="a010"></a>scheduling a callback to run after a specified period of time.</p>
<p>The <a name="a011"></a><code>nng_sleep_aio</code> function provides this capability.
After <em>msec</em> milliseconds have passed, then <em>aio</em>’s callback will be executed.
If this sleep waits without interruption, and then completes, the result from
<a href="api//api/aio.html#result-of-operation"><code>nng_aio_result</code></a> will be zero.</p>
<div class="mdbook-alerts mdbook-alerts-note">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  note
</p>
<p>If a timeout shorter than <em>msec</em> is set on <em>aio</em> using <a href="api//api/aio.html#set-timeout"><code>nng_aio_set_timeout</code></a>,
then the sleep will wake up early, with a result code of <a href="api//api/errors.html#NNG_ETIMEDOUT"><code>NNG_ETIMEDOUT</code></a>.</p>
</div>
<h2 id="see-also"><a class="header" href="#see-also">See Also</a></h2>
<p><a href="api//api/aio.html">Asynchronous Operations</a>,
<a href="api//api/synch.html">Synchronization</a></p>
<!-- Symbol cross reference -->
<!-- HTTP -->
<!-- Macros -->
<!-- Protocols -->
<!-- Transports -->
<!-- Concept index -->
<div style="break-before: page; page-break-before: always;"></div><style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="urls"><a class="header" href="#urls">URLs</a></h1>
<p><a name="a001"></a>Universal Resource Locators, or <a name="a002"></a>URLs for short, are a standardized
way of representing a network resource,
defined in <a href="https://datatracker.ietf.org/doc/html/rfc1738">RFC 1738</a>,
and <a href="https://datatracker.ietf.org/doc/html/rfc3986">RFC 3968</a>.</p>
<p>In Scalability Protocols, this concept is extended, although it includes schemes
that are not part of the IETF standards.</p>
<h2 id="url-structure"><a class="header" href="#url-structure">URL Structure</a></h2>
<pre><code class="language-c">typedef struct nng_url nng_url;

const char *nng_url_scheme(const nng_url *url);
const char *nng_url_userinfo(const nng_url *url);
const char *nng_url_hostname(const nng_url *url);
uint32_t    nng_url_port(const nng_url *url);
const char *nng_url_path(const nng_url *url);
const char *nng_url_query(const nng_url *url);
const char *nng_url_fragment(const nng_url *url):
</code></pre>
<h3 id="url-fields"><a class="header" href="#url-fields">URL Fields</a></h3>
<p>The <a name="a003"></a><code>nng_url_scheme</code> function returns the scheme,
without any colons or slashes. Values are lower case
strings, like “http” or “inproc” or “tls+tcp4”.</p>
<p>The <a name="a004"></a><code>nng_url_userinfo</code> function returns a string corresponding
to the user component of a URL (the part before any <code>@</code> sign) if such
a component is present, otherwise it returns <code>NULL</code>.</p>
<p>The <a name="a005"></a><code>nng_url_hostname</code> function returns a hostname (which might
actually be an IP address) from the URL, if the URL corresponds to a scheme
that uses hostnames (like “http” or “tcp”). If the URL does not (for example
“inproc” or “ipc” URLs) then it returns <code>NULL</code>.</p>
<p>The <a name="a006"></a><code>nng_url_port</code> function returns the TCP or UDP port number if the URL
corresponds to a protocol based on TCP or UDP. It returns zero otherwise.
Note that the port number might not have been explicitly specified in the URL.
For example, the port number associated with “http://www.example.com” is 80,
which is the standard port number for HTTP.</p>
<div class="mdbook-alerts mdbook-alerts-tip">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  tip
</p>
<p>The port number returned by this is in the native machine byte order.
Be careful when using this with other network-oriented APIs.</p>
</div>
<p>The <a name="a007"></a><code>nng_url_path</code> function returns the path component of the URL.
This will always be non-<code>NULL</code>, but it may be empty.</p>
<p>The <a name="a008"></a><code>nng_url_query</code> and <a name="a009"></a><code>nng_url_fragment</code> functions return
the query-information (the part following a ‘?’) and fragment
(the part following a ‘#’) if those components are present, or <code>NULL</code>
if they are not. The returned string will not include the leading ‘?’ or ‘#’
characters.</p>
<p>Note that any strings returned by these functions are only valid until
<em>url</em> is freed with <a href="api//api/url.html#destroy-a-url"><code>nng_url_free</code></a>.</p>
<h2 id="format-a-url"><a class="header" href="#format-a-url">Format a URL</a></h2>
<pre><code class="language-c">int nng_url_sprintf(char *buf, size_t bufsz, const nng_url *url);
</code></pre>
<p>The <a name="a010"></a><code>nng_url_sprintf</code> function formats the <em>url</em> to the <em>buf</em>,
which must have <code>bufsz</code> bytes of free space associated with it.</p>
<p>This function returns the number of bytes formatted to <em>buf</em>, excludng
the terminating zero byte, or if <em>bufsz</em> is too small, then it returns
the number of bytes that would have been formatted if there was sufficient
space. The semantics are similar to the <code>snprintf</code> function from C99.</p>
<div class="mdbook-alerts mdbook-alerts-tip">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  tip
</p>
<p>If <em>bufsz</em> is 0, then <em>buf</em> can be <code>NULL</code>, and the return value
can be used to determine the amount of space to allocate for a dynamically
sized buffer.</p>
</div>
<h2 id="parse-a-url"><a class="header" href="#parse-a-url">Parse a URL</a></h2>
<pre><code class="language-c">int nng_url_parse(nng_url **urlp, const char *str);
</code></pre>
<p>The <a name="a011"></a><code>nng_url_parse</code> function parses a URL string (in <em>str</em>),
and creates a dynamically allocated <code>nng_url</code>, returning it in <em>urlp</em>.</p>
<div class="mdbook-alerts mdbook-alerts-important">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  important
</p>
<p>Only <a href="api//api/url.html#destroy-a-url"><code>nng_url_free</code></a> should be used to deallocate <code>nng_url</code> objects.</p>
</div>
<h2 id="clone-a-url"><a class="header" href="#clone-a-url">Clone a URL</a></h2>
<pre><code class="language-c">int nng_url_clone(nng_url **dup, const nng_url *url);
</code></pre>
<p>The <a name="a012"></a><code>nng_url_clone</code> function creates a copy of <em>url</em>, and returns it in <em>dup</em>.</p>
<h2 id="destroy-a-url"><a class="header" href="#destroy-a-url">Destroy a URL</a></h2>
<pre><code class="language-c">void nng_url_free(nng_url *url);
</code></pre>
<p>The <a name="a013"></a><code>nng_url_free</code> function destroy an <code>nng_url</code> object created with
either <a href="api//api/url.html#parse-a-url"><code>nng_url_parse</code></a> or <a href="api//api/url.html#destroy-a-url"><code>nng_url_free</code></a>.</p>
<p>This is the only correct way to destroy an <a href="api//api/url.html#url-structure"><code>nng_url</code></a> object.</p>
<h2 id="update-a-url-port"><a class="header" href="#update-a-url-port">Update a URL Port</a></h2>
<pre><code class="language-c">void nng_url_resolve_port(nng_url *url, uint32_t port);
</code></pre>
<p>In order to use dynamic port allocation, some transports and schemes allow a port number of zero
to be specified. When this is done, the system will allocate a free port when the port is bound
while starting a listener. Once this is done, the port number may need to be updated so that the
URL can be used to configure a client. The <a name="a014"></a><code>nng_url_resolve_port</code> function updates such
a URL with a new port. This will have no effect if the URL already has a non-zero port number.</p>
<h2 id="see-also-1"><a class="header" href="#see-also-1">See Also</a></h2>
<p>More information about Universal Resource Locators can be found in
<a href="https://tools.ietf.org/html/rfc3986">RFC 3986</a>.</p>
<!-- Symbol cross reference -->
<!-- HTTP -->
<!-- Macros -->
<!-- Protocols -->
<!-- Transports -->
<!-- Concept index -->
<div style="break-before: page; page-break-before: always;"></div><style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="asynchronous-operations"><a class="header" href="#asynchronous-operations">Asynchronous Operations</a></h1>
<p>In order to obtain significant scalability, with low-latency, and minimal
overheads, <em>NNG</em> supports performing operations asynchronously.</p>
<p>One way that applications can perform work asynchronously and concurrently
is by using <a href="api//api/thread.html">threads</a>, but threads carry significant resource overheads
and frequently there are limits on the number that can easily be created.</p>
<p>Additionally, with most network applications, the flow of execution will spend
the bulk of its time waiting for traffic from a peer.</p>
<p>For these kinds of applications, it is far more efficient to use asynchronous operations
using the mechanisms described in this chapter.</p>
<div class="mdbook-alerts mdbook-alerts-tip">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  tip
</p>
<p>To get the highest performance with the least overhead, applications should use
asynchronous operations described in this chapter whenever possible.</p>
</div>
<h2 id="asynchronous-io-handle"><a class="header" href="#asynchronous-io-handle">Asynchronous I/O Handle</a></h2>
<pre><code class="language-c">typedef struct nng_aio nng_aio;
</code></pre>
<p>An <a name="a001"></a><code>nng_aio</code><a name="a002"></a> is an opaque structure used in conjunction with
<a name="a003"></a>asynchronous I/O operations.
Every asynchronous operation uses one of these structures, each of which
can only be used with a single operation at a time.</p>
<p>Asynchronous operations are performed without blocking calling application threads.
Instead the application registers a callback function to be executed
when the operation is complete (whether successfully or not).
This callback will be executed exactly once.</p>
<p>The asynchronous I/O framework also supports <a href="api//api/aio.html#cancellation">cancellation</a> of
operations that are already in progress as well setting a maximum
<a href="api//api/aio.html#set-timeout">timeout</a> for them to complete.</p>
<p>It is also possible to initiate an asynchronous operation, and <a href="api//api/aio.html#wait-for-completion">wait</a> for it to
complete, creating a synchronous flow from an asynchronous one.</p>
<h2 id="create-handle"><a class="header" href="#create-handle">Create Handle</a></h2>
<pre><code class="language-c">nng_err nng_aio_alloc(nng_aio **aiop, void (*callb)(void *), void *arg);
</code></pre>
<p>The <a name="a004"></a><code>nng_aio_alloc</code> function creates an <a href="api//api/aio.html#asynchronous-io-handle"><code>nng_aio</code></a> object, with the
<a name="a005"></a>callback <em>callb</em> taking the argument <em>arg</em>, and returns it in <em>aiop</em>.</p>
<p>If this succeeds, the function returns zero. Otherwise it may return <a href="api//api/errors.html#NNG_ENOMEM"><code>NNG_ENOMEM</code></a>.</p>
<div class="mdbook-alerts mdbook-alerts-tip">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  tip
</p>
<p>The <em>arg</em> should normally be a structure that contains a pointer to the <em>aiop</em>,
or from which it can be located. This allows <em>callb</em> to check the handle for
success using <a href="api//api/aio.html#result-of-operation"><code>nng_aio_result</code></a>, as well access other properties of <em>aiop</em>.</p>
</div>
<div class="mdbook-alerts mdbook-alerts-tip">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  tip
</p>
<p>The <em>callb</em> may be executed on another <a href="api//api/thread.html">thread</a>, so it may be necessary to use
<a href="api//api/synch.html">synchronization</a> methods in <em>callb</em> to avoid data races.</p>
</div>
<h2 id="destroy-handle"><a class="header" href="#destroy-handle">Destroy Handle</a></h2>
<pre><code class="language-c">void nng_aio_free(nng_aio *aio);
void nng_aio_reap(nng_aio *aio);
</code></pre>
<p>The <a name="a006"></a><code>nng_aio_free</code> handle destroys the handle <em>aio</em>, waiting for any operations
and associated callbacks to complete before doing so.</p>
<p>The <a name="a007"></a><code>nng_aio_reap</code> handle destroys the handle <em>aio</em> asynchronously, using a <em>reaper</em>
<a href="api//api/thread.html">thread</a> to do so. It does not wait for the object to be destroyed. Thus this function
is safe to call from <em>aio</em>’s own callback.</p>
<div class="mdbook-alerts mdbook-alerts-note">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  note
</p>
<p>The <code>nng_aio_free</code> function must never be called from an <em>aio</em> callback.
Use <code>nng_aio_reap</code> instead if an object must be destroyed from a callback.</p>
</div>
<h2 id="cancellation"><a class="header" href="#cancellation">Cancellation</a></h2>
<pre><code class="language-c">void nng_aio_abort(nng_aio *aio, nng_err err);
void nng_aio_cancel(nng_aio *aio);
void nng_aio_stop(nng_aio *aio);
</code></pre>
<p>These functions are used to stop a previously submitted asynchronous
I/O operation. The operation may be canceled, or may continue to
completion. If no operation is in progress (perhaps because it has
already completed), then these operations have no effect.
If the operation is successfully canceled or aborted, then the callback
will still be called.</p>
<p>The <a name="a008"></a><code>nng_aio_abort</code> function aborts the operation associated with <em>aio</em>
and returns immediately without waiting. If cancellation was successful,
then <a href="api//api/aio.html#result-of-operation"><code>nng_aio_result</code></a> will return <em>err</em>.</p>
<p>The <a name="a009"></a><code>nng_aio_cancel</code> function acts like <code>nng_aio_abort</code>, but uses the error code
<a href="api//api/errors.html#NNG_ECANCELED"><code>NNG_ECANCELED</code></a><a name="a010"></a>.</p>
<p>The <a name="a011"></a><code>nng_aio_stop</code> function aborts the <em>aio</em> operation with <a href="api//api/errors.html#NNG_ESTOPPED"><code>NNG_ESTOPPED</code></a>,
and then waits the operation and any associated callback to complete.
This function also marks <em>aio</em> itself permanently stopped, so that any
new operations scheduled by I/O providers using <a href="api//TODO.html"><code>nng_aio_start</code></a>
return false. Thus this function should be used to teardown operations.</p>
<div class="mdbook-alerts mdbook-alerts-tip">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  tip
</p>
<p>When multiple asynchronous I/O handles are in use and need to be
deallocated, it is safest to stop all of them using <code>nng_aio_stop</code>,
before deallocating any of them with <a href="api//api/aio.html#destroy-handle"><code>nng_aio_free</code></a>,
particularly if the callbacks might attempt to reschedule further operations.</p>
</div>
<h2 id="set-timeout"><a class="header" href="#set-timeout">Set Timeout</a></h2>
<pre><code class="language-c">void nng_aio_set_timeout(nng_aio *aio, nng_duration timeout);
void nng_aio_set_expire(nng_aio *aio, nng_time expiration);
</code></pre>
<p>The <code>nng_aio_set_timeout</code> function sets a <a name="a012"></a><em>timeout</em>
for the asynchronous operation associated with <em>aio</em>.
This causes a timer to be started when the operation is actually started.
If the timer expires before the operation is completed, then it is
<a href="api//api/aio.html#cancellation">aborted</a> with an error of <code>NNG_ETIMEDOUT</code>.
The <em>timeout</em> <a href="api//api/time.html">duration</a> is specified as a relative number of milliseconds.</p>
<p>If the timeout is <a href="api//api/time.html#duration-type"><code>NNG_DURATION_INFINITE</code></a>, then no timeout is used.
If the timeout is <a href="api//api/time.html#duration-type"><code>NNG_DURATION_DEFAULT</code></a>, then a “default” or socket-specific
timeout is used.
(This is frequently the same as <a href="api//api/time.html#duration-type"><code>NNG_DURATION_INFINITE</code></a>.)</p>
<p>The <a name="a013"></a><code>nng_aio_set_expire</code> function is similar to <code>nng_aio_set_timeout</code>, but sets
an expiration time based on the system clock. The <em>expiration</em>
<a href="api//api/time.html">time</a> is a clock timestamp, such as would be returned by <a href="api//api/time.html#get-the-current-time"><code>nng_clock</code></a>.</p>
<h2 id="wait-for-completion"><a class="header" href="#wait-for-completion">Wait for Completion</a></h2>
<pre><code class="language-c">void nng_aio_wait(nng_aio *aio);
</code></pre>
<p>The <a name="a014"></a><code>nng_aio_wait</code> function waits for an asynchronous I/O operation to complete.
If the operation has not been started, or has already completed, then it returns immediately.</p>
<p>If a callback was set with <em>aio</em> when it was allocated, then this
function will not be called until the callback has completed.</p>
<div class="mdbook-alerts mdbook-alerts-important">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  important
</p>
<p>The <code>nng_aio_wait</code> function should never be called from a function that itself
is a callback of an <a href="api//api/aio.html#asynchronous-io-handle"><code>nng_aio</code></a>, either this one or any other.
Doing so may result in a deadlock.</p>
</div>
<h2 id="test-for-completion"><a class="header" href="#test-for-completion">Test for Completion</a></h2>
<pre><code class="language-c">bool nng_aio_busy(nng_aio *aio);
</code></pre>
<p>The <a name="a015"></a><code>nng_aio_busy</code> function returns <code>true</code> if the <em>aio</em> is currently busy performing an
operation or is executing a completion callback. Otherwise it return <code>false</code>.
This is the same test used internally by <a href="api//api/aio.html#wait-for-completion"><code>nng_aio_wait</code></a>.</p>
<div class="mdbook-alerts mdbook-alerts-important">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  important
</p>
<p>The caller is responsible for coordinating any use of this with any reuse of the <em>aio</em>.
Because the <em>aio</em> can be reused use of this function can be racy.</p>
</div>
<h2 id="result-of-operation"><a class="header" href="#result-of-operation">Result of Operation</a></h2>
<pre><code class="language-c">nng_err nng_aio_result(nng_aio *aio);
size_t nng_aio_count(nng_aio *aio);
</code></pre>
<p>The <a name="a016"></a><code>nng_aio_result</code> function returns the result of the operation associated
with the handle <em>aio</em>.
If the operation was successful, then 0 is returned.
Otherwise a non-zero <a href="api//api/errors.html">error</a> code, such as <a href="api//api/errors.html#NNG_ECANCELED"><code>NNG_ECANCELED</code></a> or <a href="api//api/errors.html#NNG_ETIMEDOUT"><code>NNG_ETIMEDOUT</code></a>, is returned.</p>
<p>For operations that transfer data, <a name="a017"></a><code>nng_aio_count</code> returns the
number of bytes transferred by the operation associated with the handle <em>aio</em>.
Operations that do not transfer data, or do not keep a count, may return zero for this function.</p>
<div class="mdbook-alerts mdbook-alerts-note">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  note
</p>
<p>The return value from these functions is undefined if the operation has not completed yet.
Either call these from the handle’s completion callback, or after waiting for the
operation to complete with <a href="api//api/aio.html#wait-for-completion"><code>nng_aio_wait</code></a>.</p>
</div>
<h2 id="messages-1"><a class="header" href="#messages-1">Messages</a></h2>
<pre><code class="language-c">nng_msg *nng_aio_get_msg(nng_aio *aio);
void nng_aio_set_msg(nng_aio *aio, nng_msg *msg);
</code></pre>
<p>The <a name="a018"></a><code>nng_aio_get_msg</code> and <a name="a019"></a><code>nng_aio_set_msg</code> functions retrieve and store a <a href="api//api/msg.html">message</a>
in <em>aio</em>.
For example, if a function to receive data is called, that function can generally be expected
to store a message on the associated <em>aio</em>, for the application to retrieve with
<code>nng_aio_get_msg</code>.
Conversely an application desiring to send a message <em>msg</em> will store it in the <em>aio</em> using
<code>nng_aio_set_msg</code>. The function implementing the send operation will retrieve the message
and arrange for it to be sent.</p>
<h3 id="message-ownership"><a class="header" href="#message-ownership">Message Ownership</a></h3>
<p>For send or transmit operations, the rule of thumb is that implementation of the operation
is responsible for taking ownership of the message (and releasing resources when it is complete),
if it will return success. If the operation will end in error, then the message will be
retained and it is the consuming application’s responsibility to dispose of the message.
This allows an application the opportunity to reuse the message to try again, if it so desires.</p>
<p>For receive operations, the implementation of the operation will set the message on the <em>aio</em>
on success, and the consuming application hasa responsibility to retrieve and dispose of the
message. Failure to do so will leak the message. If the operation does not complete successfully,
then no message is stored on the <em>aio</em>.</p>
<h2 id="io-vector"><a class="header" href="#io-vector">I/O Vector</a></h2>
<pre><code class="language-c">typedef struct nng_iov {
    void * iov_buf;
    size_t iov_len;
};

int nng_aio_set_iov(nng_aio *aio, unsigned int niov, nng_iov *iov);
</code></pre>
<p>For some operations, the unit of data transferred is not a <a href="api//api/msg.html">message</a>, but
rather a stream of bytes.</p>
<p>For these operations, an array of <em>niov</em> <a name="a020"></a><code>nng_iov</code> structures can be passed to
the <a name="a021"></a><code>nng_aio_set_iov</code> function to provide a scatter/gather array of
elements describing the location (<code>iov_buf</code>) and length (<code>iov_len</code>) of data,
to transfer.</p>
<p>The <em>iov</em> vector is copied into storage in the <em>aio</em> itself, so that callers may use stack allocated <code>nng_iov</code> structures.
The values pointed to by the <code>iov_buf</code> members are <em>not</em> copied by this function though.</p>
<p>A maximum of four (4) <code>nng_iov</code> members may be supplied.</p>
<div class="mdbook-alerts mdbook-alerts-tip">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  tip
</p>
<p>Most functions using <code>nng_iov</code> do not guarantee to transfer all of the data that they
are requested to. To be sure that correct amount of data is transferred, as well as to
start an attempt to complete any partial transfer, check the amount of data transferred by
calling <a href="api//api/aio.html#result-of-operation"><code>nng_aio_count</code></a>.</p>
</div>
<h2 id="inputs-and-outputs"><a class="header" href="#inputs-and-outputs">Inputs and Outputs</a></h2>
<pre><code class="language-c">void nng_aio_set_input(nng_aio *aio, unsigned int index, void *param);
void *nng_aio_get_output(nng_aio *aio, unsigned int index);
</code></pre>
<p>Asynchronous operations can take additional input parameters, and
provide additional result outputs besides the <a href="api//api/aio.html#result-of-operation">result</a> code.</p>
<p>The <code>nng_aio_set_input</code> function sets the input parameter at <em>index</em>
to <em>param</em> for the operation associated with <em>aio</em>.</p>
<p>The <code>nng_aio_get_output</code> function returns the output result at <em>index</em>
for the operation associated with <em>aio</em>.</p>
<p>The type and semantics of input parameters and output results are determined by specific
operations. The documentation for the operation should provide details.</p>
<p>The valid values of <em>index</em> range from zero (0) to three (3), as no operation
currently defined can accept more than four parameters or return more than four additional
results.</p>
<div class="mdbook-alerts mdbook-alerts-note">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  note
</p>
<p>If the <em>index</em> does not correspond to a defined input for the operation,
then <code>nng_aio_set_input</code> will have no effect, and <code>nng_aio_get_output</code> will
return <code>NULL</code>.</p>
</div>
<div class="mdbook-alerts mdbook-alerts-important">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  important
</p>
<p>It is an error to call this function while the <em>aio</em> is currently
in use by an active asynchronous operation.</p>
</div>
<h2 id="scatter-gather-vectors"><a class="header" href="#scatter-gather-vectors">Scatter Gather Vectors</a></h2>
<pre><code class="language-c">typedef struct nng_iov {
	void  *iov_buf;
	size_t iov_len;
} nng_iov;

void nng_aio_set_iov(nng_aio *aio, unsigned nio, const nng_iov *iov);
</code></pre>
<p><a name="a022"></a>
Some asynchronous operations, such as those dealing with <a href="api//api/stream.html">streams</a>, use <a name="a023"></a>scatter or <a name="a024"></a>gather
vectors, where data to be transferred is either gathered from multiple separate regions of memory, or
scattered into separate regions of memory. For example a message may have a header located at one location
in memory, and a payload located in another.</p>
<p>The <a name="a025"></a><code>nng_aio_set_iov</code> function configures the <em>aio</em> to use <em>nio</em> separate segments, described by
the elements in <em>iov</em>. For each of these, the segment of size <em>iov_len</em> located at <em>iov_buf</em> will be used.</p>
<p>The elements of <em>iov</em> will be copied into <em>aio</em>, so the vector may be located
on the stack or another temporary location. The locations referenced by it, <em>must</em> remain valid for
the duration of the operation, of course.</p>
<p>Note that many of these operations are not guaranteed to perform a full transfer of data, so even a
successful operation should check the amount of data actually transferred using <a href="api//api/aio.html#result-of-operation"><code>nng_aio_count</code></a>,
and if necessary resubmit the operation with a suitably updated vector of <code>nng_iov</code> using this function.</p>
<h2 id="see-also-2"><a class="header" href="#see-also-2">See Also</a></h2>
<p><a href="api//api/synch.html">Synchronization</a>,
<a href="api//api/thread.html">Threads</a>,
<a href="api//api/stream.html">Streams</a>,
<a href="api//api/time.html">Time</a></p>
<!-- Symbol cross reference -->
<!-- HTTP -->
<!-- Macros -->
<!-- Protocols -->
<!-- Transports -->
<!-- Concept index -->
<div style="break-before: page; page-break-before: always;"></div><style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="synchronization-primitives"><a class="header" href="#synchronization-primitives">Synchronization Primitives</a></h1>
<p>In order to allow safely accessing shared state, or to allow coordination between
different <a href="api//api/thread.html">threads</a>, <em>NNG</em> provides <a name="a001"></a>synchronization primitives in the
form of mutual exclusion locks and condition variables.</p>
<p>Correct use of these primitives will be needed when accessing shared state from
threads, or from callback functions associated with <a href="api//api/aio.html">asynchronous operations</a>.
(The need to do this in callbacks is because the callback may be executed under
a task thread other than the submitting thread.)</p>
<h2 id="mutual-exclusion-lock"><a class="header" href="#mutual-exclusion-lock">Mutual Exclusion Lock</a></h2>
<pre><code class="language-c">typedef struct nng_mtx nng_mtx;
</code></pre>
<p>Mutual exclusion locks, or <a name="a002"></a>mutex locks, represented by the <a name="a003"></a><code>nng_mtx</code> structure,
allow only a single <a href="api//api/thread.html">thread</a> to lock “own” the lock, acquired by <a href="api//api/synch.html#acquiring-a-mutex"><code>nng_mtx_lock</code></a>.
Any other thread trying to acquire the same mutex will wait until the owner has released the mutex
by calling <a href="api//api/synch.html#releasing-a-mutex"><code>nng_mtx_unlock</code></a>.</p>
<h3 id="creating-a-mutex"><a class="header" href="#creating-a-mutex">Creating a Mutex</a></h3>
<pre><code class="language-c">int nng_mutx_alloc(nng_mt **mtxp);
</code></pre>
<p>A mutex can be created by allocating one with <a name="a004"></a><code>nng_mtx_lock</code>.
On success, a pointer to the mutex is returned through <em>mtxp</em>.
This function can fail due to insufficient memory or resources, in which
case it will return <a href="api//api/errors.html#NNG_ENOMEM"><code>NNG_ENOMEM</code></a>. Otherwise it will succeed and return zero.</p>
<h3 id="destroying-a-mutex"><a class="header" href="#destroying-a-mutex">Destroying a Mutex</a></h3>
<pre><code class="language-c">void nng_mtx_free(nng_mtx *mtx);
</code></pre>
<p>When no longer needed, a mutex can be deallocated and its resources returned
to the caller, by calling <a name="a005"></a><code>nng_mtx_free</code>. The mutex must not be locked
by any <a href="api//api/thread.html">thread</a> when calling this function.</p>
<h3 id="acquiring-a-mutex"><a class="header" href="#acquiring-a-mutex">Acquiring a Mutex</a></h3>
<pre><code class="language-c">void nng_mtx_lock(nng_mtx *mtx);
</code></pre>
<p>The <a name="a006"></a><code>nng_mtx_lock</code> function acquires ownership of a mutex, waiting for it to
unowned by any other threads if necessary.</p>
<div class="mdbook-alerts mdbook-alerts-important">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  important
</p>
<p>A thread must not attempt to reqacuire the same mutex while it already “owns” the mutex.
If it does attempt to do so, the result will be a single party deadlock.</p>
</div>
<h3 id="releasing-a-mutex"><a class="header" href="#releasing-a-mutex">Releasing a Mutex</a></h3>
<pre><code class="language-c">void nng_mtx_unlock(nng_mtx *mtx);
</code></pre>
<p>The <a name="a007"></a><code>nng_mtx_unlock</code> function releases a mutex that the calling thread has previously
acquired with <a href="api//api/synch.html#acquiring-a-mutex"><code>nng_mtx_lock</code></a>.</p>
<div class="mdbook-alerts mdbook-alerts-important">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  important
</p>
<p>A thread must not attempt to release (unlock) a mutex if it was not the thread
that acquired the mutex to begin with.</p>
</div>
<h2 id="condition-variable"><a class="header" href="#condition-variable">Condition Variable</a></h2>
<pre><code class="language-c">typedef struct nng_cv nng_cv;
</code></pre>
<p>The <a name="a008"></a><code>nng_cv</code> structure implements a <a name="a009"></a>condition variable, associated with the
the <a href="api//api/synch.html#mutual-exclusion-lock">mutex</a> <em>mtx</em> which was supplied when it was created.</p>
<p>Condition variables provide for a way to wait on an arbitrary condition, and to be woken
when the condition is signaled.
The mutex is dropped while the caller is asleep, and reacquired atomically when the caller
is woken.</p>
<div class="mdbook-alerts mdbook-alerts-important">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  important
</p>
<p>The caller of <code>nng_cv_until</code>, <code>nng_cv_wait</code>, <code>nng_cv_wake</code>, and <code>nng_cv_wake1</code> <em>must</em>
have ownership of the mutex <em>mtx</em> when calling these functions.</p>
</div>
<h3 id="creating-a-condition-variable"><a class="header" href="#creating-a-condition-variable">Creating a Condition Variable</a></h3>
<pre><code class="language-c">int nng_cv_alloc(nng_cv **cvp, nng_mtx *mtx);
</code></pre>
<p>The <a name="a010"></a><code>nng_cv_alloc</code> function allocates a condition variable, and associated with the mutex <em>mtx</em>,
and returns a pointer to it in <em>cvp</em>.</p>
<h3 id="destroy-a-condition-variable"><a class="header" href="#destroy-a-condition-variable">Destroy a Condition Variable</a></h3>
<pre><code class="language-c">void nng_cv_free(nng_cv *cv);
</code></pre>
<p>The <a name="a011"></a><code>nng_cv_free</code> function deallocates the condition variable <em>cv</em>.</p>
<h3 id="waiting-for-the-condition"><a class="header" href="#waiting-for-the-condition">Waiting for the Condition</a></h3>
<pre><code class="language-c">int nng_cv_until(nng_cv *cv, nng_time when);
void nng_cv_wait(nng_cv *cv);
</code></pre>
<p>The <a name="a012"></a><code>nng_cv_until</code> and <a name="a013"></a><code>nng_cv_wait</code> functions put the caller to sleep until the condition
variable <em>cv</em> is signaled, or (in the case of <code>nng_cv_until</code>), the specified time <em>when</em>
(as determined by <a href="api//api/time.html#get-the-current-time"><code>nng_clock</code></a> is reached.</p>
<p>While <code>nng_cv_wait</code> never fails and so has no return value, the <code>nng_cv_until</code> function can
return <a href="api//api/errors.html#NNG_ETIMEDOUT"><code>NNG_ETIMEDOUT</code></a> if the time is reached before condition <em>cv</em> is signaled by
either <a href="api//api/synch.html#signaling-the-condition"><code>nng_cv_wake</code></a> or <a href="api//api/synch.html#signaling-the-condition"><code>nng_cv_wake1</code></a>.</p>
<h3 id="signaling-the-condition"><a class="header" href="#signaling-the-condition">Signaling the Condition</a></h3>
<pre><code class="language-c">void nng_cv_wake(nng_cv *cv);
void nng_cv_wake1(nng_cv *cv);
</code></pre>
<p>The <a name="a014"></a><code>nng_cv_wake</code> and <a name="a015"></a><code>nng_cv_wake1</code> functions wake threads waiting in
<a href="api//api/synch.html#waiting-for-the-condition"><code>nng_cv_until</code></a> or <a href="api//api/synch.html#waiting-for-the-condition"><code>nng_cv_wait</code></a>.
The difference between these functions is that
<code>nng_cv_wake</code> will wake <em>every</em> thread, whereas <code>nng_cv_wake1</code> will wake up exactly
one thread (which may be chosen randomly).</p>
<div class="mdbook-alerts mdbook-alerts-tip">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  tip
</p>
<p>Use of <code>nng_cv_wake1</code> may be used to reduce the “<a name="a016"></a>thundering herd” syndrome of waking
all threads concurrently, but should only be used in circumstances where the application
does not depend on <em>which</em> thread will be woken. When in doubt, <code>nng_cv_wake</code> is safer.</p>
</div>
<h2 id="examples-3"><a class="header" href="#examples-3">Examples</a></h2>
<h3 id="example-1-allocating-the-condition-variable"><a class="header" href="#example-1-allocating-the-condition-variable">Example 1: Allocating the condition variable</a></h3>
<pre><code class="language-c">nng_mtx *m;
nng_cv *cv;
nng_mtx_alloc(&amp;m); // error checks elided
nng_cv_alloc(&amp;cv, m);
</code></pre>
<h3 id="example-2-waiting-for-the-condition"><a class="header" href="#example-2-waiting-for-the-condition">Example 2: Waiting for the condition</a></h3>
<pre><code class="language-c">expire = nng_clock() + 1000; // 1 second in the future
nng_mtx_lock(m);  // assume cv was allocated using m
while (!condition_true) {
  if (nng_cv_until(cv, expire) == NNG_ETIMEDOUT) {
    printf("Time out reached!\n");
    break;
  }
}
// condition_true is true
nng_mtx_unlock(m);
</code></pre>
<h3 id="example-3-signaling-the-condition"><a class="header" href="#example-3-signaling-the-condition">Example 3: Signaling the condition</a></h3>
<pre><code class="language-c">nng_mtx_lock(m);
condition_true = true;
nng_cv_wake(cv);
nng_mtx_unlock(m);
</code></pre>
<h2 id="see-also-3"><a class="header" href="#see-also-3">See Also</a></h2>
<p><a href="api//api/thread.html">Threads</a>,
<a href="api//api/time.html">Time</a>,
<a href="api//api/aio.html">Asynchronous I/O</a></p>
<!-- Symbol cross reference -->
<!-- HTTP -->
<!-- Macros -->
<!-- Protocols -->
<!-- Transports -->
<!-- Concept index -->
<div style="break-before: page; page-break-before: always;"></div><style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="threads"><a class="header" href="#threads">Threads</a></h1>
<p>Threads <a name="a001"></a> provide a means of representing multiple parallel execution contexts.
<em>NNG</em> makes use of this concept internally, but also provides for user applications
to utilize the same thread facilities. This allows one form of <a name="a002"></a>concurrency for
applications.</p>
<div class="mdbook-alerts mdbook-alerts-note">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  note
</p>
<p>Threads in <em>NNG</em> are built upon platform support, which may be based upon operating
system supplied threads, process, or coroutines. The appearance of concurrency does
not guarantee true concurrency, and scheduling between threads may not necessarily be
pre-emptive. While this will not adversely impact applications that use this facility
for I/O bound concurrency, it may not provide good results for purely <a name="a003"></a>CPU-bound operations.</p>
</div>
<div class="mdbook-alerts mdbook-alerts-important">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  important
</p>
<p>Thread objects created by this function may not be real system-level
threads capable of performing blocking I/O operations using normal blocking system calls.
If use of blocking system calls is required (not including APIs provided
by the <em>NNG</em> library itself of course), then real OS-specific threads
should be created instead (such as with <code>pthread_create</code> or similar functions.)
Blocking <em>NNG</em> library calls can however be made safely from <em>NNG</em> threads.</p>
</div>
<div class="mdbook-alerts mdbook-alerts-tip">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  tip
</p>
<p>The system may impose limits on the number of threads that can be created.
Typically applications should not create more than a dozen of these.
If greater concurrency or scalability is needed, consider instead using
an asynchronous model using <a href="api//api/aio.html#asynchronous-io-handle"><code>nng_aio</code></a> structures.</p>
</div>
<h2 id="thread-structure"><a class="header" href="#thread-structure">Thread Structure</a></h2>
<pre><code class="language-c">typedef struct nng_thread nng_thread;
</code></pre>
<p>The <a name="a004"></a><code>nng_thread</code> structure represents a thread, which is a single execution context.
A given thread will have its own stack, and CPU registers. However global state, as well
as values allocated on the heap, will be shared and accessible to all threads in the system
(See the <a href="api//api/synch.html">Synchronization</a> chapter for functions to help with data sharing between different threads.)</p>
<p>Multiple threads can be thought of as running concurrently, even though
they might not actually do so.</p>
<p>I/O operations that block (i.e. wait for completion) will block the
thread, while allowing other threads to proceed.</p>
<h2 id="creating-a-thread"><a class="header" href="#creating-a-thread">Creating a Thread</a></h2>
<pre><code class="language-c">int nng_thread_create(nng_thread **thrp, void (*func)(void *), void *arg);
</code></pre>
<p>The <a name="a005"></a><code>nng_thread_create</code> function creates a thread, which will execute <em>func</em>, with
the given argument <em>arg</em>, and returns a pointer to it in <em>thrp</em>.</p>
<p>The thread may begin execution immediately.</p>
<p>The thread will persist until <em>func</em> returns.</p>
<p>This function returns zero on success, but may return <code>NNG_ENOMEM</code> if insufficient
resources to create a thread are available.</p>
<h2 id="destroying-a-thread"><a class="header" href="#destroying-a-thread">Destroying a Thread</a></h2>
<pre><code class="language-c">void nng_thread_destroy(nng_thread *thr);
</code></pre>
<p>The <a name="a006"></a><code>nng_thread_destroy</code> function waits for the thread <em>thr</em> to finish execution.
This function should be called to reclaim any resources associated with the thread when done.
It also has the effect of blocking execution in the caller until <em>thr</em> has completed executing.</p>
<h2 id="thread-names"><a class="header" href="#thread-names">Thread Names</a></h2>
<pre><code class="language-c">void nng_thread_set_name(nng_thread *thr, const char *name);
</code></pre>
<p>In order to facilitate debugging, <a name="a007"></a><code>nng_thread_set_name</code> may be called
to provide a name for the thread. This may change how the thread is represented
in debuggers. Not all platforms support setting the thread name.</p>
<h2 id="see-also-4"><a class="header" href="#see-also-4">See Also</a></h2>
<p><a href="api//api/synch.html">Synchronization</a>,
<a href="api//api/aio.html">Asynchronous Operations</a></p>
<!-- Symbol cross reference -->
<!-- HTTP -->
<!-- Macros -->
<!-- Protocols -->
<!-- Transports -->
<!-- Concept index -->
<div style="break-before: page; page-break-before: always;"></div><style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="logging"><a class="header" href="#logging">Logging</a></h1>
<p>This chapter describes the support for message logs.
Both applications and <em>NNG</em> itself can emit logs, which can be useful
for application field support and debugging. Additionally applications
can customize the handling of this logging as needed.</p>
<p>Note that logging is disabled by default unless an application
configures a suitable logger with <a href="api/logging.html#log-handlers"><code>nng_log_set_logger</code></a>.</p>
<h2 id="submitting-logs"><a class="header" href="#submitting-logs">Submitting Logs</a></h2>
<pre><code class="language-c">void nng_log_err(const char *msgid, const char *msg, ...);
void nng_log_warn(const char *msgid, const char *msg, ...);
void nng_log_notice(const char *msgid, const char *msg, ...);
void nng_log_info(const char *msgid, const char *msg, ...);
void nng_log_debug(const char *msgid, const char *msg, ...);
</code></pre>
<p>These <a name="a001"></a> functions inject a a message into the
logging system, where it will be processed and potentially go to
system logs, standard output, or processed further.</p>
<p>The <em>msgid</em> is a short prefix that should uniquely identify the message,
possibly also with some kind of category. It is recommended that
strings between 8 and 16 characters be used. As this may, but will not necessarily
be displayed to the user, the content of the message should not appear
solely in this field. A <code>NULL</code> value is permitted here, but that may
make filtering the message or other automatic processing more difficult.</p>
<p>The <em>msg</em> is a <code>printf</code>-style format string, which is used to format the
message content. The following arguments are consumed in the
same manner as <code>printf</code>.</p>
<div class="mdbook-alerts mdbook-alerts-tip">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  tip
</p>
<p>Applications should take care to limit the use of higher severity levels, as message logs
are potentially expensive, increase stress for end users and administrators, and further may
mask real problems if incorrectly over used.</p>
<p>Warnings and error messages should be concise and actionable, and notices should only
really be those things that are worthy of attention.</p>
<p>Informational and debug messages used during development should be removed when no longer
needed, as these messages can overwhelm logging subsystems and can reduce the
signal-to-noise value for the message logs, impairing the diagnostic value of the logs.</p>
</div>
<h2 id="auth-logs"><a class="header" href="#auth-logs">Auth Logs</a></h2>
<pre><code class="language-c">void nng_log_auth(nng_log_level level, const char *msgid, const char *msg, ...);
</code></pre>
<p>The <a name="a002"></a><code>nng_log_auth</code> function formats and injects a security related log message.
(“Auth” can indicate either “authentication” or “authorization”.)
The <em>level</em> is a <a href="api/logging.html#log-levels">log level</a>.
The <em>msgid</em>, <em>msg</em>, and any remaining arguments are processed in a fashion
similar to the other <a href="api/logging.html#submitting-logs">logging functions</a>, except that the
logs may be are logged using the <code>NNG_LOG_AUTH</code> <a href="api/logging.html#log-facilities">facility</a>, and thus may be
redirected or receive other special treatment.</p>
<h2 id="log-levels"><a class="header" href="#log-levels">Log Levels</a></h2>
<pre><code class="language-c">typedef enum nng_log_level nng_log_level;

void nng_log_set_level(nng_log_level level);
nng_log_level nng_log_get_level(void);
</code></pre>
<p>The <a name="a003"></a><code>nng_log_level</code> type represents a severity for logged messages.
These levels correspond to those found in the UNIX syslog subsystem,
although applications should not depend upon the values being identical.</p>
<p>The <a name="a004"></a><code>nng_log_set_level</code> function sets the log level.
Messages with a severity that is numerically greater than this (less-severe)
will be discarded.</p>
<p>The <a name="a005"></a><code>nng_log_get_level</code> function returns the log level most recently
set by <code>nng_log_set_level</code> or the default
if that function has not been called.</p>
<p>The log levels are defined as follows:</p>
<pre><code class="language-c">typedef enum nng_log_level {
    NNG_LOG_NONE   = 0, // used for filters only, NNG suppresses these
    NNG_LOG_ERR    = 3,
    NNG_LOG_WARN   = 4,
    NNG_LOG_NOTICE = 5,
    NNG_LOG_INFO   = 6,
    NNG_LOG_DEBUG  = 7
} nng_log_level;
</code></pre>
<p>The value <code>NNG_LOG_NONE</code> may be useful to suppress message logs altogether.</p>
<p>The default level is typically <code>NNG_LOG_NOTICE</code>, but applications should
select a value rather than relying upon the default.</p>
<h2 id="log-facilities"><a class="header" href="#log-facilities">Log Facilities</a></h2>
<pre><code class="language-c">typedef enum nng_log_facility

void nng_log_set_facility(nng_log_facility facility);
</code></pre>
<p>Logging facilities are used to indicate the source of a log message,
and may be useful in routing and processing these logs.
Traditionally these are used with the UNIX <code>syslog</code> system, and
the values here represent some (but not all) of the values found there.</p>
<p>The following values are defined:</p>
<pre><code class="language-c">typedef enum nng_log_facility {
    NNG_LOG_USER   = 1,
    NNG_LOG_DAEMON = 3,
    NNG_LOG_AUTH   = 10,
    NNG_LOG_LOCAL0 = 16,
    NNG_LOG_LOCAL1 = 17,
    NNG_LOG_LOCAL2 = 18,
    NNG_LOG_LOCAL3 = 19,
    NNG_LOG_LOCAL4 = 20,
    NNG_LOG_LOCAL5 = 21,
    NNG_LOG_LOCAL6 = 22,
    NNG_LOG_LOCAL7 = 23,
} nng_log_facility;
</code></pre>
<p>The <a name="a006"></a><code>nng_log_set_facility</code> function can be used to
set the facility that the application will use when emitting log
messages. This should be called as part of initialization of the
application, if logging is to be used.</p>
<p>The default facility is typically <code>NNG_LOG_USER</code>, but applications should
select a value rather than relying upon the default.</p>
<h2 id="log-handlers"><a class="header" href="#log-handlers">Log Handlers</a></h2>
<pre><code class="language-c">typedef void (*nng_logger)(nng_log_level level, nng_log_facility facility,
    const char *msgid, const char *msg);

void nng_null_logger(nng_log_level, nng_log_facility, const char *, const char *);
void nng_stderr_logger(nng_log_level, nng_log_facility, const char *, const char *);
void nng_system_logger(nng_log_level, nng_log_facility, const char *, const char *);

void nng_log_set_logger(nng_logger logger);
</code></pre>
<p><a name="a007"></a>Log handlers are responsible for actually processing the logged messages.</p>
<p>The <a name="a008"></a><code>nng_log_set_logger</code> function installs the named <em>logger</em>, of type <a name="a009"></a><code>nng_logger</code>,
as the log handler. The function <em>logger</em> will be called when any message is meant to
be processed. (Messages are first filtered by <a href="api/logging.html#log-levels">severity</a>, then formatted,
before calling the logger.)</p>
<p>Any previously installed logger is replaced by <em>logger</em>.</p>
<p>The <a name="a010"></a><code>nng_null_logger</code> function is an implementation of <code>nng_logger</code> that simply discards the content.
This is the default logger, so logging is disabled by default.</p>
<p>The <a name="a011"></a><code>nng_stderr_logger</code> function is an implementation that logs messages to the standard error stream.
It will attempt to colorize messages by the severity, if the standard error is a terminal device.
This can be suppressed by setting either the <code>NO_COLOR</code> or <code>NNG_LOG_NO_COLOR</code> environment variables.</p>
<p>The <a name="a012"></a><code>nng_system_logger</code> attempts to use an appropriate system facility to log messages.
For POSIX systems, this means using <code>syslog</code> to process the messages.
For other systems the defauilt behavior may be the same as <code>nng_stderr_logger</code>.</p>
<h2 id="see-also-5"><a class="header" href="#see-also-5">See Also</a></h2>
<p>The Syslog Protocol upon which this is based is documented in the following two IETF
RFCS,</p>
<ul>
<li>R. Gerhards, <a href="https://datatracker.ietf.org/doc/html/rfc5424">RFC 5424</a>, <em>The Syslog Protocol</em>,
March 2009</li>
<li>C. Lonvick, <a href="https://datatracker.ietf.org/doc/html/rfc3164">RFC 3164</a>, <em>The BSD syslog Protocol</em>,
August 2001</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="statistics"><a class="header" href="#statistics">Statistics</a></h1>
<p>To facilitate debugging and support situations, the <em>NNG</em> library
provides for collection and reporting of numerous <a name="a001"></a>statistics.</p>
<p>These statistics are organized in a tree, and include both values,
and metadata describing the statistics. In order to be efficient and
minimize the impact of maintaining statistics, an explicit snapshot
of statistics must be taken, and that snapshot can then be processed.</p>
<div class="mdbook-alerts mdbook-alerts-note">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  note
</p>
<p>Statistics may be disabled by build-time configuration options,
in order to reduce program size and run-time overheads.</p>
</div>
<h2 id="statistic-structure"><a class="header" href="#statistic-structure">Statistic Structure</a></h2>
<pre><code class="language-c">typedef struct nng_stat nng_stat;
</code></pre>
<p>The <a name="a002"></a><code>nng_stat</code> structure represents a statistic, which is a single value
collected at a specific point in time.</p>
<p>This structure has meta-data describing the value, the value itself, and links
to any sibling or child statistics.</p>
<div class="mdbook-alerts mdbook-alerts-note">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  note
</p>
<p>The presence, name, and semantics of any given statistic are
subject to change at any time and without notice.</p>
</div>
<h2 id="collecting-a-snapshot"><a class="header" href="#collecting-a-snapshot">Collecting a Snapshot</a></h2>
<pre><code class="language-c">int nng_stats_get(nng_stat **statsp);
</code></pre>
<p>The <a name="a003"></a><code>nng_stats_get</code> function takes a snapshot of the statistics for
the system and returns it through the pointer <em>statsp</em>.
This function may return <a href="api//api/errors.html#NNG_ENOMEM"><code>NNG_ENOMEM</code></a> if memory is exhausted, or <a href="api//api/errors.html#NNG_ENOTSUP"><code>NNG_ENOTSUP</code></a> if the statistics
support is not enabled in the build, but is otherwise expected to return zero.</p>
<h2 id="freeing-a-snapshot"><a class="header" href="#freeing-a-snapshot">Freeing a Snapshot</a></h2>
<pre><code class="language-c">void nng_stats_free(nng_stat *stat);
</code></pre>
<p>The <a name="a004"></a><code>nng_stats_free</code> function deallocates the snapshot referenced by <em>stat</em>.</p>
<div class="mdbook-alerts mdbook-alerts-important">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  important
</p>
<p>The <em>stat</em> must be root of the statistics tree, i.e. the value that was returned
through <em>statsp</em> using the function <code>nng_stats_get</code>.</p>
</div>
<h2 id="traversing-the-tree"><a class="header" href="#traversing-the-tree">Traversing the Tree</a></h2>
<pre><code class="language-c">const nng_stat *nng_stat_child(const nng_stat *stat);
const nng_stat *nng_stat_next(const nng_stat *stat);
const nng_stat *nng_stat_parent(const nng_stat *stat);
</code></pre>
<p>Traversing the tree of statistics is done using the <a name="a005"></a><code>nng_stat_child</code> and
<a name="a006"></a><code>nng_stat_next</code> functions.</p>
<p>The <code>nng_stat_child</code> function returns either the first child of <em>stat</em>,
or <code>NULL</code> if the <em>stat</em> has no children.</p>
<p>The <code>nng_stat_next</code> function returns the nearest sibling to the right of <em>stat</em>,
or <code>NULL</code> if <em>stat</em> has no more siblings to the right.</p>
<p>The <a name="a007"></a><code>nng_stat_parent</code> function returns the parent of <em>stat</em>, or <code>NULL</code> if
<em>stat</em> is the root of the statistics tree.</p>
<h2 id="finding-a-statistic"><a class="header" href="#finding-a-statistic">Finding a Statistic</a></h2>
<pre><code class="language-c">const nng_stat *nng_stat_find(const nng_stat *stat, const char *name);
const nng_stat *nng_stat_find_dialer(const nng_stat *stat, nng_dialer dialer);
const nng_stat *nng_stat_find_listener(const nng_stat *stat, nng_dialer listener);
const nng_stat *nng_stat_find_socket(const nng_stat *stat, nng_dialer socket);
</code></pre>
<p>Sometimes it is easiest to search for a specific statistic, matching by name,
or possibly to find the tree of statistics associated with a specific <a href="api//TODO.html">socket</a>,
<a href="api//TODO.html">dialer</a>, or <a href="api//TODO.html">listener</a>.</p>
<p>The <code>nng_stat_find</code> functions are provided for this purpose.</p>
<p>The <a name="a008"></a><code>nng_stat_find</code> function returns the first statistic within the subtree of
statistics <em>stat</em>, with the given <em>name</em>. If no such statistic can be found, <code>NULL</code>
is returned.</p>
<p>The <a name="a009"></a><code>nng_stat_find_dialer</code>, <a name="a010"></a><code>nng_stat_find_listener</code>, and <a name="a011"></a><code>nng_stat_find_socket</code>
return the statistics subtree for the given dialer, listener, or socket object. If no such
statistic can be found, then they return <code>NULL</code>.
These functions should be provided the root of the statistic tree, in order to ensure
that they can find the desired object.</p>
<h2 id="statistic-identification"><a class="header" href="#statistic-identification">Statistic Identification</a></h2>
<pre><code class="language-c">const char *nng_stat_name(const nng_stat *stat);
const char *nng_stat_desc(const nng_stat *stat);
</code></pre>
<p>Every statistic has a name, returned by <a name="a012"></a><code>nng_stat_name</code>, and a description, returned by
<a name="a013"></a><code>nng_stat_desc</code>. Descriptions are human-readable text, which might be useful for display.</p>
<h2 id="statistic-type"><a class="header" href="#statistic-type">Statistic Type</a></h2>
<pre><code class="language-c">int nng_stat_type(const nng_stat *stat);
</code></pre>
<p>The function <a name="a014"></a><code>nng_stat_type</code> returns the type of the statistic.
The type of a statistic determines the nature of the value, and which
function can be used to obtain that value.</p>
<ul>
<li>
<p><a name="a015"></a><code>NNG_STAT_SCOPE</code>: <a name="NNG_STAT_SCOPE"></a>
The statistic does not carry any real value, but is
used for grouping related statistics together. This is a nexus in the
statistics tree.</p>
</li>
<li>
<p><a name="a016"></a><code>NNG_STAT_COUNTER</code>: <a name="NNG_STAT_COUNTER"></a>
The statistic is a counter that only increments.
Usually the change in the value of the statistic is more interesting
(as a rate) than the absolute value at any given time. The value should
be obtained using <a href="api//api/stats.html#statistic-value"><code>nng_stat_value</code></a>.
The units will be given by the value returned from <a href="api//api/stats.html#statistic-units"><code>nng_stat_unit</code></a>.</p>
</li>
<li>
<p><a name="a017"></a><code>NNG_STAT_LEVEL</code>: <a name="NNG_STAT_LEVEL"></a>
The statistic represents a measured value which corresponds
to a specific value at a specific time. For example, this may represent the
number of messages currently queued for some operation, or the link speed
of a network interface. Most often the absolute value is more interesting
than the change in the value over time. Again the value can be obtained with
<a href="api//api/stats.html#statistic-value"><code>nng_stat_value</code></a>, and any appropriate unit of measurement
with <a href="api//api/stats.html#statistic-units"><code>nng_stat_unit</code></a>.</p>
</li>
<li>
<p><a name="a018"></a><code>NNG_STAT_STRING</code>: <a name="NNG_STAT_STRING"></a>
The statistic is a string, such as a name. The value
of the string can be obtained with <a href="api//api/stats.html#statistic-value"><code>nng_stat_string</code></a>.
The value of this string
will remain valid until the snapshot is deallocated with <a href="api//api/stats.html#freeing-a-snapshot"><code>nng_stats_free</code></a>.</p>
</li>
<li>
<p><a name="a019"></a><code>NNG_STAT_BOOLEAN</code>: <a name="NNG_STAT_BOOLEAN"></a>
The value of the statistic is a truth value (either <code>true</code>
or <code>false</code>) and can be obtained with <a href="api//api/stats.html#statistic-value"><code>nng_stat_bool</code></a>.</p>
</li>
<li>
<p><a name="a020"></a><code>NNG_STAT_ID</code>: <a name="NNG_STAT_ID"></a>
The value of the statistic is a numeric identifier, such as a socket
identifier. The value can be obtained with <a href="api//api/stats.html#statistic-value"><code>nng_stat_value</code></a>,
and will be fixed for the life of the statistic.</p>
</li>
</ul>
<h2 id="statistic-value"><a class="header" href="#statistic-value">Statistic Value</a></h2>
<pre><code class="language-c">uint64_t nng_stat_value(const nng_stat *stat);
const char *nng_stat_string(const nng_stat *stat);
bool nng_stat_bool(const nng_stat *stat);
</code></pre>
<p>These functions return the value associated with the statistic.</p>
<p>The <a name="a021"></a><code>nng_stat_value</code> function returns the the numeric value for the statistic <em>stat</em>
of type <a href="api//api/stats.html#NNG_STAT_COUNTER"><code>NNG_STAT_COUNTER</code></a>, <a href="api//api/stats.html#NNG_STAT_LEVEL"><code>NNG_STAT_LEVEL</code></a>, or <a href="api//api/stats.html#NNG_STAT_ID"><code>NNG_STAT_ID</code></a>.
If <em>stat</em> is not one of these types, then it returns zero.</p>
<p>The <a name="a022"></a><code>nng_stat_bool</code> function returns the Boolean value (either <code>true</code> or <code>false</code>) for the statistic <em>stat</em> of
type <a href="api//api/stats.html#NNG_STAT_BOOLEAN"><code>NNG_STAT_BOOLEAN</code></a>. If the statistics is not of this type, then it returns <code>false</code>.</p>
<p>The <a name="a023"></a><code>nng_stat_string</code> function returns a pointer to a string value for the statistic <em>stat</em>,
of type <a href="api//api/stats.html#statistic-value"><code>NNG_STAT_STRING</code></a>. This string will remain valid until the snapshot that
<em>stat</em> was collected with is deallocated with <a href="api//api/stats.html#freeing-a-snapshot"><code>nng_stats_free</code></a>. If the statistic
is not of type <code>NNG_STAT_STRING</code>, then <code>NULL</code> is returned.</p>
<h2 id="statistic-units"><a class="header" href="#statistic-units">Statistic Units</a></h2>
<pre><code class="language-c">int nng_stat_unit(const nng_stat *stat);
</code></pre>
<p>For statistics of type <a href="api//api/stats.html#NNG_STAT_COUNTER"><code>NNG_STAT_COUNTER</code></a> or <a href="api//api/stats.html#NNG_STAT_LEVEL"><code>NNG_STAT_LEVEL</code></a>,
it is often useful to know what that quantity being reported measures.
The following units may be returned from <a name="a024"></a><code>nng_stat_unit</code> for such a statistic:</p>
<ul>
<li><a name="a025"></a><code>NNG_UNIT_NONE</code>: No unit is known or applies.</li>
<li><a name="a026"></a><code>NNG_UNIT_BYTES</code>: A count of bytes.</li>
<li><a name="a027"></a><code>NNG_UNIT_MESSAGES</code>: A count of messages.</li>
<li><a name="a028"></a><code>NNG_UNIT_MILLIS</code>: A count of milliseconds.</li>
<li><a name="a029"></a><code>NNG_UNIT_EVENTS</code>: A count of events of some type.</li>
</ul>
<h2 id="statistic-timestamp"><a class="header" href="#statistic-timestamp">Statistic Timestamp</a></h2>
<pre><code class="language-c">uint64_t nng_stat_timestamp(const nng_stat *stat);
</code></pre>
<p>Statistics have a timestamp indicating when the value was sampled,
obtained via <a name="a030"></a><code>nng_stat_timestamp</code>. The timestamp is given in
in milliseconds since a reference time, and the reference time used
here is the same reference time used for <a href="api//api/time.html#get-the-current-time"><code>nng_clock</code></a>.</p>
<h2 id="see-also-6"><a class="header" href="#see-also-6">See Also</a></h2>
<p><a href="api//api/time.html#get-the-current-time"><code>nng_clock</code></a></p>
<!-- Symbol cross reference -->
<!-- HTTP -->
<!-- Macros -->
<!-- Protocols -->
<!-- Transports -->
<!-- Concept index -->
<div style="break-before: page; page-break-before: always;"></div><style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="errors"><a class="header" href="#errors">Errors</a></h1>
<pre><code class="language-c">typedef enum ... nng_err;
</code></pre>
<p>Many <em>NNG</em> functions can fail for a variety of reasons.
These functions tend to return either zero on success,
or a non-zero error code to indicate failure.
<sup><a name="to-footnote-1"><a href="api/errors.html#footnote-1">1</a></a></sup></p>
<p>All these error codes are <code>nng_err</code>.</p>
<div class="mdbook-alerts mdbook-alerts-note">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  note
</p>
<p>Many APIs are still using <code>int</code>, but the <code>nng_err</code> enumeration can be used
instead, and will help with debugging.</p>
</div>
<p>Not every possible error code is defined here, as sometimes
an underlying system or library error code is “wrapped”.</p>
<h2 id="human-readable-error-message"><a class="header" href="#human-readable-error-message">Human Readable Error Message</a></h2>
<pre><code class="language-c">const char *nng_strerror(nng_err err);
</code></pre>
<p>The <a name="a001"></a><code>nng_strerror</code> returns the human-readable description of the
given error in <code>err</code>.</p>
<p>The error message returned is a fixed <code>NUL</code>-terminated string and may be located in
read-only memory.</p>
<p>The returned <a name="a002"></a>error message is provided in US English, but in the
future locale-specific strings may be presented instead.</p>
<div class="mdbook-alerts mdbook-alerts-note">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  note
</p>
<p>The specific strings associated with specific error messages are
subject to change.
Therefore applications must not depend on the message,
but may use them verbatim when supplying information to end-users, such
as in diagnostic messages or log entries.</p>
</div>
<h2 id="list-of-errors"><a class="header" href="#list-of-errors">List of Errors</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Error</th><th>Value</th><th>Description</th></tr></thead><tbody>
<tr><td><code>NNG_EINTR</code><a name="NNG_EINTR"></a></td><td>1</td><td>Operation interrupted.</td></tr>
<tr><td><code>NNG_ENOMEM</code><a name="NNG_ENOMEM"></a></td><td>2</td><td>Out of memory, or other resource exhausted.</td></tr>
<tr><td><code>NNG_EINVAL</code><a name="NNG_EINVAL"></a></td><td>3</td><td>Invalid argument. The arguments are invalid or malformed somehow.</td></tr>
<tr><td><code>NNG_EBUSY</code><a name="NNG_EBUSY"></a></td><td>4</td><td>Resource busy.</td></tr>
<tr><td><code>NNG_ETIMEDOUT</code><a name="NNG_ETIMEDOUT"></a></td><td>5</td><td>Timed out. The operation took longer than the allotted time.</td></tr>
<tr><td><code>NNG_ECONNREFUSED</code><a name="NNG_ECONNREFUSED"></a></td><td>6</td><td>Connection refused. Usually indicates the wrong address or a server is running.</td></tr>
<tr><td><code>NNG_ECLOSED</code><a name="NNG_ECLOSED"></a></td><td>7</td><td>Object closed. Typically the <a href="api//TODO.html">socket</a> is closed.</td></tr>
<tr><td><code>NNG_EAGAIN</code><a name="NNG_EAGAIN"></a></td><td>8</td><td>Try again. Typcally for a non-blocking operation that might succeed later.</td></tr>
<tr><td><code>NNG_ENOTSUP</code><a name="NNG_ENOTSUP"></a></td><td>9</td><td>Not supported. Perhaps the protocol or transport is not supported, or the operation is not not supported with the transport or protocol.</td></tr>
<tr><td><code>NNG_EADDRINUSE</code><a name="NNG_EADDRINUSE"></a></td><td>10</td><td>Address in use. The network address is already used by another process. Most often this is seen for <a href="api//TODO.html">listeners</a>.</td></tr>
<tr><td><code>NNG_ESTATE</code><a name="NNG_ESTATE"></a></td><td>11</td><td>Incorrect state. The operation cannot be performed in the current state, such as trying to send a response when no request has yet been received.</td></tr>
<tr><td><code>NNG_ENOENT</code><a name="NNG_ENOENT"></a></td><td>12</td><td>Entry not found (no such object.) Can also indicate that a file does not exist.</td></tr>
<tr><td><code>NNG_EPROTO</code><a name="NNG_EPROTO"></a></td><td>13</td><td>Protocol error. Typically this indicates incorrect messages over a network.</td></tr>
<tr><td><code>NNG_EUNREACHABLE</code><a name="NNG_EUNREACHABLE"></a></td><td>14</td><td>Destination unreachable.</td></tr>
<tr><td><code>NNG_EADDRINVAL</code><a name="NNG_EADDRINVAL"></a></td><td>15</td><td>Address invalid. Like <a href="api//api/errors.html#NNG_EINVAL"><code>NNG_EINVAL</code></a>, but only for network addresses.</td></tr>
<tr><td><code>NNG_EPERM</code><a name="NNG_EPERM"></a></td><td>16</td><td>Permission denied.</td></tr>
<tr><td><code>NNG_EMSGSIZE</code><a name="NNG_EMSGSIZE"></a></td><td>17</td><td>Message too large.</td></tr>
<tr><td><code>NNG_ECONNABORTED</code><a name="NNG_ECONNABORTED"></a></td><td>18</td><td>Connection aborted. A connection attempt was aborted locally.</td></tr>
<tr><td><code>NNG_ECONNRESET</code><a name="NNG_ECONNRESET"></a></td><td>19</td><td>Connection reset. The remote peer reset the connection unexpectedly.</td></tr>
<tr><td><code>NNG_ECANCELED</code><a name="NNG_ECANCELED"></a></td><td>20</td><td>Operation canceled. Typically as a result of <a href="api//api/aio.html#cancellation"><code>nng_aio_cancel</code></a> or similar.</td></tr>
<tr><td><code>NNG_ENOFILES</code><a name="NNG_ENOFILES"></a></td><td>21</td><td>Out of files. Either the destination file system cannot store files, or all available file handles are used.</td></tr>
<tr><td><code>NNG_ENOSPC</code><a name="NNG_ENOSPC"></a></td><td>22</td><td>Out of space. Destination table or filesystem is full.</td></tr>
<tr><td><code>NNG_EEXIST</code><a name="NNG_EEXIST"></a></td><td>23</td><td>Resource already exists.</td></tr>
<tr><td><code>NNG_EREADONLY</code><a name="NNG_EREADONLY"></a></td><td>24</td><td>Read only resource. An attempt to modify a read-only file or other object.</td></tr>
<tr><td><code>NNG_EWRITEONLY</code><a name="NNG_EWRITEONLY"></a></td><td>25</td><td>Write only resource. A read operation failed because the object only supports writes.</td></tr>
<tr><td><code>NNG_ECRYPTO</code><a name="NNG_ECRYPTO"></a></td><td>26</td><td>Cryptographic error. Usually indicates an invalid key was used for TLS.</td></tr>
<tr><td><code>NNG_EPEERAUTH</code><a name="NNG_EPEERAUTH"></a></td><td>27</td><td>Peer could not be authenticated.</td></tr>
<tr><td><code>NNG_EBADTYPE</code><a name="NNG_EBADTYPE"></a></td><td>30</td><td>Incorrect type. A type-specific function was used for an object of the wrong type.</td></tr>
<tr><td><code>NNG_ECONNSHUT</code><a name="NNG_ECONNSHUT"></a></td><td>31</td><td>Connection shutdown. The connection was shut down and cannot be used.</td></tr>
<tr><td><code>NNG_ESTOPPED</code><a name="NNG_ESTOPPED"></a></td><td>1000</td><td>Operation stopped. The operation was stopped with <a href="api//api/aio.html#cancellation"><code>nng_aio_stop</code></a> or [<code>nng_aio_close</code>].</td></tr>
<tr><td><code>NNG_EINTERNAL</code><a name="NNG_EINTERNAL"></a></td><td>1000</td><td>An unidentifier internal error occurred.</td></tr>
<tr><td><code>NNG_ESYSERR</code><a name="NNG_ESYSERR"></a></td><td>0x10000000 - 0x1FFFFFFF</td><td>An unidentified system error occurred. These are errors reported by the operating system.</td></tr>
<tr><td><code>NNG_ETRANERR</code><a name="NNG_ETRANERR"></a></td><td>0x20000000 - 0x2FFFFFFF</td><td>An unidentified transport error occurred.</td></tr>
</tbody></table>
</div><!-- Symbol cross reference -->
<!-- HTTP -->
<!-- Macros -->
<!-- Protocols -->
<!-- Transports -->
<!-- Concept index -->
<p><hr/>
<p><a name="footnote-1"><a href="api/errors.html#to-footnote-1">1</a></a>: This convention goes back to UNIX system calls,
which behave the same way, but <em>NNG</em> does not use a separate
<em>errno</em> variable.</p>
<div style="break-before: page; page-break-before: always;"></div><style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="streams"><a class="header" href="#streams">Streams</a></h1>
<p>NNG provides a common <a name="a001"></a>streams API for working with byte-oriented streams. In NNG, streams are bidirectional
connections for exchanging a stream of bytes.</p>
<p>Some common examples of streams are TCP connections, UNIX domain sockets, Windows named pipes, and WebSockets.</p>
<p>The API documented here is to facilitate applications that wish to work with these at a lower-level than
Scalability Protocols, in a way that is both portable and agnostic about the specific underlying transport mechanism.</p>
<div class="mdbook-alerts mdbook-alerts-tip">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  tip
</p>
<p>When working with Scalability Protocols directly, it is unlikely that there will be any need for
using these Streams APIs.</p>
</div>
<h2 id="stream-type"><a class="header" href="#stream-type">Stream Type</a></h2>
<pre><code class="language-c">typedef struct nng_stream nng_stream
</code></pre>
<p>The base <a name="a002"></a><code>nng_stream</code> type represents a bidirectional, byte-oriented, reliable connection.</p>
<div class="mdbook-alerts mdbook-alerts-note">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  note
</p>
<p>The <code>nng_stream</code> object is used for raw byte stream connections, and
should not be confused with a <a href="api//api/pipe.html">pipe</a> object created on a <a href="api//TODO.html">socket</a> using
the <a href="api//TODO.html"><code>nng_listen</code></a>, <a href="api//TODO.html"><code>nng_dial</code></a> or related functions.</p>
</div>
<h2 id="sending-and-receiving-data"><a class="header" href="#sending-and-receiving-data">Sending and Receiving Data</a></h2>
<pre><code class="language-c">void nng_stream_send(nng_stream *s, nng_aio *aio);
void nng_stream_recv(nng_stream *s, nng_aio *aio);
</code></pre>
<p>The <a name="a003"></a><code>nng_stream_send</code> function starts sending data asynchronously over the stream <em>s</em>.
The data is sent from the scatter/gather vector located in the <a href="api//api/aio.html#asynchronous-io-handle"><code>nng_aio</code></a> <em>aio</em>,
which must have been previously set using <a href="api//api/aio.html#scatter-gather-vectors"><code>nng_aio_set_iov</code></a>.</p>
<p>The <a name="a004"></a><code>nng_stream_recv</code> function starts receiving data [asynchronously over the stream <em>s</em>
into the scatter/gather vector located in the <a href="api//api/aio.html#asynchronous-io-handle"><code>nng_aio</code></a> <em>aio</em>,
which must have been previously set using <a href="api//api/aio.html#scatter-gather-vectors"><code>nng_aio_set_iov</code></a>.</p>
<p>These functions return immediately, with no return value.
Completion of the operation is signaled via the <em>aio</em>, and the final
result may be obtained via <a href="api//api/aio.html#result-of-operation"><code>nng_aio_result</code></a>.</p>
<p>The I/O operation may complete as soon as at least one byte has been
transferred, or an error has occurred.
Therefore, the number of bytes transferred may be less than requested.
The actual number of bytes transferred can be determined with <a href="api//api/aio.html#result-of-operation"><code>nng_aio_count</code></a>.</p>
<h2 id="closing-a-stream"><a class="header" href="#closing-a-stream">Closing a Stream</a></h2>
<pre><code class="language-c">void nng_stream_close(nng_stream *s);
void nng_stream_stop(nng_stream *s);
void nng_stream_free(nng_stream *s);
</code></pre>
<p>The <a name="a005"></a><code>nng_stream_close</code> function closes a stream, but does not destroy it.
This function returns immediately. Operations that are pending against the stream, such
as <a href="api//api/stream.html#sending-and-receiving-data"><code>nng_stream_send</code></a> or <a href="api//api/stream.html#sending-and-receiving-data"><code>nng_stream_recv</code></a> operations will be canceled asynchronously, if possible.
Those operations will result in <a href="api//api/errors.html#NNG_ECLOSED"><code>NNG_ECLOSED</code></a>.</p>
<p>The <a name="a006"></a><code>nng_stream_stop</code> function not only closes the stream, but waits for any operations
pending against it to complete, and for any underlying asynchronous registered I/O to be fully deregistered.
As some systems use separate threads for asynchronous I/O, stopping the stream is necessary before those
resources can be freed. Until the stream is stopped, there could still be I/O operations in flight,
making it unsafe to deallocate memory.</p>
<p>The <a name="a007"></a><code>nng_stream_free</code> function stops the stream like <code>nng_stream_stop</code>, but also deallocates the
stream itself.</p>
<div class="mdbook-alerts mdbook-alerts-note">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  note
</p>
<p>Because <code>nng_stream_stop</code> and <code>nng_stream_free</code> both may block waiting for outstanding I/O to complete
or be aborted, these functions are unsafe to call from functions that may not block, such as the
completion function registered with an <a href="api//api/aio.html#asynchronous-io-handle"><code>nng_aio</code></a> when it is created.</p>
</div>
<h2 id="getting-stream-options"><a class="header" href="#getting-stream-options">Getting Stream Options</a></h2>
<pre><code class="language-c">nng_err nng_stream_get_bool(nng_stream *s, const char *opt, bool *valp);
nng_err nng_stream_get_int(nng_stream *s, const char *opt, int *valp);
nng_err nng_stream_get_ms(nng_stream *s, const char *opt, nng_duration *valp);
nng_err nng_stream_get_size(nng_stream *s, const char *opt, size_t *valp);
nng_err nng_stream_get_addr(nng_stream *s, const char *opt, nng_sockaddr *valp);
nng_err nng_stream_get_string(nng_stream *s, const char *opt, const char **valp);
</code></pre>
<p><a name="a008"></a>
<a name="a009"></a>
<a name="a010"></a>
<a name="a011"></a>
<a name="a012"></a>
<a name="a013"></a>
These functions are used to obtain value of an option named <em>opt</em> from the stream <em>s</em>, and store it in the location
referenced by <em>valp</em>.</p>
<p>These functions access an option as a specific type. The transport layer will have details about which options
are available, and which type they may be accessed using.</p>
<p>In the case of <code>nng_stream_get_string</code>, the string pointer is only guaranteed to be valid while the
stream exists. Callers should make a copy of the data if required before closing the stream.</p>
<h2 id="stream-factories"><a class="header" href="#stream-factories">Stream Factories</a></h2>
<pre><code class="language-c">typedef struct nng_stream_dialer nng_stream_dialer;
typedef struct nng_stream_listener nng_stream_listener;
</code></pre>
<p><a name="a014"></a>
The <a name="a015"></a><code>nng_stream_listener</code> object and <a name="a016"></a><code>nng_stream_listener</code> objects can be thought of as factories that
create <a href="api//api/stream.html#stream-type"><code>nng_stream</code></a> streams.</p>
<p>The <code>nng_stream_listener</code> object a handle to a listener, which creates streams by accepting incoming connection requests.
In a BSD socket implementation, this is the entity responsible for doing <a name="a017"></a><code>bind</code>, <a name="a018"></a><code>listen</code> and <a name="a019"></a><code>accept</code>.
Normally a listener may be used to accept multiple, possibly many, concurrent connections.</p>
<p>The <code>nng_stream_dialer</code> object is a handle to a dialer, which creates streams by making outgoing
connection requests. While there isn’t a specific BSD socket analogue, this can be thought of as a factory for TCP sockets
created by opening them with <a name="a020"></a><code>socket</code> and then calling <a name="a021"></a><code>connect</code> on them.</p>
<h2 id="creating-a-stream-factory"><a class="header" href="#creating-a-stream-factory">Creating a Stream Factory</a></h2>
<pre><code class="language-c">nng_err nng_stream_dialer_alloc(nng_stream_dialer **dialerp, const char *url);
nng_err nng_stream_dialer_alloc_url(nng_stream_dialer **dialerp, const nng_url *url);
nng_err nng_stream_listener_alloc(nng_stream_listener **lstenerp, const char *url);
nng_err nng_stream_listener_alloc_url(nng_stream_listener **listenerp, const nng_url *url);
</code></pre>
<p>The <a name="a022"></a><code>nng_stream_dialer_alloc</code> and <a name="a023"></a><code>nng_stream_dialer_alloc_url</code> functions create a stream dialer, associated the
<a name="a024"></a>URL specified by <em>url</em> represented as a string, or as an <a href="api//api/url.html#url-structure"><code>nng_url</code></a> object, respectively. The dialer is returned in the location
<em>dialerp</em> references.</p>
<p>The <a name="a025"></a><code>nng_stream_listener_alloc</code> and <a name="a026"></a><code>nng_stream_listener_alloc_url</code> functions create a stream listener, associated the
URL specified by <em>url</em> represented as a string, or as an <a href="api//api/url.html#url-structure"><code>nng_url</code></a> object, respectively. The listener is returned in the location
<em>listenerp</em> references.</p>
<h3 id="example-1-creating-a-tcp-listener"><a class="header" href="#example-1-creating-a-tcp-listener">Example 1: Creating a TCP Listener</a></h3>
<p>This shows creating a TCP listener that listens on <code>INADDR_ANY</code>, port 444.</p>
<pre><code class="language-c">nng_listener listener;
int rv = nng_stream_listener_alloc(&amp;listener, "tcp://:444");
</code></pre>
<h2 id="closing-a-stream-factory"><a class="header" href="#closing-a-stream-factory">Closing a Stream Factory</a></h2>
<pre><code class="language-c">void nng_stream_dialer_close(nng_stream_listener *dialer);
void nng_stream_dialer_stop(nng_stream_listener *dialer);
void nng_stream_dialer_free(nng_stream_listener *dialer);
void nng_stream_listener_close(nng_stream_listener *listener);
void nng_stream_listener_stop(nng_stream_listener *listener);
void nng_stream_listener_free(nng_stream_listener *listener);
</code></pre>
<p>The <a name="a027"></a><code>nng_stream_dialer_close</code> and <a name="a028"></a><code>nng_stream_listener_close</code> functions close the stream <em>dialer</em> or <em>listener</em>,
preventing it from creating new connections.
This will generally include closing any underlying file used for creating such connections.
However, some requests may still be pending when this function returns, as it does not wait for the shutdown to complete.</p>
<p>The <a name="a029"></a><code>nng_stream_dialer_stop</code> and <a name="a030"></a><code>nng_stream_listener_stop</code> functions performs the same action,
but also wait until all outstanding requests are serviced, and the <em>dialer</em> or <em>listener</em> is completely stopped.
Because they blocks, these functions must not be called in contexts where blocking is not allowed.</p>
<p>The <a name="a031"></a><code>nng_stream_dialer_free</code> and <a name="a032"></a><code>nng_stream_listener_free</code> function performs the same action as
<code>nng_stream_dialer_stop</code> or <code>nng_stream_listener_stop</code>, but also deallocates the <em>dialer</em> or <em>listener</em>, and any associated resources.</p>
<div class="mdbook-alerts mdbook-alerts-tip">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  tip
</p>
<p>A best practice for shutting down an application safely is to stop everything <em>before</em> deallocating. This ensures that no
callbacks are running that could reference an object after it is deallocated.</p>
</div>
<h2 id="making-outgoing-connections"><a class="header" href="#making-outgoing-connections">Making Outgoing Connections</a></h2>
<pre><code class="language-c">void nng_stream_dialer_dial(nng_stream_dialer *dialer, nng_aio *aio);
</code></pre>
<p>The <a name="a033"></a><code>nng_stream_dialer_dial</code> initiates an outgoing connection asynchronously, using the <a href="api//api/aio.html#asynchronous-io-handle"><code>nng_aio</code></a> <em>aio</em>.
If it successfully establishes a connection, it creates an <a href="api//api/stream.html#stream-type"><code>nng_stream</code></a>, which can be obtained as the first
output result on <em>aio</em> using the <a href="api//api/aio.html#inputs-and-outputs"><code>nng_aio_get_output</code></a> function with index zero.</p>
<div class="mdbook-alerts mdbook-alerts-tip">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  tip
</p>
<p>An <a href="api//api/stream.html#stream-factories"><code>nng_stream_dialer</code></a> can be used multiple times to make multiple concurrent connection requests, but
they all must reference the same URL.</p>
</div>
<h3 id="example-3-connecting-to-google"><a class="header" href="#example-3-connecting-to-google">Example 3: Connecting to Google</a></h3>
<p>This demonstrates making an outbound connection to “google.com” on TCP port 80.
Error handling is elided for clarity.</p>
<pre><code class="language-c">nng_aio *aio;
nng_stream_dialer *dialer;
nng_stream *stream;

nng_stream_dialer_alloc(&amp;dialer, "tcp://google.com:80");

nng_aio_alloc(&amp;aio, NULL, NULL);

// make a single outbound connection
nng_stream_dialer_dial(dialer, aio);
nng_aio_wait(aio); // wait for the asynch operation to complete
if (nng_aio_result(aio) != 0) {
    // ... handle the error
}
stream = nng_aio_get_output(aio, 0);
</code></pre>
<h2 id="accepting-incoming-connections"><a class="header" href="#accepting-incoming-connections">Accepting Incoming Connections</a></h2>
<pre><code class="language-c">nng_err nng_stream_listener_listen(nng_stream_listener *listener);
void nng_stream_listener_accept(nng_stream_listener *listener, nng_aio *aio);
</code></pre>
<p>Accepting incoming connections is performed in two steps. The first step, <a name="a034"></a><code>nng_stream_listener_listen</code> is to setup for
listening. For a TCP implementation of this, for example, this would perform the <code>bind</code> and the <code>listen</code> steps. This will bind
to the address represented by the URL that was specific when the listener was created with <a href="api//api/stream.html#creating-a-stream-factory"><code>nng_stream_listener_alloc</code></a>.</p>
<p>In the second step, <a name="a035"></a><code>nng_stream_listener_accept</code> accepts an incoming connection on <em>listener</em> asynchronously, using the <a href="api//api/aio.html#asynchronous-io-handle"><code>nng_aio</code></a> <em>aio</em>.
If an incoming connection is accepted, it will be represented as an <a href="api//api/stream.html#stream-type"><code>nng_stream</code></a>, which can be obtained from the <em>aio</em> as the first
output result using the <a href="api//api/aio.html#inputs-and-outputs"><code>nng_aio_get_output</code></a> function with index zero.</p>
<h3 id="example-3-accepting-an-inbound-stream"><a class="header" href="#example-3-accepting-an-inbound-stream">Example 3: Accepting an Inbound Stream</a></h3>
<p>For clarity this example uses a synchronous approach using <a href="api//api/aio.html#wait-for-completion"><code>nng_aio_wait</code></a>, but a typical server application
would most likely use a callback to accept the incoming stream, and start another instance of <code>nng_stream_listener_accept</code>.</p>
<pre><code class="language-c">nng_aio *aio;
nng_listener *listener;
nng_stream *stream;

nng_stream_listener_alloc(&amp;listener, "tcp://:8181");
nng_aio_alloc(&amp;aio, NULL, NULL); // normally would use a callback

// listen (binding to the URL in the process)
if (nng_stream_listener_listen(listener)) {
    // ... handle the error
}

// now accept a single incoming connection as a stream object
nng_stream_listener_accept(l, aio);
nng_aio_wait(aio); // wait for the asynch operation to complete
if (nng_aio_result(aio) != 0) {
    // ... handle the error
}
stream = nng_aio_get_output(aio, 0);
</code></pre>
<h2 id="stream-factory-options"><a class="header" href="#stream-factory-options">Stream Factory Options</a></h2>
<pre><code class="language-c">nng_err nng_stream_dialer_get_addr(nng_stream_dialer *dialer, const char *opt, nng_sockaddr *valp);
nng_err nng_stream_dialer_get_bool(nng_stream_dialer *dialer, const char *opt, bool *valp);
nng_err nng_stream_dialer_get_int(nng_stream_dialer *dialer, const char *opt, int *valp);
nng_err nng_stream_dialer_get_ms(nng_stream_dialer *dialer, const char *opt, nng_duration *valp);
nng_err nng_stream_dialer_get_size(nng_stream_dialer *dialer, const char *opt, size_t *valp);
nng_err nng_stream_dialer_get_string(nng_stream_dialer *dialer, const char *opt, const char **valp);

nng_err nng_stream_listener_get_addr(nng_stream_listener *listener, const char *opt, nng_sockaddr *valp);
nng_err nng_stream_listener_get_bool(nng_stream_listener *listener, const char *opt, bool *valp);
nng_err nng_stream_listener_get_int(nng_stream_listener *listener, const char *opt, int *valp);
nng_err nng_stream_listener_get_ms(nng_stream_listener *listener, const char *opt, nng_duration *valp);
nng_err nng_stream_listener_get_size(nng_stream_listener *listener, const char *opt, size_t *valp);
nng_err nng_stream_listener_get_string(nng_stream_listener *listener, const char *opt, const char **valp);

nng_err nng_stream_dialer_set_addr(nng_stream_dialer *dialer, const char *opt, const nng_sockaddr *val);
nng_err nng_stream_dialer_set_bool(nng_stream_dialer *dialer, const char *opt, bool val);
nng_err nng_stream_dialer_set_int(nng_stream_dialer *dialer, const char *opt, int val);
nng_err nng_stream_dialer_set_ms(nng_stream_dialer *dialer, const char *opt, nng_duration val);
nng_err nng_stream_dialer_set_size(nng_stream_dialer *dialer, const char *opt, size_t val);
nng_err nng_stream_dialer_set_string(nng_stream_dialer *dialer, const char *opt, const char *val);

nng_err nng_stream_listener_set_addr(nng_stream_listener *listener, const char *opt, const nng_sockaddr *val);
nng_err nng_stream_listener_set_bool(nng_stream_listener *listener, const char *opt, bool val);
nng_err nng_stream_listener_set_int(nng_stream_listener *listener, const char *opt, int val);
nng_err nng_stream_listener_set_ms(nng_stream_listener *listener, const char *opt, nng_duration val);
nng_err nng_stream_listener_set_size(nng_stream_listener *listener, const char *opt, size_t val);
nng_err nng_stream_listener_set_string(nng_stream_listener *listener, const char *opt, const char *val);
</code></pre>
<p><a name="a036"></a>
<a name="a037"></a>
<a name="a038"></a>
<a name="a039"></a>
<a name="a040"></a>
<a name="a041"></a>
<a name="a042"></a>
<a name="a043"></a>
<a name="a044"></a>
<a name="a045"></a>
<a name="a046"></a>
<a name="a047"></a>
<a name="a048"></a>
<a name="a049"></a>
<a name="a050"></a>
<a name="a051"></a>
<a name="a052"></a>
<a name="a053"></a>
<a name="a054"></a>
<a name="a055"></a>
<a name="a056"></a>
<a name="a057"></a>
<a name="a058"></a>
<a name="a059"></a>
These functions are used to retrieve or change the value of an option named <em>opt</em> from the stream <em>dialer</em> or <em>listener</em>.
The <code>nng_stream_dialer_get_</code> and <code>nng_stream_listener_get_</code> function families retrieve the value, and store it in the location <em>valp</em> references.
The <code>nng_stream_dialer_set_</code> and <code>nng_stream_listener_set_</code> function families change the value for the <em>dialer</em> or <em>listener</em>, taking it from <em>val</em>.</p>
<p>These functions access an option as a specific type. The transport layer will have details about which options
are available, and which type they may be accessed using.</p>
<p>In the case of <code>nng_stream_dialer_get_string</code> and <code>nng_stream_listener_get_string</code>, the memory holding
the string is only valid as long as the associated object remains open.</p>
<p>In the case of <code>nng_stream_dialer_set_string</code> and <code>nng_stream_listener_set_string</code>, the string contents are copied if necessary, so that the caller
need not retain the value referenced once the function returns.</p>
<p>In the case of <code>nng_stream_dialer_set_addr</code> and <code>nng_stream_listener_set_addr</code>, the contents of <em>addr</em> are copied if necessary, so that the caller
need not retain the value referenced once the function returns.</p>
<h3 id="example-4-socket-activation"><a class="header" href="#example-4-socket-activation">Example 4: Socket Activation<a name="socket-activation"></a></a></h3>
<p>Some <a href="api//api/stream.html#stream-factories"><code>nng_stream_listener</code></a> objects, depending on the underlying transport and platform, can support a technique known as “<a name="a060"></a>socket activation”,
where the file descriptor used for listening and accepting is supplied externally, such as by a system service manager.
In this case, the application supplies the file descriptor or <code>SOCKET</code> object using the <a name="a061"></a><code>NNG_OPT_LISTEN_FD</code> option,
instead of calling <a href="api//api/stream.html#accepting-incoming-connections"><code>nng_stream_listener_listen</code></a>.</p>
<div class="mdbook-alerts mdbook-alerts-tip">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  tip
</p>
<p>Scalability Protocols transports based upon stream implementations that support socket activation can also benefit from this approach.</p>
</div>
<pre><code class="language-c">nng_stream_listener *listener;
int fd;

// This is a systemd API, not part of NNG.
// See systemd documentation for an explanation.
// fd at this point has already had bind() and listen() called.
fd = SD_LISTEN_FDS_START + 0;

nng_stream_listener_alloc(&amp;listener, "tcp://");
nng_stream_listener_set_int(listener, NNG_OPT_LISTEN_FD, fd);

// can now start doing nng_stream_listener_accept...
</code></pre>
<h2 id="tls-configuration"><a class="header" href="#tls-configuration">TLS Configuration</a></h2>
<pre><code class="language-c">nng_err nng_stream_dialer_get_tls(nng_stream_listener *dialer, nng_tls_config **tlsp);
nng_err nng_stream_dialer_set_tls(nng_stream_listener *dialer, nng_tls_config *tls);
nng_err nng_stream_listener_get_tls(nng_stream_listener *listener, nng_tls_config **tlsp);
nng_err nng_stream_listener_set_tls(nng_stream_listener *listener, nng_tls_config *tls);
</code></pre>
<p>Both <a href="api//api/stream.html#stream-factories"><code>nng_stream_dialer</code></a> and <a href="api//api/stream.html#stream-factories"><code>nng_stream_listener</code></a> objects may support configuration of <a name="a062"></a>TLS parameters.
The <a name="a063"></a><code>nng_stream_dialer_set_tls</code> and <a name="a064"></a><code>nng_stream_listener_set_tls</code> functions support setting the
configuration of a <a href="api//TODO.html"><code>nng_tls_config</code></a> object supplied by <em>tls</em> on <em>dialer</em> or <em>listener</em>.
This must be performed before the <em>listener</em> starts listening with <a href="api//api/stream.html#accepting-incoming-connections"><code>nng_stream_listener_listen</code></a>, or the dialer starts an outgoing connection
as a result of <a href="api//api/stream.html#making-outgoing-connections"><code>nng_stream_dialer_dial</code></a>.</p>
<p>The configuration object that was previously established (which may be a default if one was not explicitly
configured) can be obtained with the <a name="a065"></a><code>nng_stream_dialer_get_tls</code> and <a name="a066"></a><code>nng_stream_listener_get_tls</code>.
They will return a pointer to the <a href="api//TODO.html"><code>nng_tls_config</code></a> object in question at the location referenced by <em>tlsp</em>.</p>
<div class="mdbook-alerts mdbook-alerts-note">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  note
</p>
<p>TLS configuration cannot be changed once it has started being used by a listener or dialer. This applies to
both configuring a different TLS configuration object, as well as mutating the existing <a href="api//TODO.html"><code>nng_tls_config</code></a> object.</p>
</div>
<!-- Symbol cross reference -->
<!-- HTTP -->
<!-- Macros -->
<!-- Protocols -->
<!-- Transports -->
<!-- Concept index -->
<div style="break-before: page; page-break-before: always;"></div><style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="http-support"><a class="header" href="#http-support">HTTP Support</a></h1>
<p>NNG offers support for creation of HTTP clients, and servers. NNG supports HTTP/1.1 at present, and supports
a subset of functionality, but the support should be sufficient for simple clients, REST API servers, static content servers,
and gateways between HTTP and and other protocols. It also provides support for WebSocket based connections.</p>
<p>HTTP follows a request/reply model, where a client issues a request, and the server is expected to reply.
Every request is answered with a single reply.</p>
<h2 id="header-file"><a class="header" href="#header-file">Header File</a></h2>
<pre><code class="language-c">#include &lt;nng/http.h&gt;
</code></pre>
<p>Unlike the rest of NNG, the HTTP API in NNG requires including <code>nng/http.h</code>. It is not necessary to include
the main <code>nng/nng.h</code> header, it will be included transitively by <code>nng/http.h</code>.</p>
<h2 id="connection-object"><a class="header" href="#connection-object">Connection Object</a></h2>
<pre><code class="language-c">typedef struct nng_http nng_http;
</code></pre>
<p>The <a name="a001"></a><code>nng_http</code> object represents a single logical HTTP connection to the server.
For HTTP/1.1 and earlier, this will correspond to a single TCP connection, but the object
also contains state relating to the transaction, such as the hostname used, HTTP method used,
request headers, response status, response headers, and so forth.</p>
<p>An <code>nng_http</code> object can be reused, unless closed, so that additional transactions can be
performed after the first transaction is complete.</p>
<p>At any given point in time, an <code>nng_http</code> object can only refer to a single HTTP transaction.
In NNG, these <code>nng_http</code> objects are used in both the client and server APIs.</p>
<p>The <code>nng_http</code> object is created by either <a href="api//api/http.html#creating-connections"><code>nng_http_client_connect</code></a> or by an HTTP server
object which then passes it to an [<code>nng_http_handler</code>] callback function.</p>
<h3 id="http-method"><a class="header" href="#http-method">HTTP Method</a></h3>
<pre><code class="language-c">void nng_http_set_method(nng_http *conn, const char *method);
const char *nng_http_get_method(nng_http *conn);
</code></pre>
<p>Each HTTP transaction has a single verb, or method, that is used. The most common methods are “GET”, “HEAD”, and “POST”,
but a number of others are possible.</p>
<p>The <a name="a002"></a><code>nng_http_set_method</code> function specifies the HTTP method to use for the transaction.
The default is “GET”. HTTP methods are case sensitive, and generally upper-case, such as “GET”, “POST”, “HEAD”,
and so forth. This function silently truncates any method to 32-characters. (There are no defined methods longer than this.)</p>
<p>The <a name="a003"></a><code>nng_http_get_method</code> function is used, typically on a server, to retrieve the method the client
set when issuing the transaction.</p>
<h3 id="http-uri"><a class="header" href="#http-uri">HTTP URI</a></h3>
<pre><code class="language-c">nng_err nng_http_set_uri(nng_http *conn, const char *uri, const char *query);
const char *nng_http_get_uri(nng_http *conn);
</code></pre>
<p>The <a name="a004"></a><code>nng_http_set_uri</code> function sets the <a name="a005"></a>URI, which normally appears like a path such as “/docs/index.html”,
for the next transaction on <em>conn</em>. It sets the URI to <em>uri</em>, and, if <em>query</em> is not <code>NULL</code>, also appends the
contents of <em>query</em>, separated by either the ‘?’ or ‘&amp;’ character, depending on whether <em>uri</em> already
contains a query string. It may return <a href="api//api/errors.html#NNG_ENOMEM"><code>NNG_ENOMEM</code></a>, or <a href="api//api/errors.html#NNG_EMSGSIZE"><code>NNG_EMSGSIZE</code></a> if the the result is too long,
or <a href="api//api/errors.html#NNG_EINVAL"><code>NNG_EINVAL</code></a> if there is some other problem with the URI.</p>
<div class="mdbook-alerts mdbook-alerts-note">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  note
</p>
<p>The <em>uri</em> and <em>query</em> must be already percent-encoded if necessary.</p>
</div>
<p>The <a name="a006"></a><code>nni_http_get_uri</code> function is used to obtain the URI that was previously set by <code>nng_http_set_uri</code>.
If the URI is unset (such as for a freshly created connection), then it returns <code>NULL</code>. The returned value
will have any query concatenated, for example “/api/get_user.cgi?name=garrett”.</p>
<h3 id="http-version"><a class="header" href="#http-version">HTTP Version</a></h3>
<pre><code class="language-c">nng_err nng_http_set_version(nng_http *conn, const char *version);
const char *nng_http_get_version(nng_http *conn);
</code></pre>
<p>The <a name="a007"></a><code>nng_http_set_version</code> function is used to select the HTTP protocol version to use for the
exchange. At present, only the values <code>NNG_HTTP_VERSION_1_0</code> and <code>NNG_HTTP_VERSION_1_1</code> (corresponding to
“HTTP/1.0” and “HTTP/1.1”) are supported. NNG will default to using “HTTP/1.1” if this function is not called.
If an unsupported version is supplied, <a href="api//api/errors.html#NNG_ENOTSUP"><code>NNG_ENOTSUP</code></a> will be returned, otherwise zero.</p>
<p>The <a name="a008"></a><code>nng_http_get_version</code> function is used to determine the version the client selected. Normally
there is little need to use this, but there are some subtle semantic differences between HTTP/1.0 and HTTP/1.1.</p>
<div class="mdbook-alerts mdbook-alerts-tip">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  tip
</p>
<p>There are few, if any, remaining HTTP/1.0 implementations that are not also capable of HTTP/1.1.
It might be easiest to just fail any request coming in that is not HTTP/1.1.</p>
</div>
<div class="mdbook-alerts mdbook-alerts-note">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  note
</p>
<p>NNG does not support HTTP/2 or HTTP/3 at this time.</p>
</div>
<h3 id="http-status"><a class="header" href="#http-status">HTTP Status</a></h3>
<pre><code class="language-c">typedef enum ... nng_http_status;
nng_http_status nng_http_get_status(nng_http *conn);
const char *nng_http_get_reason(nng_http_conn *conn);
void nng_http_set_status(nng_http *conn, nng_http_status status, const char *reason);
</code></pre>
<p>The <a name="a009"></a><code>nng_http_get_status</code> function obtains the numeric code (typipcally numbered from 100 through 599) returned
by the server in the last exchange on <em>conn</em>. (If no exchange has been performed yet, the result is undefined.)
The value is returned as an <a name="a010"></a><code>nng_http_status</code>.</p>
<p>A descriptive message matching the status code is returned by <a name="a011"></a><code>nng_http_get_reason</code>.</p>
<p>The <a name="a012"></a><code>nng_http_set_status</code> function is used on a server in a handler callback to set the status code that will be
reported to the client to <em>status</em>, and the associated text (reason) to <em>reason</em>. If <em>reason</em> is <code>NULL</code>,
then a built in reason based on the <em>status</em> will be used instead.</p>
<div class="mdbook-alerts mdbook-alerts-tip">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  tip
</p>
<p>Callbacks used on the server may wish to use <a href="api//TODO.html"><code>nng_http_server_set_error</code></a> or <a href="api//TODO.html"><code>nng_http_server_set_redirect</code></a> instead of
<code>nng_http_set_status</code>, because those functions will also set the response body to a suitable HTML document
for display to users.</p>
</div>
<p>Status codes are defined by the IETF. Here are definitions that NNG provides for convenience:</p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Code</th><th>Reason Text</th><th>Notes</th></tr></thead><tbody>
<tr><td><code>NNG_HTTP_STATUS_CONTINUE</code><a name="#NNG_HTTP_STATUS_CONTINUE"></a></td><td>100</td><td>Continue</td><td>Partial transfer, client may send body.</td></tr>
<tr><td><code>NNG_HTTP_STATUS_SWITCHING</code><a name="#NNG_HTTP_STATUS_SWITCHING"></a></td><td>101</td><td>Switching Protocols</td><td>Used when upgrading or hijacking a connection.</td></tr>
<tr><td><code>NNG_HTTP_STATUS_PROCESSING</code><a name="#NNG_HTTP_STATUS_PROCESSING"></a></td><td>102</td><td>Processing</td><td></td></tr>
<tr><td><code>NNG_HTTP_STATUS_OK</code><a name="#NNG_HTTP_STATUS_OK"></a></td><td>200</td><td>OK</td><td>Successful result.</td></tr>
<tr><td><code>NNG_HTTP_STATUS_CREATED</code><a name="#NNG_HTTP_STATUS_CREATED"></a></td><td>201</td><td>Created</td><td>Resource created successfully.</td></tr>
<tr><td><code>NNG_HTTP_STATUS_ACCEPTED</code><a name="#NNG_HTTP_STATUS_ACCEPTED"></a></td><td>202</td><td>Created</td><td>Request accepted for future processing.</td></tr>
<tr><td><code>NNG_HTTP_STATUS_NOT_AUTHORITATIVE</code><a name="#NNG_HTTP_STATUS_NOT_AUTHORITATIVE"></a></td><td>203</td><td>Not Authoritative</td><td>Request successful, but modified by proxy.</td></tr>
<tr><td><code>NNG_HTTP_STATUS_NO_CONTENT</code><a name="#NNG_HTTP_STATUS_NO_CONTENT"></a></td><td>204</td><td>No Content</td><td>Request successful, no content returned.</td></tr>
<tr><td><code>NNG_HTTP_STATUS_RESET_CONTENT</code><a name="#NNG_HTTP_STATUS_NO_CONTENT"></a></td><td>205</td><td>Reset Content</td><td>Request successful, client should reload content.</td></tr>
<tr><td><code>NNG_HTTP_STATUS_PARTIAL_CONTENT</code><a name="#NNG_HTTP_STATUS_NO_CONTENT"></a></td><td>206</td><td>Partial Content</td><td>Response to a range request.</td></tr>
<tr><td><code>NNG_HTTP_STATUS_MULTI_STATUS</code><a name="#NNG_HTTP_STATUS_MULTI_STATUS"></a></td><td>207</td><td>Multi-Status</td><td>Used with WebDAV.</td></tr>
<tr><td><code>NNG_HTTP_STATUS_ALREADY_REPORTED</code><a name="#NNG_HTTP_STATUS_ALREADY_REPORTED"></a></td><td>208</td><td>Already Reported</td><td>Used with WebDAV.</td></tr>
<tr><td><code>NNG_HTTP_STATUS_IM_USED</code><a name="#NNG_HTTP_STATUS_IM_USED"></a></td><td>226</td><td>IM Used</td><td>Used with delta encodings, rarely supported.</td></tr>
<tr><td><code>NNG_HTTP_STATUS_MULTIPLE_CHOICES</code><a name="#NNG_HTTP_STATUS_MULTIPLE_CHOICES"></a></td><td>300</td><td>Multiple Choices</td><td>Multiple responses possible, client should choose.</td></tr>
<tr><td><code>NNG_HTTP_STATUS_MOVED_PERMANENTLY</code><a name="#NNG_HTTP_STATUS_MOVED_PERMANENTLY"></a></td><td>301</td><td>Moved Permanently</td><td>Permanent redirection, may be saved by client.</td></tr>
<tr><td><code>NNG_HTTP_STATUS_FOUND</code><a name="#NNG_HTTP_STATUS_FOUND"></a></td><td>302</td><td>Found</td><td>Temporary redirection, client may switch to GET.</td></tr>
<tr><td><code>NNG_HTTP_STATUS_SEE_OTHER</code><a name="#NNG_HTTP_STATUS_SEE_OTHER"></a></td><td>303</td><td>See Other</td><td>Redirect, perhaps after a success POST or PUT.</td></tr>
<tr><td><code>NNG_HTTP_STATUS_NOT_MODIFIED</code><a name="#NNG_HTTP_STATUS_NOT_MODIFIED"></a></td><td>304</td><td>Not Modified</td><td>Resource not modified, client may use cached version.</td></tr>
<tr><td><code>NNG_HTTP_STATUS_USE_PROXY</code><a name="#NNG_HTTP_STATUS_USE_PROXY"></a></td><td>305</td><td>Use Proxy</td><td></td></tr>
<tr><td><code>NNG_HTTP_STATUS_TEMPORARY_REDIRECT</code><a name="#NNG_HTTP_STATUS_TEMPORARY_REDIRECT"></a></td><td>307</td><td>Temporary Redirect</td><td>Temporary redirect, preserves method.</td></tr>
<tr><td><code>NNG_HTTP_STATUS_PERMANENT_REDIRECT</code><a name="#NNG_HTTP_STATUS_PERMANENT_REDIRECT"></a></td><td>308</td><td>Permanent Redirect</td><td>Permanent redirect.</td></tr>
<tr><td><code>NNG_HTTP_STATUS_BAD_REQUEST</code><a name="#NNG_HTTP_STATUS_BAD_REQUEST"></a></td><td>400</td><td>Bad Request</td><td>Generic problem with the request.</td></tr>
<tr><td><code>NNG_HTTP_STATUS_UNAUTHORIZED</code><a name="#NNG_HTTP_STATUS_UNAUTHORIZED"></a></td><td>401</td><td>Unauthorized</td><td>Indicates a problem with authentication.</td></tr>
<tr><td><code>NNG_HTTP_STATUS_PAYMENT_REQUIRED</code><a name="#NNG_HTTP_STATUS_PAYMENT_REQUIRED"></a></td><td>402</td><td>Payment Required</td><td></td></tr>
<tr><td><code>NNG_HTTP_STATUS_FORBIDDEN</code><a name="#NNG_HTTP_STATUS_FORBIDDEN"></a></td><td>403</td><td>Forbidden</td><td>No permission to access resource.</td></tr>
<tr><td><code>NNG_HTTP_STATUS_NOT_FOUND</code><a name="#NNG_HTTP_STATUS_NOT_FOUND"></a></td><td>404</td><td>Not Found</td><td>Resource does not exist.</td></tr>
<tr><td><code>NNG_HTTP_STATUS_METHOD_NOT_ALLOWED</code><a name="#NNG_HTTP_STATUS_METHOD_NOT_ALLOWED"></a></td><td>405</td><td>Method Not Allowed</td><td>Resource does not support the method.</td></tr>
<tr><td><code>NNG_HTTP_STATUS_METHOD_NOT_ACCEPTABLE</code><a name="#NNG_HTTP_STATUS_METHOD_NOT_ACCEPTABLE"></a></td><td>406</td><td>Not Acceptable</td><td>Could not satisfy accept requirements.</td></tr>
<tr><td><code>NNG_HTTP_STATUS_PROXY_AUTH_REQUIRED</code><a name="#NNG_HTTP_STATUS_PROXY_AUTH_REQUIRED"></a></td><td>407</td><td>Proxy Authentication Required</td><td>Proxy requires authentication.</td></tr>
<tr><td><code>NNG_HTTP_STATUS_REQUEST_TIMEOUT</code><a name="#NNG_HTTP_STATUS_REQUEST_TIMEOUT"></a></td><td>408</td><td>Request Timeout</td><td>Timed out waiting for request.</td></tr>
<tr><td><code>NNG_HTTP_STATUS_CONFLICT</code><a name="#NNG_HTTP_STATUS_CONFLICT"></a></td><td>409</td><td>Conflict</td><td>Conflicting request.</td></tr>
<tr><td><code>NNG_HTTP_STATUS_GONE</code><a name="#NNG_HTTP_STATUS_GONE"></a></td><td>410</td><td>Gone</td><td>Resource no longer exists.</td></tr>
<tr><td><code>NNG_HTTP_STATUS_LENGTH_REQUIRED</code><a name="#NNG_HTTP_STATUS_LENGTH_REQUIRED"></a></td><td>411</td><td>Length Required</td><td>Missing Content-Length.</td></tr>
<tr><td><code>NNG_HTTP_STATUS_PRECONDITION_FAILED</code><a name="#NNG_HTTP_STATUS_PRECONDITION_FAILED"></a></td><td>412</td><td>Precondition Failed</td><td></td></tr>
<tr><td><code>NNG_HTTP_STATUS_CONTENT_TOO_LARGE</code><a name="#NNG_HTTP_STATUS_PAYLOAD_TOO_LARGE"></a></td><td>413</td><td>Content Too Large</td><td></td></tr>
<tr><td><code>NNG_HTTP_STATUS_URI_TOO_LONG</code><a name="#NNG_HTTP_STATUS_URI_TOO_LONG"></a></td><td>414</td><td>URI Too Long</td><td></td></tr>
<tr><td><code>NNG_HTTP_STATUS_UNSUPPORTED_MEDIA_TYPE</code><a name="#NNG_HTTP_STATUS_UNSUPPORTED_MEDIA_TYPE"></a></td><td>415</td><td>Unsupported Media Type</td><td></td></tr>
<tr><td><code>NNG_HTTP_STATUS_RANGE_NOT_SATISFIABLE</code><a name="#NNG_HTTP_STATUS_RANGE_NOT_SATISFIABLE"></a></td><td>416</td><td>Range Not Satisfiable</td><td></td></tr>
<tr><td><code>NNG_HTTP_STATUS_EXPECTATION_FAILED</code><a name="#NNG_HTTP_STATUS_EXPECTATION_FAILED"></a></td><td>417</td><td>Expectation Failed</td><td></td></tr>
<tr><td><code>NNG_HTTP_STATUS_TEAPOT</code><a name="#NNG_HTTP_STATUS_TEAPOT"></a></td><td>418</td><td>I Am A Teapot</td><td>RFC 2324.</td></tr>
<tr><td><code>NNG_HTTP_STATUS_UNPROCESSABLE_ENTITY</code><a name="#NNG_HTTP_STATUS_UNPROCESSABLE_ENTITY"></a></td><td>422</td><td>Unprocessable Entity</td><td></td></tr>
<tr><td><code>NNG_HTTP_STATUS_LOCKED</code><a name="#NNG_HTTP_STATUS_LOCKED"></a></td><td>423</td><td>Locked</td><td></td></tr>
<tr><td><code>NNG_HTTP_STATUS_FAILED_DEPENDENCY</code><a name="#NNG_HTTP_STATUS_FAILED_DEPENDENCY"></a></td><td>424</td><td>Failed Dependency</td><td></td></tr>
<tr><td><code>NNG_HTTP_STATUS_TOO_EARLY</code><a name="#NNG_HTTP_STATUS_TOO_EARLY"></a></td><td>425</td><td>Too Early</td><td></td></tr>
<tr><td><code>NNG_HTTP_STATUS_UPGRADE_REQUIRED</code><a name="#NNG_HTTP_STATUS_UPGRADE_REQUIRED"></a></td><td>426</td><td>Upgrade Required</td><td></td></tr>
<tr><td><code>NNG_HTTP_STATUS_PRECONDITION_REQUIRED</code><a name="#NNG_HTTP_STATUS_PRECONDITION_REQUIRED"></a></td><td>428</td><td>Precondition Required</td><td></td></tr>
<tr><td><code>NNG_HTTP_STATUS_TOO_MANY_REQUESTS</code><a name="#NNG_HTTP_STATUS_TOO_MANY_REQUESTS"></a></td><td>429</td><td>Too Many Requests</td><td></td></tr>
<tr><td><code>NNG_HTTP_STATUS_HEADERS_TOO_LARGE</code><a name="#NNG_HTTP_STATUS_HEADERS_TOO_LARGE"></a></td><td>431</td><td>Headers Too Large</td><td></td></tr>
<tr><td><code>NNG_HTTP_STATUS_UNAVAIL_LEGAL_REASONS</code><a name="#NNG_HTTP_STATUS_UNAVAIL_LEGAL_REASONS"></a></td><td>451</td><td>Unavailable For Legal Reasons</td><td></td></tr>
<tr><td><code>NNG_HTTP_STATUS_INTERNAL_SERVER_ERROR</code><a name="#NNG_HTTP_STATUS_INTERNAL_SERVER_ERROR"></a></td><td>500</td><td>Internal Server Error</td><td></td></tr>
<tr><td><code>NNG_HTTP_STATUS_NOT_IMPLEMENTED</code><a name="#NNG_HTTP_STATUS_NOT_IMPLEMENTED"></a></td><td>501</td><td>Not Implemented</td><td>Server does not implement method.</td></tr>
<tr><td><code>NNG_HTTP_STATUS_BAD_GATEWAY</code><a name="#NNG_HTTP_STATUS_BAD_GATEWAY"></a></td><td>502</td><td>Bad Gateway</td><td></td></tr>
<tr><td><code>NNG_HTTP_STATUS_SERVICE_UNAVAILALE</code><a name="#NNG_HTTP_STATUS_SERVICE_UNAVAILABLE"></a></td><td>503</td><td>Service Unavailable</td><td></td></tr>
<tr><td><code>NNG_HTTP_STATUS_GATEWAY_TIMEOUT</code><a name="#NNG_HTTP_STATUS_GATEWAY_TIMEOUT"></a></td><td>504</td><td>Gateway TImeout</td><td></td></tr>
<tr><td><code>NNG_HTTP_STATUS_HTTP_VERSION_NOT_SUPP</code><a name="#NNG_HTTP_STATUS_HTTP_VERSION_NOT_SUPP"></a></td><td>505</td><td>HTTP Version Not Supported</td><td></td></tr>
<tr><td><code>NNG_HTTP_STATUS_VARIANT_ALSO_NEGOTIATES</code><a name="#NNG_HTTP_STATUS_VARIANT_ALSO_NEGOTIATES"></a></td><td>506</td><td>Variant Also Negotiates</td><td></td></tr>
<tr><td><code>NNG_HTTP_STATUS_INSUFFICIENT_STORAGE</code><a name="#NNG_HTTP_STATUS_INSUFFICIENT_STORAGE"></a></td><td>507</td><td>Variant Also Negotiates</td><td></td></tr>
<tr><td><code>NNG_HTTP_STATUS_LOOP_DETECTED</code><a name="#NNG_HTTP_STATUS_LOOP_DETECTED"></a></td><td>508</td><td>Loop Detected</td><td></td></tr>
<tr><td><code>NNG_HTTP_STATUS_NOT_EXTENDED</code><a name="#NNG_HTTP_STATUS_NOT_EXTENDED"></a></td><td>510</td><td>Not Extended</td><td></td></tr>
<tr><td><code>NNG_HTTP_STATUS_NETWORK_AUTH_REQUIRED</code><a name="#NNG_HTTP_STATUS_NETWORK_AUTH_REQUIRED"></a></td><td>511</td><td>Network Authentication Required</td><td></td></tr>
</tbody></table>
</div>
<h3 id="retrieving-headers"><a class="header" href="#retrieving-headers">Retrieving Headers</a></h3>
<pre><code class="language-c">const char *nng_http_get_header(nng_http *conn, const char *key);
bool nng_http_next_header(nng_http *conn, const char **keyp, const char **valuep, void **next);
</code></pre>
<p>The <a name="a013"></a><code>nng_http_get_header</code> returns the header value matching <em>key</em> that was received over <em>conn</em>,
or <code>NULL</code> if no such header exists.</p>
<p>Thus, if <em>conn</em> is a client connection, then this function returns the the header value
sent by the server as part of a response, whereas if it is a server connection, it returns
the header value sent by the client as part of the request.</p>
<p>If multiple headers are present with the same key, they may be returned as a combined value,
with individual values separated by commas, but this behavior is not guaranteed.</p>
<p>The <a name="a014"></a><code>nng_http_next_header</code> function iterates over all the headers, using the same list
that <code>nng_http_get_header</code> uses. To start, it is called with <em>next</em> initialized to <code>NULL</code>.
If a header was found, then it returns <code>true</code>, and sets <em>keyp</em> and <em>valuep</em> to values containing
the header name and value. It also updates <em>next</em>, which should be used for the next iteration.</p>
<p>Once <code>nng_http_next_header</code> returns <code>false</code>, further calls with the same parameters will continue to do so.
The scan can be rest by setting <em>next</em> to <code>NULL</code>.</p>
<h3 id="modifying-headers"><a class="header" href="#modifying-headers">Modifying Headers</a></h3>
<pre><code class="language-c">nng_err nng_http_add_header(nng_http *conn, const char *key, const char *val);
nng_err nng_http_set_header(nng_http *conn, const char *key, const char *val);
void nng_http_del_header(nng_http *conn, const char *key);
</code></pre>
<p>The <a name="a015"></a><code>nng_http_add_header</code>, <a name="a016"></a><code>nng_http_set_header</code>, and <a name="a017"></a><code>nng_http_del_header</code> functions are
used to add a modify either the request or response headers for <em>conn</em> prior to sending to the connected peer on <em>conn</em>.</p>
<p>Thus, if the <em>conn</em> is a client connection created by <a href="api//api/http.html#creating-connections"><code>nng_http_client_connect</code></a>, then the request headers are modified.
Conversely, if it is a connection created by an HTTP server and used in a callback function, then the response headers are modified.</p>
<p>The <code>nng_http_add_header</code> function adds a header with the name <em>key</em>, and the value <em>val</em>, to the list of headers.
In so doing, it may bring collapse multiple headers with the same name into a comma separated list, following
the syntax specified in RFC 9110. The function may return <a href="api//api/errors.html#NNG_ENOMEM"><code>NNG_ENOMEM</code></a>, <a href="api//api/errors.html#NNG_EMSGSIZE"><code>NNG_EMSGSIZE</code></a>, or <a href="api//api/errors.html#NNG_EINVAL"><code>NNG_EINVAL</code></a>.</p>
<p>The <code>nng_http_set_header</code> function adds the header if it does not already exist, but replaces any and all previously existing
headers with the same name <em>key</em>, if they exist. In all other respects it behaves similarly to <code>nng_http_add_header</code>.</p>
<p>The <code>nng_http_del_header</code> removes all headers with name <em>key</em>.</p>
<div class="mdbook-alerts mdbook-alerts-note">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  note
</p>
<p>Some HTTP headers have special semantics, such as the “Host”, “Content-Length”, and “Content-Type” headers.
This implementation may apply those semantics, in order to conform to the specifications for HTTP, such
as by guaranting that only a single instance of one of these headers is present.</p>
</div>
<h3 id="retrieving-body-content"><a class="header" href="#retrieving-body-content">Retrieving Body Content</a></h3>
<pre><code class="language-c">void nng_http_get_body(nng_http_conn *conn, void **datap, size_t *sizep);
</code></pre>
<p>The <a name="a018"></a><code>nng_http_get_data</code> obtains the most recently received request or
response body. This will be <code>NULL</code> if the content has not been retrieved
properly yet, or if the peer did not any content. (Some requests are defined
to never have body content, such as “HEAD”.)</p>
<h3 id="storing-body-content"><a class="header" href="#storing-body-content">Storing Body Content</a></h3>
<pre><code class="language-c">void nng_http_set_body(nng_http_conn *conn, void *data, size_t size);
void nng_http_copy_body(nng_http_conn *conn, const void *data, size_t size);
</code></pre>
<p>The <a name="a019"></a><code>nng_http_set_data</code> function sets the outgoing body content to <em>data</em>,
which must be <em>size</em> bytes long. The caller must ensure that <em>data</em> remains
valid for the duration of the transaction.</p>
<p>The <a name="a020"></a><code>nng_http_copy_data</code> function makes a copy of <em>data</em>, which
will be freed automatically when the transaction is finished, but otherwise
behaves like <code>nng_http_set_data</code>.</p>
<p>On client <em>conn</em> objects, these functions update the request object, but on server
<em>conn</em> objects, they update the response object.</p>
<p>These functions also update the relevant “Content-Length” header.</p>
<div class="mdbook-alerts mdbook-alerts-note">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  note
</p>
<p>The current framework does not support sending data via chunked
transfer-encoding.</p>
</div>
<div class="mdbook-alerts mdbook-alerts-tip">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  tip
</p>
<p>It is a good idea to also set the <code>Content-Type</code> header.</p>
</div>
<h3 id="closing-the-connection"><a class="header" href="#closing-the-connection">Closing the Connection</a></h3>
<pre><code class="language-c">void nng_http_close(nng_http *conn);
</code></pre>
<p>The <a name="a021"></a><code>nng_http_close</code> function closes the supplied HTTP connection <em>conn</em>,
including any disposing of any underlying file descriptors or related resources.</p>
<p>Once this function, no further access to the <em>conn</em> structure may be made.</p>
<h3 id="reset-connection-state"><a class="header" href="#reset-connection-state">Reset Connection State</a></h3>
<pre><code class="language-c">void nng_http_reset(nng_http *conn);
</code></pre>
<p>The <a name="a022"></a><code>nng_http_reset</code> function resets the request and response state of the
the connection <em>conn</em>, so that it is just as if it had been freshly created with
<a href="api//api/http.html#creating-connections"><code>nng_http_client_connect</code></a> or passed into a handler function for a server callback.</p>
<p>The intended purpose of this function is to clear the object state before reusing the <em>conn</em> for
subsequent transactions.</p>
<h3 id="direct-read-and-write"><a class="header" href="#direct-read-and-write">Direct Read and Write</a></h3>
<pre><code class="language-c">void nng_http_read(nng_http *conn, nng_aio *aio);
void nng_http_write(nng_http *conn, nng_aio *aio);
void nng_http_read_all(nng_http *conn, nng_aio *aio);
void nng_http_write_all(nng_http *conn, nng_aio *aio);
</code></pre>
<p>The <a name="a023"></a><code>nng_http_read</code> and <a name="a024"></a><code>nng_http_write</code> functions read or write data asynchronously from or to the
connection <em>conn</em>, using the <a href="api//api/aio.html#scatter-gather-vectors"><code>nng_iov</code></a> that is set in <em>aio</em> with <a href="api//api/aio.html#scatter-gather-vectors"><code>nng_aio_set_iov</code></a>.
These functions will complete as soon as any data is transferred.
Use <a href="api//api/aio.html#result-of-operation"><code>nng_aio_count</code></a> to determine how much data was actually transferred.</p>
<p>The <a name="a025"></a><code>nng_http_read_all</code> and <a name="a026"></a><code>nng_http_write_all</code> functions perform the same task, but will keep resubmitting
operations until the the entire amount of data requested by the <a href="api//api/aio.html#scatter-gather-vectors"><code>nng_iov</code></a> is transferred.</p>
<div class="mdbook-alerts mdbook-alerts-note">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  note
</p>
<p>These functions perform no special handling for chunked transfers.</p>
</div>
<p>These functions are most likely to be useful after hijacking the connection with <a href="api//api/http.html#hijacking-connections"><code>nng_http_hijack</code></a>.
They can be used to transfer request or response body data as well.</p>
<h3 id="hijacking-connections"><a class="header" href="#hijacking-connections">Hijacking Connections</a></h3>
<pre><code class="language-c">nng_err nng_http_hijack(nng_http *conn);
</code></pre>
<p>TODO: This API will change to convert the conn into a stream object.</p>
<p>The <a name="a027"></a><code>nng_http_hijack</code> function hijacks the connection <em>conn</em>, causing it
to be disassociated from the HTTP server where it was created.</p>
<p>The purpose of this function is the creation of HTTP upgraders (such as
WebSocket), where the underlying HTTP connection will be taken over for
some other purpose, and should not be used any further by the server.</p>
<p>This function is most useful when called from a handler function.
(See [<code>nng_http_handler_alloc</code>].)</p>
<div class="mdbook-alerts mdbook-alerts-note">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  note
</p>
<p>It is the responsibility of the caller to dispose of the underlying connection when it is no longer needed.
Furthermore, the HTTP server will no longer send any responses to the hijacked connection, so the caller should do that as well if appropriate.
(See [<code>nng_http_write_response</code>].)</p>
</div>
<div class="mdbook-alerts mdbook-alerts-tip">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  tip
</p>
<p>This function is intended to facilitate uses cases that involve changing the protocol from HTTP, such as WebSocket.
Most applications will never need to use this function.</p>
</div>
<h3 id="obtaining-tls-connection-details"><a class="header" href="#obtaining-tls-connection-details">Obtaining TLS Connection Details</a></h3>
<pre><code class="language-c">nng_err nng_http_peer_cert(nng_http_conn *conn, nng_tls_cert **certp);
</code></pre>
<p>TODO: We need to document the cert API.</p>
<p>The <a name="a028"></a><code>nng_http_peer_cert</code> function will obtain the TLS certificate object for the peer, if one is available.
This can then be used for additional authentication or identity specific logic.</p>
<p>The certificate must be released with [<code>nng_tls_cert_free</code>] when no longer in use.
See [<code>nng_tls_cert</code>] for more information about working with TLS certificates.</p>
<div class="mdbook-alerts mdbook-alerts-note">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  note
</p>
<p>While it should be obvious that this function is only available when using HTTPS,
it also requires that peer authentication is in use, and may require that the underlying
TLS engine support peer certificate colleciton. (Some minimal configurations elide this
to save space in embedded environments.)</p>
</div>
<h2 id="client-api"><a class="header" href="#client-api">Client API</a></h2>
<p>The NNG client API consists of an API for creating connections, and an API for performing
transactions on those connections.</p>
<h3 id="client-object"><a class="header" href="#client-object">Client Object</a></h3>
<pre><code class="language-c">typedef struct nng_http_client nng_http_client;
</code></pre>
<p>The <a name="a029"></a><code>nng_http_client</code> object is the client side creator for <a href="api//api/http.html#connection-object"><code>nng_http</code></a> objects.
It is analogous to a <a href="api//TODO.html">dialer</a> object used elsewhere in NNG, but it specifically is only for HTTP.</p>
<h3 id="create-a-client"><a class="header" href="#create-a-client">Create a Client</a></h3>
<pre><code class="language-c">void nng_http_client_alloc(nng_http_client *clientp, const nng_url *url);
</code></pre>
<p>The <a name="a030"></a><code>nng_http_client_alloc</code> allocates an HTTP client suitable for
connecting to the server identified by <em>url</em> and stores a pointer to
it in the location referenced by <em>clientp</em>.</p>
<h3 id="destroy-a-client"><a class="header" href="#destroy-a-client">Destroy a Client</a></h3>
<pre><code class="language-c">void nng_http_client_free(nng_http_client *client);
</code></pre>
<p>The <a name="a031"></a><code>nng_http_client_free</code> connection destroys the client object and any
of its resources.</p>
<div class="mdbook-alerts mdbook-alerts-note">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  note
</p>
<p>Any connections created by <a href="api//api/http.html#creating-connections"><code>nng_http_client_connect</code></a> are not affected by this function,
and must be closed explicitly as needed.</p>
</div>
<h3 id="client-tls"><a class="header" href="#client-tls">Client TLS</a></h3>
<pre><code class="language-c">nng_err nng_http_client_get_tls(nng_http_client *client, nng_tls_config **tlsp);
nng_err nng_http_client_set_tls(nng_http_client *client, nng_tls_config *tls);
</code></pre>
<p>The <a name="a032"></a><code>nng_http_client_get_tls</code> and <a name="a033"></a><code>nng_http_client_set_tls</code> functions are used to
retrieve or change the <a href="api//TODO.html">TLS configuration</a> used when making outbound connections, enabling
<a name="a034"></a>TLS as a result.</p>
<p>If TLS has not been previously configured on <em>client</em>, then <code>nng_http_client_get_tls</code> will return <a href="api//api/errors.html#NNG_EINVAL"><code>NNG_EINVAL</code></a>.
Both functions will return <a href="api//api/errors.html#NNG_ENOTSUP"><code>NNG_ENOTSUP</code></a> if either HTTP or TLS is not supported.</p>
<p>Calling <code>nng_http_client_set_tls</code> invalidates any client previously obtained with
<code>nng_http_client_get_tls</code>, unless a separate hold on the object was obtained.</p>
<p>Once TLS is enabled for an <code>nng_http_client</code>, it is not possible to disable TLS.</p>
<div class="mdbook-alerts mdbook-alerts-note">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  note
</p>
<p>The TLS configuration itself cannot be changed once it has been used to create a connection,
such as by calling <a href="api//api/http.html#creating-connections"><code>nng_http_client_connect</code></a>, but a new one can be installed in the client.
Existing connections will use the TLS configuration that there were created with.</p>
</div>
<h3 id="creating-connections"><a class="header" href="#creating-connections">Creating Connections</a></h3>
<pre><code class="language-c">#include &lt;nng/http.h&gt;

void nng_http_client_connect(nng_http_client *client, nng_aio *aio);
</code></pre>
<p>The <a name="a035"></a><code>nng_http_client_connect</code> function makes an outgoing connection to the
server configured for <em>client</em>, and creates an <a href="api//api/http.html#connection-object"><code>nng_http</code></a> object for the connection.</p>
<p>This is done asynchronously, and when the operation succeseds the connection may be
retried from the <em>aio</em> using <a href="api//api/aio.html#inputs-and-outputs"><code>nng_aio_get_output</code></a> with index 0.</p>
<h4 id="example-1-connecting-to-google"><a class="header" href="#example-1-connecting-to-google">Example 1: Connecting to Google</a></h4>
<pre><code class="language-c">nng_aio *aio;
nng_url *url;
nng_http_client *client;
nng_http *conn;
nng_err rv;

// Error checks elided for clarity.
nng_url_parse(&amp;url, "http://www.google.com");
nng_aio_alloc(&amp;aio, NULL, NULL);
nng_http_client_alloc(&amp;client, url);

nng_http_client_connect(client, aio);

// Wait for connection to establish (or attempt to fail).
nng_aio_wait(aio);

if ((rv = nng_aio_result(aio)) != 0) {
    printf("Connection failed: %s\n", nng_strerror(rv));
} else {
    // Connection established, get it.
    conn = nng_aio_get_output(aio, 0);

    // ... do something with it here

    // Close the connection when done to avoid leaking it.
    nng_http_close(conn);
}
</code></pre>
<h3 id="preparing-a-transaction"><a class="header" href="#preparing-a-transaction">Preparing a Transaction</a></h3>
<h3 id="sending-the-request"><a class="header" href="#sending-the-request">Sending the Request</a></h3>
<pre><code class="language-c">void nng_http_write_request(nng_http *conn, nng_aio *aio);
</code></pre>
<p>The <a name="a036"></a><code>nng_http_write_request</code> function starts an asynchronous write of
the HTTP request associated with <em>conn</em>.
The entire request is sent,
including headers, and if present, the request body data.
(The request body can be set with
[<code>nng_http_set_data</code>] or [<code>nng_http_copy_data</code>].)</p>
<p>This function returns immediately, with no return value.
Completion of the operation is signaled via the <em>aio</em>, and the final result
may be obtained via <a href="api//api/aio.html#result-of-operation"><code>nng_aio_result</code></a>.</p>
<div class="mdbook-alerts mdbook-alerts-tip">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  tip
</p>
<p>Consider using the [<code>nng_http_transact</code>] function,
which provides a simpler interface for performing a complete HTTP client transaction.</p>
</div>
<h3 id="obtaining-the-response"><a class="header" href="#obtaining-the-response">Obtaining the Response</a></h3>
<pre><code class="language-c">void nng_http_read_response(nng_http *conn, nng_aio *aio);
</code></pre>
<p>The <a name="a037"></a><code>nng_http_read_response</code> function starts an asynchronous read from the
HTTP connection <em>conn</em>, reading an HTTP response into the response associated with <em>conn</em>, including all
of the related headers.</p>
<p>It does <em>not</em> transfer any response body. To do that, use <a href="api//api/http.html#direct-read-and-write"><code>nng_http_read_all</code></a> or <a href="api//api/http.html#direct-read-and-write"><code>nng_http_read</code></a>.</p>
<div class="mdbook-alerts mdbook-alerts-note">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  note
</p>
<p>At this time we have no API support for reading chunked transfers directly. Applications that
need to do so may use the direct read functions.</p>
</div>
<div class="mdbook-alerts mdbook-alerts-tip">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  tip
</p>
<p>An easier one-shot method for many use cases might be [<code>nng_http_transact</code>].</p>
</div>
<h3 id="submitting-the-transaction"><a class="header" href="#submitting-the-transaction">Submitting the Transaction</a></h3>
<pre><code class="language-c">void nng_http_transact(nng_http *conn, nng_aio *aio);
</code></pre>
<p>The HTTP request is issued, and the response processed, asynchronously by the <a name="a038"></a><code>nng_http_transact</code> function.
When the function is complete, the <em>aio</em> will be notified.</p>
<p>The <a name="a039"></a><code>nng_http_transact</code> function is used to perform a complete
HTTP exchange over the connection <em>conn</em>, sending the request
and attached body data to the remote server, and reading the response.</p>
<p>The entire response is read, including any associated body, which can
subsequently be obtained using [<code>nng_http_get_data</code>].</p>
<p>This function is intended to make creation of client applications easier,
by performing multiple asynchronous operations required to complete an
entire HTTP transaction.</p>
<p>If an error occurs, the caller should close <em>conn</em> with <a href="api//api/http.html#closing-the-connection"><code>nng_http_close</code></a>, as it may not
necessarily be usable with other transactions.</p>
<div class="mdbook-alerts mdbook-alerts-warning">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  warning
</p>
<p>If the remote server tries to send an extremely large buffer,
then a corresponding allocation will be made, which can lead to denial
of service attacks.
Client applications should take care to use this only with reasonably
trust-worthy servers.</p>
</div>
<div class="mdbook-alerts mdbook-alerts-note">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  note
</p>
<p>A given connection <em>conn</em> should be used with only one
operation or transaction at a time as HTTP/1.1 has no support for
request interleaving.</p>
</div>
<p>This function returns immediately, with no return value.
Completion of the operation is signaled via the <em>aio</em>, and the final result
may be obtained via [<code>nng_aio_result()</code>].</p>
<h3 id="response-body"><a class="header" href="#response-body">Response Body</a></h3>
<h2 id="server-api"><a class="header" href="#server-api">Server API</a></h2>
<h3 id="handlers"><a class="header" href="#handlers">Handlers</a></h3>
<pre><code class="language-c">typedef struct nng_http_handler nng_http_handler;
</code></pre>
<p>An <a name="a040"></a><code>nng_http_handler</code> encapsulates a function used used to handle
incoming requests on an HTTP server, routed based on method and URI,
and the parameters used with that function.</p>
<p>Every handler has a Request-URI to which it refers, which is determined by the <em>path</em> argument.
Only the path component of the Request URI is considered when determining whether the handler should be called.</p>
<p>This implementation limits the <em>path</em> length to 1024 bytes, including the
zero termination byte. This does not prevent requests with much longer
URIs from being supported, but doing so will require setting the handler to match a parent path in the tree using
[<code>nng_http_handler_set_tree</code>].</p>
<div class="mdbook-alerts mdbook-alerts-tip">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  tip
</p>
<p>The NNG HTTP framework is optimized for URLs shorter than 200 characters.</p>
</div>
<p>Additionally each handler has a method it is registered to handle
(the default is “GET” andc can be changed with [<code>nng_http_handler_set_method</code>]), and
optionally a “Host” header it can be matched against (see [<code>nng_http_handler_set_host</code>]).</p>
<p>In some cases, a handler may reference a logical tree rather (directory)
rather than just a single element.
(See [<code>nng_http_handler_set_tree</code>]).</p>
<h3 id="implementing-a-handler"><a class="header" href="#implementing-a-handler">Implementing a Handler</a></h3>
<pre><code class="language-c">typedef void (*nng_http_handler_func)(nng_http_conn *conn, void *arg, nng_aio *aio);

nng_err nng_http_handler_alloc(nng_http_handler **hp, const char *path, nng_http_handler_func cb);
</code></pre>
<p>The <a name="a041"></a><code>nng_http_handler_alloc</code> function allocates a generic handler
which will be used to process requests coming into an HTTP server.
On success, a pointer to the handler is stored at the located pointed to by <em>hp</em>.</p>
<p>The handler function is specified by <em>cb</em>.
This function uses the asynchronous I/O framework.</p>
<p>The function receives the connection on <em>conn</em>, and an optional data pointer that was set
previously with [<code>nng_http_handler_set_data</code>] as the second argument. The
final argument is the <a href="api//api/aio.html#asynchronous-io-handle"><code>nng_aio</code></a> <em>aio</em>, which must be “finished” to complete the operation.</p>
<p>The handler may call [<code>nng_http_write_response</code>] to send the response, or
it may simply let the framework do so on its behalf. The server will perform
this step if the callback has not already done so.</p>
<p>Response headers may be set using <a href="api//api/http.html#modifying-headers"><code>nng_http_set_header</code></a>, and request headers
may be accessed by using <a href="api//api/http.html#retrieving-headers"><code>nng_http_get_header</code></a>. They can also be iterated
over using <a href="api//api/http.html#retrieving-headers"><code>nng_http_next_header</code></a></p>
<p>Likewise the request body may be accessed, using <a href="api//api/http.html#retrieving-body-content"><code>nng_http_get_body</code></a>, and
the response body may be set using either <a href="api//api/http.html#storing-body-content"><code>nng_http_set_body</code></a> or <a href="api//api/http.html#storing-body-content"><code>nng_http_copy_body</code></a>.</p>
<div class="mdbook-alerts mdbook-alerts-note">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  note
</p>
<p>The request body is only collected for the handler if the
[<code>nng_http_handler_collect_body</code>] function has been called for the handler.</p>
</div>
<p>The HTTP status should be set for the transaction using <a href="api//api/http.html#http-status"><code>nng_http_set_status</code></a>.</p>
<p>Finally, the handler should finish the operation by calling the <a href="api//TODO.html"><code>nng_aio_finish</code></a> function
after having set the status to [<code>NNG_OK</code>].
If any other status is set on the <em>aio</em>, then a generic 500 response will be created and
sent, if possible, and the connection will be closed.</p>
<p>The <em>aio</em> may be scheduled for deferred completion using the <a href="api//TODO.html"><code>nng_aio_start</code></a>.</p>
<h3 id="serving-directories-and-files"><a class="header" href="#serving-directories-and-files">Serving Directories and Files</a></h3>
<pre><code class="language-c">nng_err nng_http_handler_alloc_directory(nng_http_handler **hp, const char *path, const char *dirname);
nng_err nng_http_handler_alloc_file(nng_http_handler **hp, const char *path, const char *filename);
</code></pre>
<p>The <a name="a042"></a><code>nng_http_handler_alloc_directory</code> and <a name="a043"></a><code>nng_http_handler_alloc_file</code>
create handlers pre-configured to act as static content servers for either a full
directory at <em>dirname</em>, or the single file at <em>filename</em>. These support the “GET” and “HEAD”
methods, and the directory variant will dynamically generate <code>index.html</code> content based on
the directory contents. These will also set the “Content-Type” if the file extension
matches one of the built-in values already known. If the no suitable MIME type can be
determined, the content type is set to “application/octet-stream”.</p>
<h3 id="static-handler"><a class="header" href="#static-handler">Static Handler</a></h3>
<pre><code class="language-c">nng_err nng_http_handler_alloc_static(nng_http_handler **hp, const char *path,
        const void *data, size_t size, const char *content_type);
</code></pre>
<p>The <a name="a044"></a><code>nng_http_handler_alloc_static</code> function creates a handler that
serves the content located in <em>data</em> (consisting of <em>size</em> bytes) at the URI <em>path</em>.
The <em>content_type</em> determines the “Content-Type” header. If <code>NULL</code> is specified
then a value of <code>application/octet-stream</code> is assumed.</p>
<h3 id="redirect-handler"><a class="header" href="#redirect-handler">Redirect Handler</a></h3>
<pre><code class="language-c">nng_err nng_http_handler_alloc_redirect(nng_http_handler **hp, const char *path,
        nng_http_status status, const char *location);
</code></pre>
<p>The <a name="a045"></a><code>nng_http_handler_alloc_redirect</code> function creates a handler with
a function that simply directions from the URI at <em>path</em> to the given <em>location</em>.</p>
<p>The HTTP reply it creates will be with [status code][<code>nng_http_status</code>] <em>status</em>,
which should be a 3XX code such as 301, and a <code>Location:</code> header will contain the URL
referenced by <em>location</em>, with any residual suffix from the request
URI appended.</p>
<div class="mdbook-alerts mdbook-alerts-tip">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  tip
</p>
<p>Use [<code>nng_http_handler_set_tree</code>] to redirect an entire tree.
For example, it is possible to redirect an entire HTTP site to another
HTTPS site by specifying <code>/</code> as the path and then using the base
of the new site, such as <code>https://newsite.example.com</code> as the new location.</p>
</div>
<div class="mdbook-alerts mdbook-alerts-tip">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  tip
</p>
<p>Be sure to use the appropriate value for <em>status</em>.
Permanent redirection should use [<code>NNG_HTTP_STATUS_STATUS_MOVED_PERMANENTLY</code>] (301)
and temporary redirections should use [<code>NNG_HTTP_STATUS_TEMPORARY_REDIRECT</code>] (307).
In REST APIs, using a redirection to supply the new location of an object
created with <code>POST</code> should use [<code>NNG_HTTP_STATUS_SEE_OTHER</code>] (303).</p>
</div>
<h3 id="collecting-request-body"><a class="header" href="#collecting-request-body">Collecting Request Body</a></h3>
<pre><code class="language-c">void nng_http_handler_collect_body(nng_http_handler *handler, bool want, size_t maxsz);
</code></pre>
<p>The <a name="a046"></a><code>nng_http_handler_collect_body</code> function requests that HTTP server
framework collect any request body for the request and attach it to the
connection before calling the callback for the <em>handler</em>.</p>
<p>Subsequently the data can be retrieved by the handler from the request with the
<a href="api//api/http.html#retrieving-body-content"><code>nng_http_get_body</code></a> function.</p>
<p>The collection is enabled if <em>want</em> is true.
Furthermore, the data that the client may sent is limited by the
value of <em>maxsz</em>.
If the client attempts to send more data than <em>maxsz</em>, then the
request will be terminated with [<code>NNG_HTTP_STATUS_CONTENT_TOO_LARGE</code>] (413).</p>
<div class="mdbook-alerts mdbook-alerts-tip">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  tip
</p>
<p>Limiting the size of incoming request data can provide protection
against denial of service attacks, as a buffer of the client-supplied
size must be allocated to receive the data.</p>
</div>
<blockquote>
<p>In order to provide an unlimited size, use <code>(size_t)-1</code> for <em>maxsz</em>.
The value <code>0</code> for <em>maxsz</em> can be used to prevent any data from being passed
by the client.</p>
</blockquote>
<blockquote>
<p>The built-in handlers for files, directories, and static data limit the
<em>maxsz</em> to zero by default.
Otherwise the default setting is to enable this capability with a default
value of <em>maxsz</em> of 1 megabyte.</p>
</blockquote>
<div class="mdbook-alerts mdbook-alerts-note">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  note
</p>
<p>NNG specifically does not support the <code>Chunked</code> transfer-encoding.
This is considered a bug, and is a deficiency for full HTTP/1.1 compliance.
However, few clients send data in this format, so in practice this should
create few limitations.</p>
</div>
<h3 id="setting-callback-argument"><a class="header" href="#setting-callback-argument">Setting Callback Argument</a></h3>
<pre><code class="language-c">void nng_http_handler_set_data(nng_http_handler *handler, void *data,
    void (*dtor)(void *));
</code></pre>
<p>The <a name="a047"></a><code>nng_http_handler_set_data</code> function is used to set the
<em>data</em> argument that will be passed to the callback.</p>
<p>Additionally, when the handler is deallocated, if <em>dtor</em> is not <code>NULL</code>,
then it will be called with <em>data</em> as its argument.
The intended use of this function is deallocate any resources associated with <em>data</em>.</p>
<h3 id="setting-the-method"><a class="header" href="#setting-the-method">Setting the Method</a></h3>
<pre><code class="language-c">void nng_http_handler_set_method(nng_http_handler *handler, const char *method);
</code></pre>
<p>The <a name="a048"></a><code>nng_http_handler_set_method</code> function sets the <em>method</em> that the
<em>handler</em> will be called for, such as “GET” or “POST”.
(By default the “GET” method is handled.)</p>
<p>If <em>method</em> is <code>NULL</code> the handler will be executed for all methods.
The handler may determine the actual method used with the <a href="api//api/http.html#http-method"><code>nng_http_get_method</code></a> function.</p>
<p>The server will automatically call “GET” handlers if the client
sends a “HEAD” request, and will suppress HTTP body data in the responses
sent for such requests.</p>
<div class="mdbook-alerts mdbook-alerts-note">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  note
</p>
<p>If <em>method</em> is longer than 32-bytes, it may be truncated silently.</p>
</div>
<h3 id="filtering-by-host"><a class="header" href="#filtering-by-host">Filtering by Host</a></h3>
<pre><code class="language-c">void nng_http_handler_set_host(nng_http_handler *handler, const char *host);
</code></pre>
<p>The <a name="a049"></a><code>nng_http_handler_set_host</code> function is used to limit the scope of the
<em>handler</em> so that it will only be called when the specified <em>host</em> matches
the value of the <code>Host:</code> HTTP header.</p>
<p>This can be used to create servers with different content for different virtual hosts.</p>
<p>The value of the <em>host</em> can include a colon and port, and should match
exactly the value of the <code>Host</code> header sent by the client.
(Canonicalization of the host name is performed.)</p>
<div class="mdbook-alerts mdbook-alerts-note">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  note
</p>
<p>The port number may be ignored; at present the HTTP server framework
does not support a single server listening on different ports concurrently.</p>
</div>
<h3 id="handling-an-entire-tree"><a class="header" href="#handling-an-entire-tree">Handling an Entire Tree</a></h3>
<pre><code class="language-c">void nng_http_handler_set_tree(nng_http_handler *handler);
</code></pre>
<p>The <a name="a050"></a><code>nng_http_handler_set_tree</code> function causes the <em>handler</em> to be matched if the request URI sent
by the client is a logical child of the path for <em>handler</em>, and no more specific
<em>handler</em> has been registered.</p>
<p>This is useful in cases when the handler would like to examine the entire path
and possibly behave differently; for example a REST API that uses the rest of
the path to pass additional parameters.</p>
<div class="mdbook-alerts mdbook-alerts-tip">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  tip
</p>
<p>This function is useful when constructing API handlers where a single
service address (path) supports dynamically generated children.
It can also provide a logical fallback instead of relying on a 404 error code.</p>
</div>
<h3 id="sending-the-response-explicitly"><a class="header" href="#sending-the-response-explicitly">Sending the Response Explicitly</a></h3>
<pre><code class="language-c">void nng_http_write_response(nng_http *conn, nng_aio *aio);
</code></pre>
<p>Normally the server will send any attached response, but there are circumstances where
a response must be sent manually, such as when <a href="api//api/http.html#hijacking-connections">hijacking</a> a connection.</p>
<p>In such a case, <a name="a051"></a><code>nng_http_write_response</code> can be called, which will send the response and any attached data, asynchronously
using the <a href="api//api/aio.html#asynchronous-io-handle"><code>nng_aio</code></a> <em>aio</em>.</p>
<p>By default, for <code>HTTP/1.1</code> connections, the connection is kept open, and
will be reused to receive new requests. For <code>HTTP/1.0</code>, or if the client has requested
explicitly by setting the “Connection: close” header, the connection will be closed after the
response is fully sent.</p>
<!-- Symbol cross reference -->
<!-- HTTP -->
<!-- Macros -->
<!-- Protocols -->
<!-- Transports -->
<!-- Concept index -->
<div style="break-before: page; page-break-before: always;"></div><style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="miscellaneous"><a class="header" href="#miscellaneous">Miscellaneous</a></h1>
<p>This chapter discusses some interfaces that don’t really
fit anywhere else.</p>
<h2 id="get-random-number"><a class="header" href="#get-random-number">Get Random Number</a></h2>
<pre><code class="language-c">uint32_t nng_random(void);
</code></pre>
<p>The <a name="a001"></a><code>nng_random</code> returns a <a name="a002"></a>random number.
The value returned is suitable for use with cryptographic functions such as
key generation, and is obtained using platform-specific cryptographically strong random
number facilities when available.</p>
<h2 id="create-socket-pair"><a class="header" href="#create-socket-pair">Create Socket Pair</a></h2>
<pre><code class="language-c">nng_err nng_socket_pair(int fds[2]);
</code></pre>
<p>The <a name="a003"></a><code>nng_socket_pair</code> function creates a pair of connected file descriptors.
These file descriptors, which are returned in the <em>fds</em> array, are suitable for
use with the <a href="api//tran/socket.html">Socket transport</a>.</p>
<p>On POSIX platforms, this is a thin wrapper around the standard <code>socketpair</code> function,
using the <a name="a004"></a><code>AF_UNIX</code> family and the <code>SOCK_STREAM</code> socket type.
<sup><a name="to-footnote-1"><a href="api/misc.html#footnote-1">1</a></a></sup></p>
<p>This will return zero on success, or an error number. On platforms that lack this
capability, such as Windows, it will return <code>NNG_ENOTSUP</code>.</p>
<div class="mdbook-alerts mdbook-alerts-tip">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  tip
</p>
<p>This function may be useful for creating a shared connection between a parent process and
a child process on UNIX platforms, without requiring the processes use a shared filesystem or TCP connection.</p>
</div>
<h2 id="report-library-version"><a class="header" href="#report-library-version">Report Library Version</a></h2>
<pre><code class="language-c">const char * nng_version(void);
</code></pre>
<p>The <a name="a005"></a><code>nng_version</code> function returns a human readable <a name="a006"></a>version number
for <em>NNG</em>, formatted as a <code>NUL</code>-terminated string.</p>
<p>Additionally, compile time version information is available
via some predefined macros:</p>
<ul>
<li><a name="a007"></a><code>NNG_MAJOR_VERSION</code>: Major version number.</li>
<li><a name="a008"></a><code>NNG_MINOR_VERSION</code>: Minor version number.</li>
<li><a name="a009"></a><code>NNG_PATCH_VERSION</code>: Patch version number.</li>
</ul>
<p><em>NNG</em> is developed and released using
<a href="http://www.semver.org">Semantic Versioning 2.0</a>, and
the version numbers reported refer to both the API and the library itself.
(The <a name="a010"></a>ABI – <a name="a011"></a>application binary interface – between the
library and the application is controlled in a similar, but different
manner depending upon the link options and how the library is built.)</p>
<!-- Symbol cross reference -->
<!-- HTTP -->
<!-- Macros -->
<!-- Protocols -->
<!-- Transports -->
<!-- Concept index -->
<p><hr/>
<p><a name="footnote-1"><a href="api/misc.html#to-footnote-1">1</a></a>: At present only POSIX platforms implementing <code>socketpair</code> support this function.</p>
<div style="break-before: page; page-break-before: always;"></div><style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="id-map"><a class="header" href="#id-map">ID Map</a></h1>
<p>Internally, <em>NNG</em> uses a map of numeric identifiers to data structures.
This feature is also exposed for application use, as a “supplemental” feature.</p>
<p>When using these functions, it is necessary to add the <code>#include &lt;nng/supplemental/util/idhash.h&gt;</code>
include file to list of includes.</p>
<h2 id="id-map-structure"><a class="header" href="#id-map-structure">ID Map Structure</a></h2>
<pre><code class="language-c">typedef struct nng_id_map_s nng_id_map;
</code></pre>
<p>The ID map structure, <a name="a001"></a><code>nng_id_map</code> provides a table of identifiers mapping
to user-supplied pointers (which must not be <code>NULL</code>). The identifiers can be
thought of as indices into the table, with the pointers providing the reference
for the user supplied data.</p>
<p>The values of identifiers can be supplied by the user, or can be allocated automatically
by <code>nng_id_map</code> from a predefined range. The starting point for allocations
can also be randomly within the range.</p>
<p>The identifiers are 64-bit unsigned integers and can be sparse; the structure
will use space efficiently even if identifiers are very far apart.
<sup><a name="to-footnote-1"><a href="api/id_map.html#footnote-1">1</a></a></sup></p>
<div class="mdbook-alerts mdbook-alerts-important">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  important
</p>
<p>The function available for <code>nng_id_map</code> are <em>not</em> thread-safe.
Callers should use a <a href="api//api/synch.html#mutual-exclusion-lock">mutex</a> or similar approach when thread-safety is needed.</p>
</div>
<h2 id="create-id-map"><a class="header" href="#create-id-map">Create ID Map</a></h2>
<pre><code class="language-c">#define NNG_MAP_RANDOM 1

int nng_id_map_alloc(nng_id_map **map_p, uint64_t lo, uint64_t hi, int flags);
</code></pre>
<p>The <a name="a002"></a><code>nng_id_map_alloc</code> function allocates a map without any data in it,
and returns a pointer to it in <em>map_p</em>. When allocating identifiers dynamically,
the values will be chosen from the range defined by <em>lo</em> and <em>hi</em>, inclusive.</p>
<p>The <em>flags</em> argument is a bit mask of flags that can adjust behavior of the map.
The only flag defined at present
is <code>NNG_MAP_RANDOM</code>, which causes the first identifier allocation to start at a random
point within the range.
This is useful to reduce the odds of different instances of an application using
the same identifiers at the same time.</p>
<p>If both <em>lo</em> and <em>hi</em> are zero, then the values <code>0</code> and <code>0xffffffff</code> are substituted
in their place, giving a full range of 32-bit identifiers.</p>
<p>This function can return <a href="api//api/errors.html#NNG_ENOMEM"><code>NNG_ENOMEM</code></a> if it is unable to allocate resources, otherwise
it returns zero on success.</p>
<h2 id="destroy-map"><a class="header" href="#destroy-map">Destroy Map</a></h2>
<pre><code class="language-c">void nng_id_map_free(nng_id_map *map);
</code></pre>
<p>The <a name="a003"></a><code>nng_id_map_free</code> function destroys <em>map</em>, releasing any resources associated
with it.</p>
<div class="mdbook-alerts mdbook-alerts-note">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  note
</p>
<p>The <code>nng_id_map_free</code> frees the map itself, but will not free memory associated with
any structures contained within it.</p>
</div>
<h2 id="store-a-value"><a class="header" href="#store-a-value">Store a Value</a></h2>
<pre><code class="language-c">int nng_id_set(nng_id_map *map, uint64_t id, void *value);
</code></pre>
<p>The <a name="a004"></a><code>nng_id_map_set</code> function is used to store the <em>value</em> in the <em>map</em> at
index <em>id</em>.</p>
<p>If another value is already stored at that same location, then it is overwritten with
<em>value</em>.</p>
<div class="mdbook-alerts mdbook-alerts-note">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  note
</p>
<p>The <em>value</em> must not be <code>NULL</code>.</p>
</div>
<p>If the table has to grow to accommodate this value, it may fail if insufficient
memory is available, returning <a href="api//api/errors.html#NNG_ENOMEM"><code>NNG_ENOMEM</code></a>. Otherwise it returns zero.</p>
<h2 id="lookup-a-value"><a class="header" href="#lookup-a-value">Lookup a Value</a></h2>
<pre><code class="language-c">void *nng_id_get(nng_id_map *map, uint64_t id);
</code></pre>
<p>The <a name="a005"></a><code>nng_id_get</code> function looks up the entry for <em>id</em> in <em>map</em>, returning the
associated value if present, or <code>NULL</code> if no such entry exists.</p>
<h2 id="allocate-an-id"><a class="header" href="#allocate-an-id">Allocate an ID</a></h2>
<pre><code class="language-c">int nng_id_alloc(nng_id_map *map, uint64_t *id_p, void *value);
</code></pre>
<p>The <a name="a006"></a><code>nng_id_alloc</code> stores the <em>value</em> in the <em>map</em>, at a newly allocated index,
and returns the index in <em>id_p</em>.</p>
<p>Identifiers are allocated in increasing order, without reusing old identifiers until the
largest possible identifier is allocated. After wrapping, only identifiers that are no longer
in use will be considered.
No effort is made to order the availability of identifiers based on
when they were freed.<sup><a name="to-footnote-2"><a href="api/id_map.html#footnote-2">2</a></a></sup></p>
<p>As with <a href="api//api/id_map.html#store-a-value"><code>nng_id_set</code></a>, this may need to allocate memory and can thus
fail with <a href="api//api/errors.html#NNG_ENOMEM"><code>NNG_ENOMEM</code></a>.</p>
<p>Additionally, if there are no more free identifiers within the range specified
when <em>map</em> was created, then it will return <a href="api//api/errors.html#NNG_ENOSPC"><code>NNG_ENOSPC</code></a>.</p>
<p>Otherwise it returns zero, indicating success.</p>
<h2 id="remove-an-id"><a class="header" href="#remove-an-id">Remove an ID</a></h2>
<pre><code class="language-c">int nng_id_remove(nng_id_map *map, uint64_t id);
</code></pre>
<p>The <a name="a007"></a><code>nng_id_remove</code> removes the entry at index <em>id</em> from <em>map</em>.</p>
<p>If no such entry exist, it will return <a href="api//api/errors.html#NNG_ENOENT"><code>NNG_ENOENT</code></a>. Otherwise it returns zero.</p>
<h2 id="iterating-ids"><a class="header" href="#iterating-ids">Iterating IDs</a></h2>
<pre><code class="language-c">bool nng_id_visit(nng_id_map *map, uint64_t *id_p, void **value_p, uint32_t *cursor);
</code></pre>
<p>The <a name="a008"></a><code>nng_id_visit</code> function is used to iterate over all items in the table.
The caller starts the iteration by setting the <em>cursor</em> to 0 before calling it.
For each call, the associated key and value of the next item will be returned in <em>id_p</em>,
and <em>value_p</em> and the <em>cursor</em> will be updated.
When all items have been iterated, the function returns <code>false</code>.
The order of items returned is not guaranteed to be sequential.
The caller must not attempt to derive any value of the <em>cursor</em> as it refers to internal table indices.</p>
<p>Entries may be safely removed from <em>map</em> while iterating.</p>
<p>However, if new entries are added to the table while iterating, the result of
iteration is undefined; entries may be repeated or omitted during such an iteration.</p>
<p>The caller must not attempt to derive any value of the <em>cursor</em> as it refers to internal
table indices.</p>
<!-- Symbol cross reference -->
<!-- HTTP -->
<!-- Macros -->
<!-- Protocols -->
<!-- Transports -->
<!-- Concept index -->
<p><hr/>
<p><a name="footnote-1"><a href="api/id_map.html#to-footnote-1">1</a></a>: The ID map is capable of storing at most 2<sup>32</sup> identifiers, even though the identifiers may
themselves be much larger than this.</p>
<p><a name="footnote-2"><a href="api/id_map.html#to-footnote-2">2</a></a>: The concern about possibly reusing a
recently released identifier comes into consideration after the range has wrapped.
Given a sufficiently large range, this is unlikely to be a concern.</p>
<div style="break-before: page; page-break-before: always;"></div><style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="command-arguments"><a class="header" href="#command-arguments">Command Arguments</a></h1>
<p>Some NNG utilities need to parse command line options,
and for this purpose a header library is supplied.</p>
<p>To make use of this, the header <code>&lt;nng/args.h&gt;</code> must be included.</p>
<div class="mdbook-alerts mdbook-alerts-tip">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  tip
</p>
<p>The functionality described here is entirely contained in the
<code>nng/args.h</code> header file, and may be used without previously
initializing the library with <a href="api//api/init.html#initialization"><code>nng_init</code></a>, and may even be used
in programs that are not linked against the NNG library.</p>
</div>
<h2 id="parse-command-line-arguments"><a class="header" href="#parse-command-line-arguments">Parse Command Line Arguments</a></h2>
<pre><code class="language-c">typedef struct nng_arg_spec {
    const char *a_name;  // Long style name (may be NULL for short only)
    int         a_short; // Short option (no clustering!)
    int         a_val;   // Value stored on a good parse (&gt;0)
    bool        a_arg;   // Option takes an argument if true
} nng_optspec;

#define NNG_ARG_END     (-1)
#define NNG_ARG_INVAL   (-2)
#define NNG_ARG_AMBIG   (-3)
#define NNG_ARG_MISSING (-4)

int nng_args_parse(int argc, char *const *argv,
                   const nng_optspec *spec, int *val, char **arg, int *idx);
</code></pre>
<p>The <a name="a001"></a><code>nng_args_parse</code> function is intended to facilitate parsing
<a name="a002"></a>command-line arguments.
This function exists largely to stand in for <a name="a003"></a><code>getopt</code> from POSIX systems,
but it is available on all platforms, and it includes some capabilities missing from <code>getopt</code>.</p>
<p>The function parses arguments from
<code>main</code><sup><a name="to-footnote-1"><a href="api/args.html#footnote-1">1</a></a></sup>
(using <em>argc</em> and <em>argv</em>),
starting at the index referenced by <em>idx</em>.
(New invocations typically set the value pointed to by <em>idx</em> to 1.)</p>
<p>Options are parsed as specified by <em>spec</em> (see <a href="api/args.html#argument-specification">Argument Specification</a>.)
The value of the parsed option will be stored at the address indicated by
<em>val</em>, and the value of <em>idx</em> will be incremented to reflect the next
option to parse.</p>
<div class="mdbook-alerts mdbook-alerts-tip">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  tip
</p>
<p>For using this to parse command-line like strings that do not include
the command name itself, set the value referenced by <em>idx</em> to zero instead of one.</p>
</div>
<p>If the option had an argument, a pointer to that is returned at the address
referenced by <em>arg</em>.</p>
<p>This function should be called repeatedly, until it returns either -1
(indicating the end of options is reached) or a non-zero error code is
returned.</p>
<p>This function may return the following errors:</p>
<ul>
<li>[<code>NNG_ARG_AMBIGU</code>]: Parsed option matches more than one specification.</li>
<li>[<code>NNG_ARG_MISSING</code>]: Option requires an argument, but one is not present.</li>
<li>[<code>NNG_ARG_INVAL</code>]: An invalid (unknown) argument is present in <em>argv</em>.</li>
</ul>
<h3 id="option-specification"><a class="header" href="#option-specification">Option Specification</a></h3>
<p>The calling program must first create an array of <a name="a004"></a><code>nng_arg_spec</code> structures
describing the options to be supported.
This structure has the following members:</p>
<ul>
<li>
<p><code>a_name</code>:</p>
<p>The long style name for the option, such as “verbose”.
This will be parsed as a <a href="api/args.html#long-options">long option</a> on the command line when it is prefixed with two dashes.
It may be <code>NULL</code> if only a <a href="api/args.html#short-options">short option</a> is to be supported.</p>
</li>
<li>
<p><code>a_short</code>:</p>
<p>This is a single letter (at present only ASCII letters are supported).
These options appear as just a single letter, and are prefixed with a single dash on the command line.
The use of a slash in lieu of the dash is <em>not</em> supported, in order to avoid confusion with path name arguments.
This value may be set to 0 if no <a href="api/args.html#short-options">short option</a> is needed.</p>
</li>
<li>
<p><code>o_val</code>:</p>
<p>This is a numeric value that is unique to this option.
This value is assigned by the application program, and must be non-zero for a valid option.
If this is zero, then it indicates the end of the specifications, and the
rest of this structure is ignored.
The value will be returned to the caller in <em>val</em> by <code>nng_args_parse</code> when
this option is parsed from the command line.</p>
</li>
<li>
<p><code>a_arg</code>:</p>
<p>This value should be set to <code>true</code> if the option should take an argument.</p>
</li>
</ul>
<h3 id="long-options"><a class="header" href="#long-options">Long Options</a></h3>
<p>Long options are parsed from the <em>argv</em> array, and are indicated when
the element being scanned starts with two dashes.
For example, the “verbose” option would be specified as <code>--verbose</code> on
the command line.
If a long option takes an argument, it can either immediately follow
the option as the next element in <em>argv</em>, or it can be appended to
the option, separated from the option by an equals sign (<code>=</code>) or a
colon (<code>:</code>).</p>
<h3 id="short-options"><a class="header" href="#short-options">Short Options</a></h3>
<p>Short options appear by themselves in an <em>argv</em> element, prefixed by a dash (<code>-</code>).
If the short option takes an argument, it can either be appended in the
same element of <em>argv</em>, or may appear in the next <em>argv</em> element.</p>
<div class="mdbook-alerts mdbook-alerts-note">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  note
</p>
<p>Option clustering, where multiple options can be crammed together in
a single <em>argv</em> element, is not supported by this function (yet).</p>
</div>
<h3 id="prefix-matching"><a class="header" href="#prefix-matching">Prefix Matching</a></h3>
<p>When using long options, the parser will match if it is equal to a prefix
of the <code>a_name</code> member of a option specification, provided that it do so
unambiguously (meaning it must not match any other option specification.)</p>
<h2 id="example"><a class="header" href="#example">Example</a></h2>
<p>The following program fragment demonstrates this function.</p>
<pre><code class="language-c">    enum { OPT_LOGFILE, OPT_VERBOSE };
    char *logfile; // options to be set
    bool verbose;

    static nng_arg_spec specs[] = {
        {
            .a_name = "logfile",
            .a_short = 'D',
            .a_val = OPT_LOGFILE,
            .a_arg = true,
        }, {
            .a_name = "verbose",
            .a_short = 'V',
            .a_val = OPT_VERBOSE,
            .a_arg = false,
        }, {
            .a_val = 0; // Terminate array
        }
    };

    for (int idx = 1;;) {
        int rv, opt;
        char *arg;
        rv = nng_args_parse(argc, argv, specs, &amp;opt, &amp;arg, &amp;idx);
        if (rv != 0) {
            break;
        }
        switch (opt) {
        case OPT_LOGFILE:
            logfile = arg;
            break;
        case OPT_VERBOSE:
            verbose = true;
            break;
        }
    }
    if (rv != NNG_ARG_END) {
        switch (rv) {
        case NNG_ARG_AMBIG:
            printf("Options error: ambiguous option\n");
            break;
        case NNG_ARG_MISSING:
            printf("Options error: required option argument missing\n");
            break;
        case NNG_ARG_INVAL:
            printf("Options error: unknown option present\n");
            break;
        }
        exit(1);
    }
</code></pre>
<!-- Symbol cross reference -->
<!-- HTTP -->
<!-- Macros -->
<!-- Protocols -->
<!-- Transports -->
<!-- Concept index -->
<p><hr/>
<p><a name="footnote-1"><a href="api/args.html#to-footnote-1">1</a></a>: Parsing argument strings from other sources can be done as well,
although usually then <em>idx</em> will be initialized to zero.</p>
<div style="break-before: page; page-break-before: always;"></div><style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="protocols"><a class="header" href="#protocols">Protocols</a></h1>
<p><a name="a001"></a>
The Scalability Protocols are a principally a collection of common networking
patterns found in applications.</p>
<p>The following patterns are included:</p>
<h2 id="request---reply"><a class="header" href="#request---reply">Request - Reply</a></h2>
<p>The <a name="a002"></a>request/reply pattern is made up of the <a href="proto/req.html"><em>REQ</em></a> and <a href="proto/rep.html"><em>REP</em></a> protocols.
This most often used when implementing RPC-like services, where
a given request is matched by a single reply.</p>
<h2 id="pipeline"><a class="header" href="#pipeline">Pipeline</a></h2>
<p>The <a name="a003"></a>pipeline pattern is made up of the <a href="proto/push.html"><em>PUSH</em></a> and <a href="proto/pull.html"><em>PULL</em></a>
protocols.</p>
<p>In this pattern communication is <a name="a004"></a>half-duplex, in that one side sends
data and another side receives.</p>
<p>This pattern is also characterized by its ability to solve distribution
problems, and the fact that it has <a name="a005"></a>back-pressure, providing a measure
of <a name="a006"></a>flow control to data production and consumption.</p>
<h2 id="publish---subscribe"><a class="header" href="#publish---subscribe">Publish - Subscribe</a></h2>
<h2 id="bus"><a class="header" href="#bus">Bus</a></h2>
<h2 id="pair"><a class="header" href="#pair">Pair</a></h2>
<div style="break-before: page; page-break-before: always;"></div><style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="bus-protocol"><a class="header" href="#bus-protocol">BUS Protocol</a></h1>
<p>The <a name="a001"></a><em>BUS</em> protocol<a name="a002"></a> provides for building mesh networks where
every peer is connected to every other peer.
In this protocol, each message sent by a node is sent to every one of
its directly connected peers.</p>
<div class="mdbook-alerts mdbook-alerts-tip">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  tip
</p>
<p>Messages are only sent to directly connected peers.
This means that in the event that a peer is connected indirectly, it will not
receive messages.
When using this protocol to build mesh networks, it
is therefore important that a <em>fully-connected</em> mesh network be constructed.</p>
</div>
<p>All message delivery in this pattern is <a name="a003"></a>best-effort, which means that
peers may not receive messages.
Furthermore, delivery may occur to some,
all, or none of the directly connected peers.
(Messages are not delivered when peer nodes are unable to receive.)
Hence, send operations will never block; instead if the
message cannot be delivered for any reason it is discarded.</p>
<div class="mdbook-alerts mdbook-alerts-tip">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  tip
</p>
<p>In order to minimize the likelihood of message loss, this protocol
should not be used for high throughput communications.
Furthermore, the more traffic <em>in aggregate</em> that occurs across the topology,
the more likely that message loss is to occur.</p>
</div>
<h2 id="socket-operations"><a class="header" href="#socket-operations">Socket Operations</a></h2>
<p>The <a href="proto/TODO.html"><code>nng_bus0_open</code></a> functions create a bus socket.
This socket may be used to send and receive messages.
Sending messages will attempt to deliver to each directly connected peer.</p>
<h2 id="protocol-versions"><a class="header" href="#protocol-versions">Protocol Versions</a></h2>
<p>Only version 0 of this protocol is supported.
(At the time of writing, no other versions of this protocol have been defined.)</p>
<h2 id="protocol-options"><a class="header" href="#protocol-options">Protocol Options</a></h2>
<p>The <em>BUS</em> protocol has no protocol-specific options.</p>
<h2 id="protocol-headers"><a class="header" href="#protocol-headers">Protocol Headers</a></h2>
<p>When using a <em>BUS</em> socket in <a href="proto/TODO.html">raw mode</a>, received messages will
contain the incoming <a href="proto/TODO.html">pipe</a> ID as the sole element in the header.
If a message containing such a header is sent using a raw <em>BUS</em> socket, then,
the message will be delivered to all connected pipes <em>except</em> the one
identified in the header.
This behavior is intended for use with <a href="proto/TODO.html">device</a>
configurations consisting of just a single socket.
Such configurations are useful in the creation of rebroadcasters, and this
capability prevents a message from being routed back to its source.
If no header is present, then a message is sent to all connected pipes.</p>
<p>When using normal (cooked mode) <em>BUS</em> sockets, no message headers are present.</p>
<div style="break-before: page; page-break-before: always;"></div><style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="pair-protocol"><a class="header" href="#pair-protocol">PAIR protocol</a></h1>
<p>The <a name="a001"></a><em>PAIR</em> protocol<a name="a002"></a> implements a peer-to-peer pattern, where
relationships between peers are one-to-one.</p>
<h3 id="socket-operations-1"><a class="header" href="#socket-operations-1">Socket Operations</a></h3>
<p>The <a href="proto/TODO.html"><code>nng_pair_open</code></a> functions create a <em>PAIR</em> socket.</p>
<p>Normally, this pattern will block when attempting to send a message if
no peer is able to receive the message.</p>
<div class="mdbook-alerts mdbook-alerts-note">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  note
</p>
<p>Even though this mode may appear to be reliable, because back-pressure
prevents discarding messages most of the time, there are topologies involving
where messages may be discarded.
Applications that require reliable delivery semantics should consider using
<a href="proto/./req.html"><em>REQ</em></a> sockets, or implement their own acknowledgment layer on top of <em>PAIR</em> sockets.</p>
</div>
<h3 id="protocol-versions-1"><a class="header" href="#protocol-versions-1">Protocol Versions</a></h3>
<p>Version 0 is the legacy version of this protocol.
It lacks any header
information, and is suitable when building simple one-to-one topologies.</p>
<div class="mdbook-alerts mdbook-alerts-tip">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  tip
</p>
<p>Use version 0 if you need to communicate with other implementations,
including the legacy <a href="proto/TODO.html">libnanomsg</a> library or
<a href="proto/TODO.html">mangos</a>.</p>
</div>
<p>Version 1 of the protocol offers improved protection against loops when
used with <a href="proto/TODO.html">devices</a>.</p>
<h3 id="polyamorous-mode"><a class="header" href="#polyamorous-mode">Polyamorous Mode</a></h3>
<div class="mdbook-alerts mdbook-alerts-note">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  note
</p>
<p>Polyamorous mode is deprecated, and support for it will likely
be removed in a future release, when a suitable mesh protocol is
available.
In the meantime, applications are encouraged to look to other patterns.</p>
</div>
<p>Normally pair sockets are for one-to-one communication, and a given peer
will reject new connections if it already has an active connection to another
peer.</p>
<p><em>Polyamorous</em><a name="a003"></a> changes this, to allow a socket to communicate with
multiple directly-connected peers.
This mode is enabled by opening a socket using <a href="proto/TODO.html"><code>nng_pair1_open_poly</code></a>.</p>
<div class="mdbook-alerts mdbook-alerts-tip">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  tip
</p>
<p>Polyamorous mode is only available when using pair version 1.</p>
</div>
<p>In polyamorous mode a socket can support many one-to-one connections.
In this mode, the application must
choose the remote peer to receive an outgoing message by setting the
<a href="proto/TODO.html"><code>nng_pipe</code></a> to use for the outgoing message using
<a href="proto/../api/msg/nng_msg_pipe.html"><code>nng_msg_set_pipe</code></a>.</p>
<p>If no remote peer is specified by the sender, then the protocol will select
any available connected peer.</p>
<p>Most often the value of the outgoing pipe will be obtained from an incoming
message using <a href="proto/../api/msg/nng_msg_pipe.html"><code>nng_msg_get_pipe</code></a>,
such as when replying to an incoming message.</p>
<div class="mdbook-alerts mdbook-alerts-note">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  note
</p>
<p>Directed send <em>only</em> works with directly connected peers.
It will not function across <a href="proto/TODO.html">device</a> proxies.</p>
</div>
<p>In order to prevent head-of-line blocking, if the peer on the given pipe
is not able to receive (or the pipe is no longer available, such as if the
peer has disconnected), then the message will be discarded with no notification
to the sender.</p>
<h3 id="protocol-options-1"><a class="header" href="#protocol-options-1">Protocol Options</a></h3>
<p>The following protocol-specific options are available.</p>
<ul>
<li>
<p><a href="proto/TODO.html"><code>NNG_OPT_MAXTTL</code></a>:
(<code>int</code>, version 1 only). Maximum time-to-live.</p>
</li>
<li>
<p><code>NNG_OPT_PAIR1_POLY</code>:
(<code>bool</code>, version 1 only) This option is no longer supported.
Formerly it was used to configure <em>polyamorous</em> mode, but that mode
is now established by using the <code>nng_pair1_open_poly</code> function.</p>
</li>
</ul>
<h3 id="protocol-headers-1"><a class="header" href="#protocol-headers-1">Protocol Headers</a></h3>
<p>Version 0 of the pair protocol has no protocol-specific headers.</p>
<p>Version 1 of the pair protocol uses a single 32-bit unsigned value. The
low-order (big-endian) byte of this value contains a “hop” count, and is
used in conjunction with the
<a href="proto/TODO.html"><code>NNG_OPT_MAXTTL</code></a> option to guard against
device forwarding loops.
This value is initialized to 1, and incremented each time the message is
received by a new node.</p>
<div style="break-before: page; page-break-before: always;"></div><style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="pub-protocol"><a class="header" href="#pub-protocol">PUB Protocol</a></h1>
<p>The <a name="a001"></a><em>PUB</em> protocol<a name="a002"></a> is one half of a <a name="a003"></a>publisher/subscriber pattern.
In this pattern, a publisher sends data, which is broadcast to all
subscribers.
The subscribing applications only see the data to which
they have subscribed.</p>
<p>The <em>PUB</em> protocol is the publisher side, and the
<a href="proto/sub.html"><em>SUB</em></a> protocol is the subscriber side.</p>
<div class="mdbook-alerts mdbook-alerts-note">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  note
</p>
<p>In this implementation, the publisher delivers all messages to all
subscribers.
The subscribers maintain their own subscriptions, and filter them locally.
Thus, this pattern should not be used in an attempt to reduce bandwidth
consumption.</p>
</div>
<p>The topics that subscribers subscribe to is just the first part of
the message body.
Applications should construct their messages accordingly.</p>
<h2 id="socket-operations-2"><a class="header" href="#socket-operations-2">Socket Operations</a></h2>
<p>The <a href="proto/TODO.html"><code>nng_pub0_open</code></a> functions create a publisher socket.
This socket may be used to send messages, but is unable to receive them.
Attempts to receive messages will result in <code>NNG_ENOTSUP</code>.</p>
<h2 id="protocol-versions-2"><a class="header" href="#protocol-versions-2">Protocol Versions</a></h2>
<p>Only version 0 of this protocol is supported.
(At the time of writing, no other versions of this protocol have been defined.)</p>
<h2 id="protocol-options-2"><a class="header" href="#protocol-options-2">Protocol Options</a></h2>
<p>The <em>PUB</em> protocol has no protocol-specific options.</p>
<h2 id="protocol-headers-2"><a class="header" href="#protocol-headers-2">Protocol Headers</a></h2>
<p>The <em>PUB</em> protocol has no protocol-specific headers.</p>
<div style="break-before: page; page-break-before: always;"></div><style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="pull-protocol"><a class="header" href="#pull-protocol">PULL protocol</a></h1>
<p>The <a name="a001"></a><em>PULL</em> protocol<a name="a002"></a> is one half of a
<a name="a003"></a>pipeline pattern.
The other half is the <a href="proto/./push.html"><em>PUSH</em></a> protocol.</p>
<p>In the pipeline pattern, pushers distribute messages to pullers.
Each message sent
by a pusher will be sent to one of its peer pullers,
chosen in a round-robin fashion
from the set of connected peers available for receiving.
This property makes this pattern useful in <a name="a004"></a>load-balancing scenarios.</p>
<h3 id="socket-operations-3"><a class="header" href="#socket-operations-3">Socket Operations</a></h3>
<p>The <a href="proto/TODO.html"><code>nng_pull0_open</code></a> functions create a
<em>PULL</em> socket.
This socket may be used to receive messages, but is unable to send them.
Attempts to send messages will result in <code>NNG_ENOTSUP</code>.</p>
<p>When receiving messages, the <em>PULL</em> protocol accepts messages as
they arrive from peers.
If two peers both have a message ready, the
order in which messages are handled is undefined.</p>
<h3 id="protocol-versions-3"><a class="header" href="#protocol-versions-3">Protocol Versions</a></h3>
<p>Only version 0 of this protocol is supported.
(At the time of writing, no other versions of this protocol have been defined.)</p>
<h3 id="protocol-options-3"><a class="header" href="#protocol-options-3">Protocol Options</a></h3>
<p>The <em>PULL</em> protocol has no protocol-specific options.</p>
<h3 id="protocol-headers-3"><a class="header" href="#protocol-headers-3">Protocol Headers</a></h3>
<p>The <em>PULL</em> protocol has no protocol-specific headers.</p>
<div style="break-before: page; page-break-before: always;"></div><style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="push-protocol"><a class="header" href="#push-protocol">PUSH protocol</a></h1>
<h2 id="description"><a class="header" href="#description">DESCRIPTION</a></h2>
<p>The <a name="a001"></a><em>PUSH</em> protocol<a name="a002"></a> is one half of a <a name="a003"></a>pipeline pattern.
The other side is the <a href="proto/./pull.html"><em>PULL</em></a> protocol.</p>
<p>In the pipeline pattern, pushers distribute messages to pullers.
Each message sent by a pusher will be sent to one of its peer pullers,
chosen in a round-robin fashion
from the set of connected peers available for receiving.
This property makes this pattern useful in <a name="a004"></a>load-balancing scenarios.</p>
<h3 id="socket-operations-4"><a class="header" href="#socket-operations-4">Socket Operations</a></h3>
<p>The <a href="proto/TODO.html"><code>nng_push0_open</code></a> call creates a <em>PUSH</em> socket.
This socket may be used to send messages, but is unable to receive them.
Attempts to receive messages will result in <code>NNG_ENOTSUP</code>.</p>
<p>Send operations will observe flow control (back-pressure), so that
only peers capable of accepting a message will be considered.
If no peer is available to receive a message, then the send operation will
wait until one is available, or the operation times out.</p>
<div class="mdbook-alerts mdbook-alerts-note">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  note
</p>
<p>Although the pipeline protocol honors flow control, and attempts
to avoid dropping messages, no guarantee of delivery is made.
Furthermore, as there is no capability for message acknowledgment,
applications that need reliable delivery are encouraged to consider the
<a href="proto/./req.html"><em>REQ</em></a> protocol instead.</p>
</div>
<h3 id="protocol-versions-4"><a class="header" href="#protocol-versions-4">Protocol Versions</a></h3>
<p>Only version 0 of this protocol is supported.
(At the time of writing, no other versions of this protocol have been defined.)</p>
<h3 id="protocol-options-4"><a class="header" href="#protocol-options-4">Protocol Options</a></h3>
<ul>
<li><a href="proto/TODO.html"><code>NNG_OPT_SENDBUF</code></a>:
(<code>int</code>, 0 - 8192)
Normally this is set to zero, indicating that send operations are unbuffered.
In unbuffered operation, send operations will wait until a suitable peer is available to receive the message.
If this is set to a positive value (up to 8192), then an intermediate buffer is
provided for the socket with the specified depth (in messages).</li>
</ul>
<div class="mdbook-alerts mdbook-alerts-note">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  note
</p>
<p>Transport layer buffering may occur in addition to any socket
buffer determined by this option.</p>
</div>
<h3 id="protocol-headers-4"><a class="header" href="#protocol-headers-4">Protocol Headers</a></h3>
<p>The <em>PUSH</em> protocol has no protocol-specific headers.</p>
<div style="break-before: page; page-break-before: always;"></div><style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="rep-protocol"><a class="header" href="#rep-protocol">REP Protocol</a></h1>
<p>The <a name="a001"></a><em>REP</em> protocol<a name="a002"></a> is one half of a <a name="a003"></a>request/reply pattern.
In this pattern, a requester sends a message to one replier, who
is expected to reply.
The request is resent if no reply arrives,
until a reply is received or the request times out.</p>
<div class="mdbook-alerts mdbook-alerts-tip">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  tip
</p>
<p>This protocol is useful in setting up RPC-like services.
It is also reliable, in that a requester will keep retrying until
a reply is received.</p>
</div>
<p>The <em>REP</em> protocol is the replier side, and the
<a href="proto/./req.html"><em>REP</em></a> protocol is the requester side.</p>
<h2 id="socket-operations-5"><a class="header" href="#socket-operations-5">Socket Operations</a></h2>
<p>The <a href="proto/TODO.html"><code>nng_rep0_open</code></a> functions create a replier socket.
This socket may be used to receive messages (requests), and then to send
replies.</p>
<p>Generally a reply can only be sent after receiving a request.</p>
<p>Send operations will result in <code>NNG_ESTATE</code> if no corresponding request
was previously received.</p>
<p>Likewise, only one receive operation may be pending at a time.
Any additional concurrent receive operations will result in <code>NNG_ESTATE</code>.</p>
<p><a href="proto/TODO.html">Raw mode</a> sockets ignore all these restrictions.</p>
<h2 id="context-operations"><a class="header" href="#context-operations">Context Operations</a></h2>
<p>This protocol supports the creation of <a href="proto/TODO.html">contexts</a> for concurrent
use cases using <a href="proto/TODO.html"><code>nng_ctx_open</code></a>.</p>
<p>Each context may have at most one outstanding request, and operates
independently of the others.
The restrictions for order of operations with sockets apply equally
well for contexts, except that each context will be treated as if it were
a separate socket.</p>
<h2 id="protocol-versions-5"><a class="header" href="#protocol-versions-5">Protocol Versions</a></h2>
<p>Only version 0 of this protocol is supported.
(At the time of writing, no other versions of this protocol have been defined.)</p>
<h2 id="protocol-options-5"><a class="header" href="#protocol-options-5">Protocol Options</a></h2>
<p>The <em>REP</em> protocol has no protocol-specific options.</p>
<h2 id="protocol-headers-5"><a class="header" href="#protocol-headers-5">Protocol Headers</a></h2>
<p>The <em>REP</em> protocol uses a <a name="a004"></a><em>backtrace</em> in the header.
This is more fully documented in the <a href="proto/./req.html"><em>REQ</em></a> chapter.</p>
<div style="break-before: page; page-break-before: always;"></div><style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="req-protocol"><a class="header" href="#req-protocol">REQ protocol</a></h1>
<p>The <a name="a001"></a><em>REQ</em> protocol<a name="a002"></a> is one half of a <a name="a003"></a>request/reply pattern.
In this pattern, a requester sends a message to one replier, who
is expected to reply.
The request is resent if no reply arrives,
until a reply is received or the request times out.</p>
<div class="mdbook-alerts mdbook-alerts-tip">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  tip
</p>
<p>This protocol is useful in setting up RPC-like services.
It is also “reliable”, in that a the requester will keep retrying until
a reply is received.</p>
</div>
<div class="mdbook-alerts mdbook-alerts-note">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  note
</p>
<p>Because requests are resent, it is important that they be <a name="a004"></a>idempotent
to ensure predictable and repeatable behavior even in the face of duplicated
requests, which can occur (for example if a reply message is lost for
some reason.)</p>
</div>
<p><a name="a005"></a>
The requester generally only has one outstanding request at a time unless
in <a href="proto/TODO.html">raw mode</a>,
and it will generally attempt to spread work requests to different peer repliers.</p>
<div class="mdbook-alerts mdbook-alerts-tip">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  tip
</p>
<p>This property, when combined with a <a href="proto/TODO.html">device</a>
can help provide a degree of load-balancing.</p>
</div>
<p>The <em>REQ</em> protocol is the requester side, and the <a href="proto/./rep.html"><em>REP</em></a> protocol
is the replier side.</p>
<h3 id="socket-operations-6"><a class="header" href="#socket-operations-6">Socket Operations</a></h3>
<p>The <a href="proto/TODO.html"><code>nng_req0_open</code></a> functions create a <em>REQ</em> socket.
This socket may be used to send messages (requests), and then to receive replies.</p>
<p>Generally a reply can only be received after sending a request.
(Attempts to receive a message will result in <code>NNG_ESTATE</code> if there is no
outstanding request.)</p>
<p>Furthermore, only a single receive operation may be pending at a time.
Attempts to post more receive operations concurrently will result in
<code>NNG_ESTATE</code>.</p>
<p>Requests may be canceled by sending a different request.
This will cause the requester to discard any reply from the earlier request,
but it will not stop a replier
from processing a request it has already received or terminate a request
that has already been placed on the wire.</p>
<p><a href="proto/TODO.html">Raw mode</a> sockets ignore all these restrictions.</p>
<h3 id="context-operations-1"><a class="header" href="#context-operations-1">Context Operations</a></h3>
<p>This protocol supports the creation of <a href="proto/TODO.html">contexts</a> for concurrent
use cases using <a href="proto/TODO.html"><code>nng_ctx_open</code></a>.</p>
<p>The <code>NNG_OPT_REQ_RESENDTIME</code> value may be configured differently
on contexts created this way.</p>
<p>Each context may have at most one outstanding request, and operates
independently from the others.</p>
<p>The restrictions for order of operations with sockets apply equally
well for contexts, except that each context will be treated as if it were
a separate socket.</p>
<h3 id="protocol-versions-6"><a class="header" href="#protocol-versions-6">Protocol Versions</a></h3>
<p>Only version 0 of this protocol is supported.
(At the time of writing, no other versions of this protocol have been defined.)</p>
<h3 id="protocol-options-6"><a class="header" href="#protocol-options-6">Protocol Options</a></h3>
<p>The following protocol-specific option is available.</p>
<ul>
<li>
<p><a name="a006"></a><code>NNG_OPT_REQ_RESENDTIME</code>: <br />
(<a href="proto/../api/util/nng_duration.html"><code>nng_duration</code></a>) <br />
When a new request is started, a timer of this duration is also started.
If no reply is received before this timer expires, then the request will
be resent. <br />
<br />
Requests are also automatically resent if the peer to whom
the original request was sent disconnects. <br />
<br />
Resending may be deferred up to the value of the <code>NNG_OPT_RESENDTICK</code> parameter. <br />
<br />
If the value is set to <a href="proto/../api/util/nng_duration.html"><code>NNG_DURATION_INFINITE</code></a>, then resends are disabled
altogether. This should be used when the request is not idemptoent.</p>
</li>
<li>
<p><a name="a007"></a><code>NNG_OPT_REQ_RESENDTICK</code>: <br />
(<a href="proto/../api/util/nng_duration.html"><code>nng_duration</code></a>) <br />
This is the granularity of the clock that is used to check for resending.
The default is a second. Setting this to a higher rate will allow for
more timely resending to occur, but may incur significant additional
overhead when the socket has many outstanding requests (contexts). <br />
<br />
When there are no requests outstanding that have a resend set, then
the clock does not tick at all. <br />
<br />
This option is shared for all contexts on a socket, and is only available for the socket itself.</p>
</li>
</ul>
<h3 id="protocol-headers-6"><a class="header" href="#protocol-headers-6">Protocol Headers</a></h3>
<p>This protocol uses a <a name="a008"></a><em>backtrace</em> in the header.
This form uses a stack of 32-bit big-endian identifiers.
There <em>must</em> be at least one identifier, the <strong>request ID</strong>, which will be the
last element in the array, and <em>must</em> have the most significant bit set.</p>
<p>There may be additional <strong>peer ID</strong>s preceding the request ID.
These will be distinguishable from the request ID by having their most
significant bit clear.</p>
<p>When a request message is received by a forwarding node (such as a <a href="proto/TODO.html">device</a>),
the forwarding node prepends a
32-bit peer ID (which <em>must</em> have the most significant bit clear),
which is the forwarder’s way of identifying the directly connected
peer from which it received the message.
(This peer ID, except for the
most significant bit, has meaning only to the forwarding node itself.)</p>
<p>It may help to think of prepending a peer ID as pushing a peer ID onto the
front of the stack of headers for the message.
(It will use the peer ID
it popped from the front to determine the next intermediate destination
for the reply.)</p>
<p>When a reply message is created, it is created using the same headers
that the request contained.</p>
<p>A forwarding node can pop the peer ID it originally pushed on the
message, stripping it from the front of the message as it does so.</p>
<p>When the reply finally arrives back at the initiating requester, it
should have only a single element in the message, which will be the
request ID it originally used for the request.</p>
<div style="break-before: page; page-break-before: always;"></div><style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="respondent-protocol"><a class="header" href="#respondent-protocol">RESPONDENT protocol</a></h1>
<p>The <a name="a001"></a><em>RESPONDENT</em> protocol<a name="a002"></a> is one half of a <a name="a003"></a>survey pattern.
In this pattern, a surveyor sends a survey, which is broadcast to all
peer respondents.
The respondents then have a chance to reply (but are not obliged to reply).
The survey itself is a timed event, so that responses
received after the survey has finished are discarded.</p>
<div class="mdbook-alerts mdbook-alerts-tip">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  tip
</p>
<p>This protocol is useful in solving voting problems, such as leader
election in cluster configurations, as well as certain kinds of service
discovery problems.</p>
</div>
<p>The <em>RESPONDENT</em> protocol is the respondent side, and the
<a href="proto/./surveyor.html"><em>SURVEYOR</em></a> protocol is the surveyor side.</p>
<h3 id="socket-operations-7"><a class="header" href="#socket-operations-7">Socket Operations</a></h3>
<p>The <a href="proto/TODO.html"><code>nng_respondent0_open</code></a> functions create a
respondent socket.
This socket may be used to receive messages, and then to send replies.
A reply can only be sent after receiving a survey, and generally the
reply will be sent to surveyor from whom the last survey was received.</p>
<p>Respondents may discard a survey by simply not replying to it.</p>
<p><a href="proto/TODO.html">Raw mode</a> sockets ignore all these restrictions.</p>
<h3 id="context-operations-2"><a class="header" href="#context-operations-2">Context Operations</a></h3>
<p>This protocol supports the creation of <a href="proto/TODO.html">contexts</a> for concurrent
use cases using <a href="proto/TODO.html"><code>nng_ctx_open</code></a>.</p>
<p>Incoming surveys will be routed to and received by only one context.
Additional surveys may be received by other contexts in parallel.
Replies made using a context will be returned to the the surveyor that
issued the survey most recently received by that context.
The restrictions for order of operations with sockets apply equally
well for contexts, except that each context will be treated as if it were
a separate socket.</p>
<h3 id="protocol-versions-7"><a class="header" href="#protocol-versions-7">Protocol Versions</a></h3>
<p>Only version 0 of this protocol is supported.
At the time of writing, no other versions of this protocol have been defined.
<sup><a name="to-footnote-1"><a href="proto/respondent.html#footnote-1">1</a></a></sup></p>
<h3 id="protocol-options-7"><a class="header" href="#protocol-options-7">Protocol Options</a></h3>
<p>The <em>respondent</em> protocol has no protocol-specific options.</p>
<h3 id="protocol-headers-7"><a class="header" href="#protocol-headers-7">Protocol Headers</a></h3>
<p>The <em>RESPONDENT</em> protocol uses a <a name="a004"></a><em>backtrace</em> in the header.
This is more fully documented in the <a href="proto/./surveyor.html"><em>SURVEYOR</em></a> manual.</p>
<p><hr/>
<p><a name="footnote-1"><a href="proto/respondent.html#to-footnote-1">1</a></a>: An earlier and incompatible version of the protocol was used in older
pre-releases of <a href="proto/TODO.html">nanomsg</a>, but was not released in any production version.</p>
<div style="break-before: page; page-break-before: always;"></div><style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="sub-protocol"><a class="header" href="#sub-protocol">SUB protocol</a></h1>
<p>The <a name="a001"></a><em>SUB</em> protocol<a name="a002"></a> is one half of a publisher/<a name="a003"></a>subscriber pattern.
In this pattern, a publisher sends data, which is broadcast to all subscribers.
The subscribing applications only see the data to which they have subscribed.</p>
<p>The <em>SUB</em> protocol is the subscriber side, and the
<a href="proto/./pub.html"><em>PUB</em></a> protocol is the publisher side.</p>
<div class="mdbook-alerts mdbook-alerts-note">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  note
</p>
<p>The publisher delivers all messages to all subscribers.
The subscribers maintain their own subscriptions, and filter them locally.
Thus, this pattern should not be used in an attempt to
reduce bandwidth consumption.</p>
</div>
<p>The topics that subscribers subscribe to is compared to the leading bytes of
the message body.
Applications should construct their messages accordingly.</p>
<h3 id="socket-operations-8"><a class="header" href="#socket-operations-8">Socket Operations</a></h3>
<p>The <a href="proto/TODO.html"><code>nng_sub0_open</code></a> functions create a <em>SUB</em> socket.
This socket may be used to receive messages, but is unable to send them.
Attempts to send messages will result in <code>NNG_ENOTSUP</code>.</p>
<h3 id="protocol-versions-8"><a class="header" href="#protocol-versions-8">Protocol Versions</a></h3>
<p>Only version 0 of this protocol is supported.
(At the time of writing, no other versions of this protocol have been defined.)</p>
<h3 id="protocol-options-8"><a class="header" href="#protocol-options-8">Protocol Options</a></h3>
<p>The following protocol-specific option is available.</p>
<ul>
<li><a name="a004"></a><code>NNG_OPT_SUB_PREFNEW</code>: <br />
(<code>bool</code>) <br />
<br />
This read/write option specifies the behavior of the subscriber when the queue is full.
When <code>true</code> (the default), the subscriber will make room in the queue by removing the oldest message.
When <code>false</code>, the subscriber will reject messages if the message queue does not have room.</li>
</ul>
<h3 id="protocol-headers-8"><a class="header" href="#protocol-headers-8">Protocol Headers</a></h3>
<p>The <em>SUB</em> protocol has no protocol-specific headers.</p>
<div style="break-before: page; page-break-before: always;"></div><style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="surveyor-protocol"><a class="header" href="#surveyor-protocol">SURVEYOR protocol</a></h1>
<p>The <a name="a001"></a><em>SURVEYOR</em> protocol<a name="a002"></a> is one half of a <a name="a003"></a>survey pattern.
In this pattern, a surveyor sends a survey, which is broadcast to all
peer respondents.
The respondents then have a chance, but are not obliged, to reply.
The survey itself is a timed event, so that responses
received after the survey has finished are discarded.</p>
<div class="mdbook-alerts mdbook-alerts-tip">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  tip
</p>
<p>This protocol is useful in solving <a name="a004"></a>voting problems, such as
<a name="a005"></a>leader election in cluster configurations,
as well as certain kinds of <a name="a006"></a>service discovery problems.</p>
</div>
<p>The <em>SURVEYOR</em> protocol is the surveyor side, and the
<a href="proto/./respondent.html"><em>RESPONDENT</em></a> protocol is the respondent side.</p>
<h3 id="socket-operations-9"><a class="header" href="#socket-operations-9">Socket Operations</a></h3>
<p>The <a href="proto/TODO.html"><code>nng_surveyor0_open</code></a>
functions create a surveyor socket.
This socket may be used to send messages (surveys), and then to receive replies.
A reply can only be received after sending a survey.
A surveyor can normally expect to receive at most one reply from each responder.
(Messages can be duplicated in some topologies,
so there is no guarantee of this.)</p>
<p>Attempts to receive on a socket with no outstanding survey will result
in <code>NNG_ESTATE</code>.
If the survey times out while the surveyor is waiting
for replies, then the result will be <code>NNG_ETIMEDOUT</code>.</p>
<p>Only one survey can be outstanding at a time; sending another survey will
cancel the prior one, and any responses from respondents from the prior
survey that arrive after this will be discarded.</p>
<p><a href="proto/TODO.html">Raw mode</a> sockets ignore all these restrictions.</p>
<h3 id="context-operations-3"><a class="header" href="#context-operations-3">Context Operations</a></h3>
<p>This protocol supports the creation of <a href="proto/TODO.html">contexts</a> for concurrent
use cases using <a href="proto/TODO.html"><code>nng_ctx_open</code></a>.</p>
<p>Each context can initiate its own surveys, and it will receive only
responses to its own outstanding surveys.
Other contexts on the same socket may have overlapping surveys
operating at the same time.</p>
<p>Each of these may have their own timeouts established with
<code>NNG_OPT_SURVEYOR_SURVEYTIME</code>.</p>
<p>Additionally, sending a survey on a context will only cancel an outstanding
survey on the same context.</p>
<div class="mdbook-alerts mdbook-alerts-note">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  note
</p>
<p>Due to the best-effort nature of this protocol, if too may contexts
are attempting to perform surveys simultaneously, it is possible for either
individual outgoing surveys or incoming responses to be lost.</p>
</div>
<h3 id="protocol-versions-9"><a class="header" href="#protocol-versions-9">Protocol Versions</a></h3>
<p>Only version 0 of this protocol is supported.
At the time of writing, no other versions of this protocol have been defined.
<sup><a name="to-footnote-1"><a href="proto/surveyor.html#footnote-1">1</a></a></sup></p>
<h3 id="protocol-options-9"><a class="header" href="#protocol-options-9">Protocol Options</a></h3>
<p>The following protocol-specific option is available.</p>
<ul>
<li><a name="a007"></a><code>NNG_OPT_SURVEYOR_SURVEYTIME</code>: <br />
(<a href="proto/../api/util/nng_duration.html"><code>nng_duration</code></a>) <br />
<br />
When a new survey is started, a timer of this duration is started.
Any responses arriving this time will be discarded.
Attempts to receive
after the timer expires with no other surveys started will result in
<code>NNG_ESTATE</code>.<br />
<br />
If a receive is pending when this timer expires, it will result in
<code>NNG_ETIMEDOUT</code>.</li>
</ul>
<h3 id="protocol-headers-9"><a class="header" href="#protocol-headers-9">Protocol Headers</a></h3>
<p><a name="a008"></a>
This form uses a stack of 32-bit big-endian identifiers.
There <em>must</em> be at least one identifier, the <strong>survey ID</strong>, which will be the
last element in the array, and <em>must</em> have the most significant bit set.</p>
<p>There may be additional <strong>peer ID</strong>s preceding the survey ID.
These will be distinguishable from the survey ID by having their most
significant bit clear.</p>
<p>When a survey message is received by a forwarding node (such as a
<a href="proto/TODO.html">device</a>),
the forwarding node prepends a
32-bit peer ID (which <em>must</em> have the most significant bit clear),
which is the forwarder’s way of identifying the directly connected
peer from which it received the message.
(This peer ID, except for the
most significant bit, has meaning only to the forwarding node itself.)</p>
<p>It may help to think of prepending a peer ID as pushing a peer ID onto the
front of the stack of headers for the message.
(It will use the peer ID
it popped from the front to determine the next intermediate destination
for the response.)</p>
<p>When a response message is created, it is created using the same headers
that the survey contained.</p>
<p>A forwarding node can pop the peer ID it originally pushed on the
message, stripping it from the front of the message as it does so.</p>
<p>When the response finally arrives back at the initiating surveyor, it
should have only a single element in the message, which will be the
survey ID it originally used for the request.</p>
<p>More detail can be found in the <a href="proto/TODO.html">sp-surveyor-01 RFC</a> document.</p>
<p><hr/>
<p><a name="footnote-1"><a href="proto/surveyor.html#to-footnote-1">1</a></a>: An earlier and incompatible version of the protocol was used in older
pre-releases of <a href="proto/TODO.html">nanomsg</a>, but was not released in any production version.</p>
<div style="break-before: page; page-break-before: always;"></div><style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="transports"><a class="header" href="#transports">Transports</a></h1>
<p>This section documents transports for Scalabity Protocols implemented by NNG.</p>
<ul>
<li><a href="tran/socket.html">BSD Socket</a></li>
<li><a href="tran/inproc.html">Intra-Process Transport</a></li>
<li><a href="tran/udp.html">UDP</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="inproc-transport"><a class="header" href="#inproc-transport">INPROC Transport</a></h1>
<p>The <a name="a001"></a><em>inproc</em> transport<a name="a002"></a><a name="a003"></a>intra-process provides communication support between
sockets within the same process.
This may be used as an alternative
to slower transports when data must be moved within the same process.</p>
<p>This transport tries hard to avoid copying data, and thus is very
light-weight.</p>
<h2 id="url-format"><a class="header" href="#url-format">URL Format</a></h2>
<p>This transport uses URLs using the scheme <a name="a004"></a><code>inproc://</code>, followed by
an arbitrary string of text, terminated by a <code>NUL</code> byte.</p>
<p>Multiple URLs can be used within the
same application, and they will not interfere with one another.</p>
<p>Two applications may also use the same URL without interfering with each other.
They will however be unable to communicate with each other using that URL.</p>
<h2 id="socket-address"><a class="header" href="#socket-address">Socket Address</a></h2>
<p>When using an <a href="tran//TODO.html"><code>nng_sockaddr</code></a> structure, the actual structure is of type <a href="tran//TODO.html"><code>nng_sockaddr_inproc</code></a>.</p>
<h2 id="transport-options"><a class="header" href="#transport-options">Transport Options</a></h2>
<p>The <em>inproc</em> transport has no special options.</p>
<div class="mdbook-alerts mdbook-alerts-note">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  note
</p>
<p>While <em>inproc</em> accepts the option <code>NNG_OPT_RECVMAXSZ</code> for
compatibility, the value of the option is ignored with no enforcement.
As <em>inproc</em> peers are in the same address space, they are implicitly
trusted, so the protection afforded by <code>NNG_OPT_RECVMAXSZ</code> is unnecessary.</p>
</div>
<h2 id="mixing-implementations"><a class="header" href="#mixing-implementations">Mixing Implementations</a></h2>
<p>When mixing the <em>NNG</em> library with other implementations of these
protocols in the same process (such as the <em>mangos</em>
or <em>libnanomsg</em> implementations), it will not be possible to utilize
the <em>inproc</em> transport to communicate across this boundary.</p>
<p>This limitation also extends to using different instances of the <em>NNG</em>
library within the same process.</p>
<!-- Symbol cross reference -->
<!-- HTTP -->
<!-- Macros -->
<!-- Protocols -->
<!-- Transports -->
<!-- Concept index -->
<div style="break-before: page; page-break-before: always;"></div><style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="ipc-transport"><a class="header" href="#ipc-transport">IPC Transport</a></h1>
<h2 id="description-1"><a class="header" href="#description-1">DESCRIPTION</a></h2>
<p>The <a name="a001"></a><em>ipc</em> transport<a name="a002"></a> provides communication support between
sockets within different processes on the same host.
For POSIX platforms, this is implemented using <a name="a003"></a>UNIX domain sockets.
For Windows, this is implemented using Windows <a name="a004"></a>named pipes.
Other platforms may have different implementation strategies.</p>
<h3 id="uri-formats"><a class="header" href="#uri-formats">URI Formats</a></h3>
<h4 id="traditional-names"><a class="header" href="#traditional-names">Traditional Names</a></h4>
<p>This transport uses URIs using the scheme <a name="a005"></a><code>ipc://</code>, followed by a path
name in the file system where the socket or named pipe should be created.</p>
<div class="mdbook-alerts mdbook-alerts-tip">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  tip
</p>
<p>On Windows, all names are prefixed by <code>\\.\pipe\</code> and do not
reside in the normal file system.
On POSIX platforms, the path is taken literally, and is relative to
the current directory, unless it begins with <code>/</code>, in which case it is
relative to the root directory.</p>
</div>
<div class="mdbook-alerts mdbook-alerts-note">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  note
</p>
<p>When using relative paths on POSIX systems, the address used and returned
in properties like <a href="tran//api/sock.html#NNG_OPT_LOCADDR"><code>NNG_OPT_LOCADDR</code></a> will also be relative.
Consequently, they will only be interpreted the same by processes that have
the same working directory.
To ensure maximum portability and safety, absolute paths are recommended
whenever possible.</p>
</div>
<div class="mdbook-alerts mdbook-alerts-note">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  note
</p>
<p>If compatibility with legacy <em>nanomsg</em> applications is required,
then path names must not be longer than 122 bytes, including the final
<code>NUL</code> byte.
This is because legacy versions of <em>nanomsg</em> cannot express URLs
longer than 128 bytes, including the <code>ipc://</code> prefix.</p>
</div>
<h4 id="unix-aliases"><a class="header" href="#unix-aliases">UNIX Aliases</a></h4>
<p>The <a name="a006"></a><code>unix://</code> scheme is an alias for <code>ipc://</code> and can be used inter-changeably, but only on POSIX systems.
<sup><a name="to-footnote-1"><a href="tran/ipc.html#footnote-1">1</a></a></sup></p>
<h4 id="abstract-names"><a class="header" href="#abstract-names">Abstract Names</a></h4>
<p>On Linux, this transport also can support <a name="a007"></a>abstract sockets.
Abstract sockets use a URI-encoded name after the <a name="a008"></a><code>abstract://</code> scheme, which allows arbitrary values to be conveyed
in the path, including embedded <code>NUL</code> bytes.
For example, the name <code>"a\0b"</code> would be represented as <code>abstract://a%00b</code>.</p>
<div class="mdbook-alerts mdbook-alerts-tip">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  tip
</p>
<p>An empty name may be used with a listener to request “auto bind” be used to select a name.
In this case the system will allocate a free name.
The name assigned may be retrieved using <a href="tran//api/sock.html#NNG_OPT_LOCADDR"><code>NNG_OPT_LOCADDR</code></a>.</p>
</div>
<p>Abstract names do not include the leading <code>NUL</code> byte used in the low-level socket address.</p>
<p>Abstract sockets do not have any representation in the file system, and are automatically freed by
the system when no longer in use.</p>
<p>Abstract sockets ignore socket permissions, but it is still possible to determine the credentials
of the peer with <a href="tran//tran/ipc.html#NNG_OPT_PEER_UID"><code>NNG_OPT_PEER_UID</code></a>, and similar options.
<sup><a name="to-footnote-2"><a href="tran/ipc.html#footnote-2">2</a></a></sup></p>
<h3 id="socket-address-1"><a class="header" href="#socket-address-1">Socket Address</a></h3>
<p>When using an <a href="tran//TODO.html"><code>nng_sockaddr</code></a> structure,
the actual structure is of type <a href="tran//TODO.html"><code>nng_sockaddr_ipc</code></a>,
except for abstract sockets, which use <a href="tran//TODO.html"><code>nng_sockaddr_abstract</code></a>.</p>
<h3 id="transport-options-1"><a class="header" href="#transport-options-1">Transport Options</a></h3>
<p>The following transport options are supported by this transport,
where supported by the underlying platform.</p>
<div class="table-wrapper"><table><thead><tr><th>Option</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>NNG_OPT_IPC_PERMISSIONS</code></td><td><code>int</code></td><td>Settable on listeners before they start, this is the UNIX file mode used when creating the socket.</td></tr>
<tr><td><code>NNG_OPT_LOCADDR</code></td><td><a href="tran//TODO.html"><code>nng_sockaddr</code></a></td><td>Local socket address, either <a href="tran//TODO.html"><code>nng_sockaddr_ipc</code></a> or <a href="tran//TODO.html"><code>nng_sockaddr_abstract</code></a>.</td></tr>
<tr><td><code>NNG_OPT_REMADDR</code></td><td><a href="tran//TODO.html"><code>nng_sockaddr</code></a></td><td>Remote socket address, either <a href="tran//TODO.html"><code>nng_sockaddr_ipc</code></a> or <a href="tran//TODO.html"><code>nng_sockaddr_abstract</code></a>.</td></tr>
<tr><td><code>NNG_OPT_PEER_GID</code></td><td><code>int</code></td><td>Read only option, returns the group ID of the process at the other end of the socket, if platform supports it.</td></tr>
<tr><td><code>NNG_OPT_PEER_PID</code></td><td><code>int</code></td><td>Read only option, returns the processed ID of the process at the other end of the socket, if platform supports it.</td></tr>
<tr><td><code>NNG_OPT_PEER_UID</code></td><td><code>int</code></td><td>Read only option, returns the user ID of the process at the other end of the socket, if platform supports it.</td></tr>
<tr><td><code>NNG_OPT_PEER_ZONEID</code></td><td><code>int</code></td><td>Read only option, returns the zone ID of the process at the other end of the socket, if platform supports it.</td></tr>
<tr><td><a href="tran//api/streams.html#socket-activation"><code>NNG_OPT_LISTEN_FD</code></a></td><td><code>int</code></td><td>Write only for listeners before they start, use the named socket for accepting (for use with socket activation).</td></tr>
</tbody></table>
</div>
<h3 id="other-configuration-parameters"><a class="header" href="#other-configuration-parameters">Other Configuration Parameters</a></h3>
<p>On Windows systems, the security descriptor for the listener,
which can be used to control access, can be set using the function
<a href="tran//TODO.html"><code>nng_listener_set_security_descriptor</code></a>.</p>
<!-- Symbol cross reference -->
<!-- HTTP -->
<!-- Macros -->
<!-- Protocols -->
<!-- Transports -->
<!-- Concept index -->
<p><hr/>
<p><a name="footnote-1"><a href="tran/ipc.html#to-footnote-1">1</a></a>: The purpose of this scheme is to support a future transport making use of <code>AF_UNIX</code>
on Windows systems, at which time it will be necessary to discriminate between the Named Pipes and the <code>AF_UNIX</code> based transports.</p>
<p><a name="footnote-2"><a href="tran/ipc.html#to-footnote-2">2</a></a>: This property makes it important that names be chosen randomly to
prevent unauthorized access, or that checks against the peer credentials are made, or ideally, both.</p>
<div style="break-before: page; page-break-before: always;"></div><style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="socket-transport-experimental"><a class="header" href="#socket-transport-experimental">Socket Transport (Experimental)</a></h1>
<h2 id="description-2"><a class="header" href="#description-2">Description</a></h2>
<p>The <a name="a001"></a><em>socket</em> transport supports communication between
peers across arbitrary BSD sockets, such as those that are
created with <a href="tran//api/misc.html#create-socket-pair"><code>nng_socket_pair</code></a>.</p>
<p>This transport only supports <a href="tran//TODO.html">listeners</a>, using <a href="tran//TODO.html"><code>nng_listener_create</code></a>.</p>
<div class="mdbook-alerts mdbook-alerts-note">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  note
</p>
<p>Attempts to create <a href="tran//TODO.html">dialers</a> using this transport will result in <code>NNG_ENOTSUP</code>.</p>
</div>
<p>The socket file descriptor is passed to the listener using
the <a name="a002"></a><code>NNG_OPT_SOCKET_FD</code> option (as an integer).
Setting this option will cause the listener to create a <a href="tran//api/pipe.html">pipe</a>
backed by the file descriptor.</p>
<p>The protocol between peers using this transport is compatible with the protocol used
for the <em><a href="tran//tran/tcp.html">tcp</a></em> transport, but this is an implementation detail and subject to change without notice.
<sup><a name="to-footnote-1"><a href="tran/socket.html#footnote-1">1</a></a></sup></p>
<div class="mdbook-alerts mdbook-alerts-note">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  note
</p>
<p>This transport is <em>experimental</em>, and at present is only supported on POSIX platforms.
<sup><a name="to-footnote-2"><a href="tran/socket.html#footnote-2">2</a></a></sup></p>
</div>
<h2 id="url-format-1"><a class="header" href="#url-format-1">URL Format</a></h2>
<p>This transport uses the URL <a name="a003"></a><code>socket://</code>, without further qualification.</p>
<h2 id="socket-address-2"><a class="header" href="#socket-address-2">Socket Address</a></h2>
<p>The socket address will be of family <a name="a004"></a><code>NNG_AF_UNSPEC</code>.
There are no further socket details available.</p>
<h2 id="transport-options-2"><a class="header" href="#transport-options-2">Transport Options</a></h2>
<p>The following transport options are supported by this transport.</p>
<div class="table-wrapper"><table><thead><tr><th>Option</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>NNG_OPT_SOCKET_FD</code></td><td><code>int</code></td><td>Write-only option, that may be set multiple times on a listener. Each time this is set, the listener will create a <a href="tran//api/pipe.html">pipe</a> backed by the given file descriptor passed as an argument.</td></tr>
<tr><td><code>NNG_OPT_PEER_GID</code></td><td><code>int</code></td><td>Read only option, returns the group ID of the process at the other end of the socket, if platform supports it.</td></tr>
<tr><td><code>NNG_OPT_PEER_PID</code></td><td><code>int</code></td><td>Read only option, returns the processed ID of the process at the other end of the socket, if platform supports it.</td></tr>
<tr><td><code>NNG_OPT_PEER_UID</code></td><td><code>int</code></td><td>Read only option, returns the user ID of the process at the other end of the socket, if platform supports it.</td></tr>
<tr><td><code>NNG_OPT_PEER_ZONEID</code></td><td><code>int</code></td><td>Read only option, returns the zone ID of the process at the other end of the socket, if platform supports it.</td></tr>
</tbody></table>
</div><div class="mdbook-alerts mdbook-alerts-note">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  note
</p>
<p>The <code>NNG_OPT_PEER_GID</code>, <code>NNG_OPT_PEER_PID</code>, <code>NNG_OPT_PEER_UID</code>, and <code>NNG_OPT_PEER_ZONEID</code> options depend on platform support.
These behave in exactly the same fashion as for the <em><a href="tran//tran/ipc.html">ipc</a></em> transport.</p>
</div>
<!-- Symbol cross reference -->
<!-- HTTP -->
<!-- Macros -->
<!-- Protocols -->
<!-- Transports -->
<!-- Concept index -->
<p><hr/>
<p><a name="footnote-1"><a href="tran/socket.html#to-footnote-1">1</a></a>: Specifically it is not compatible with the <em><a href="tran//tran/ipc.html">ipc</a></em> transport.</p>
<p><a name="footnote-2"><a href="tran/socket.html#to-footnote-2">2</a></a>: Windows lacks a suitable <code>socketpair</code> equivalent function we could use.</p>
<div style="break-before: page; page-break-before: always;"></div><style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="udp-transport-experimental"><a class="header" href="#udp-transport-experimental">UDP Transport (Experimental)</a></h1>
<h2 id="description-3"><a class="header" href="#description-3">Description</a></h2>
<p>The <a name="a001"></a><em>udp</em> transport supports communication between peers using <a name="a002"></a>UDP.</p>
<p>UDP is a very light-weight connection-less, unreliable, unordered delivery mechanism.</p>
<p>Both <a name="a003"></a>IPv4 and <a name="a004"></a>IPv6 are supported when the underlying platform also supports it.</p>
<p>This transport adds an ordering guarantee, so that messages will always be received in
the correct order. Messages that arrive out of order, or are duplicated, will be
dropped. There may be gaps in the messages received, so applications should not assume
that all messages sent will arrive.</p>
<div class="mdbook-alerts mdbook-alerts-note">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  note
</p>
<p>This transport is <em>experimental</em>.</p>
</div>
<h2 id="url-format-2"><a class="header" href="#url-format-2">URL Format</a></h2>
<p>This transport uses URIs using the scheme <a name="a005"></a><code>udp://</code>, followed by
an IP address or hostname, followed by a colon and finally a
UDP <a name="a006"></a>port number.
For example, to contact port 8001 on the localhost either of the following URIs
could be used: <code>udp://127.0.0.1:8001</code> or <code>udp://localhost:8001</code>.</p>
<p>A URI may be restricted to IPv6 using the scheme <code>udp6://</code>, and may
be restricted to IPv4 using the scheme <code>udp4://</code>.</p>
<div class="mdbook-alerts mdbook-alerts-note">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  note
</p>
<p>Specifying <code>udp6://</code> may not prevent IPv4 hosts from being used with
IPv4-in-IPv6 addresses, particularly when using a wildcard hostname with
listeners.
The details of this varies across operating systems.</p>
</div>
<div class="mdbook-alerts mdbook-alerts-tip">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  tip
</p>
<p>We recommend using either numeric IP addresses, or names that are
specific to either IPv4 or IPv6 to prevent confusion and surprises.</p>
</div>
<p>When specifying IPv6 addresses, the address must be enclosed in
square brackets (<code>[]</code>) to avoid confusion with the final colon
separating the port.</p>
<p>For example, the same port 8001 on the IPv6 loopback address (<code>::1</code>) would
be specified as <code>udp://[::1]:8001</code>.</p>
<p>The special value of 0 (<a name="a007"></a><code>INADDR_ANY</code>)
can be used for a listener to indicate that it should listen on all
interfaces on the host.
A short-hand for this form is to omit the IP address entirely.
For example, the following two URIs are equivalent,
and could be used to listen to port 9999 on the host:</p>
<ol>
<li><code>udp://0.0.0.0:9999</code></li>
<li><code>udp://:9999</code></li>
</ol>
<h2 id="socket-address-3"><a class="header" href="#socket-address-3">Socket Address</a></h2>
<p>When using an <a href="tran//TODO.html"><code>nng_sockaddr</code></a> structure,
the actual structure is either of type
<a href="tran//TODO.html"><code>nng_sockaddr_in</code></a> (for IPv4) or
<a href="tran//TODO.html"><code>nng_sockaddr_in6</code></a> (for IPv6).</p>
<h2 id="transport-options-3"><a class="header" href="#transport-options-3">Transport Options</a></h2>
<p>The following transport options are supported by this transport,
where supported by the underlying platform.</p>
<div class="table-wrapper"><table><thead><tr><th>Option</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><a href="tran//api/sock.html#NNG_OPT_LOCADDR"><code>NNG_OPT_LOCADDR</code></a></td><td><a href="tran//TODO.html"><code>nng_sockaddr</code></a></td><td>The locally bound address, will be either <a href="tran//TODO.html"><code>nng_sockaddr_in</code></a> or <a href="tran//TODO.html"><code>nng_sockaddr_in6</code></a>.</td></tr>
<tr><td><a href="tran//api/sock.html#NNG_OPT_REMADDR"><code>NNG_OPT_REMADDR</code></a></td><td><a href="tran//TODO.html"><code>nng_sockaddr</code></a></td><td>The remote peer address, will be either <a href="tran//TODO.html"><code>nng_sockaddr_in</code></a> or <a href="tran//TODO.html"><code>nng_sockaddr_in6</code></a>. Only valid for <a href="tran//api/pipe.html">pipe</a> and <a href="tran//TODO.html">dialer</a> objects.</td></tr>
<tr><td><a href="tran//api/sock.html#NNG_OPT_RECVMAXSZ"><code>NNG_OPT_RECVMAXSZ</code></a></td><td><code>size_t</code></td><td>Maximum size of incoming messages, will be limited to at most 65000.</td></tr>
<tr><td><code>NNG_OPT_UDP_COPY_MAX</code><a name="NNG_OPT_UDP_COPY_MAX"></a></td><td><code>size_t</code></td><td>Threshold above which received messages are “loaned” up, rather than a new message being allocated and copied into.</td></tr>
<tr><td><code>NNG_OPT_UDP_BOUND_PORT</code><a name="NNG_OPT_UDP_BOUND_PORT"></a></td><td><code>int</code></td><td>The locally bound UDP port number (1-65535), read-only for <a href="tran//TODO.html">listener</a> objects only.</td></tr>
</tbody></table>
</div>
<h2 id="maximum-message-size"><a class="header" href="#maximum-message-size">Maximum Message Size</a></h2>
<p>This transport maps each SP message to a single UDP packet.
In order to allow room for network headers, we thus limit the maximum
message size to 65000 bytes, minus the overhead for any SP protocol headers.</p>
<p>However, applications are <em>strongly</em> encouraged to only use this transport for
very much smaller messages, ideally those that will fit within a single network
packet without requiring fragmentation and reassembly.</p>
<p>For Ethernet without jumbo frames, this typically means an <a name="a008"></a>MTU of a little
less than 1500 bytes. (Specifically, 1452, which allows 28 bytes for IPv4 and UDP,
and 20 bytes for the this transport. Reduce by an additional 20 bytes for IPv6.)</p>
<p>Other link layers may have different MTUs, however IPv6 requires a minimum MTU of 1280,
which after deducting 48 bytes for IPv6 and UDP headers, and 20 bytes for our transport
header, leaves 1212 bytes for user data. If additional allowances are made for SP protocol
headers with a default TTL of 8 (resulting in 72 additional bytes for route information),
the final user accessible payload will be 1140 bytes. Thus this can be likely be viewed
as a safe maximum to employ for SP payload data across all transports.</p>
<p>The maximum message size is negotiated as part of establishing a peering relationship,
and oversize messages will be dropped by the sender before going to the network.</p>
<p>The maximum message size to receive can be configured with the <a href="tran//api/sock.html#NNG_OPT_RECVMAXSZ"><code>NNG_OPT_RECVMAXSZ</code></a> option.</p>
<h2 id="keep-alive"><a class="header" href="#keep-alive">Keep Alive</a></h2>
<p>This transports maintains a logical “connection” with each peer, to provide a rough
facsimile of a connection based semantic. This requires some resource on each peer.
In order to ensure that resources are reclaimed when a peer vanishes unexpectedly, a
keep-alive mechanism is implemented.</p>
<p>TODO: Document the tunables for this.</p>
<!-- Symbol cross reference -->
<!-- HTTP -->
<!-- Macros -->
<!-- Protocols -->
<!-- Transports -->
<!-- Concept index -->
<div style="break-before: page; page-break-before: always;"></div><style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="migration-guides"><a class="header" href="#migration-guides">Migration Guides</a></h1>
<p>This section provides some guides to aid in migrating software from
earlier versions <em>NNG</em> or <em>libnanomsg</em>.</p>
<ul>
<li><a href="migrate/./migrate/nng1.html">Migrating from NNG 1.x</a></li>
<li><a href="migrate/./migrate/nanomsg.html">Migrating from libnanomsg</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="migrating-from-nng-1x"><a class="header" href="#migrating-from-nng-1x">Migrating from NNG 1.x</a></h1>
<p>There are some incompatibities from NNG 1.x, and applications must make certain changes for NNG 2.0.
This guide should help with this migration. While we have made reasonable efforts to highlight all
of the things that applications could run into, this list is not necessarily exhaustive, and undocumented
interfaces may have changed without notice here.</p>
<h2 id="detecting-nng-v2"><a class="header" href="#detecting-nng-v2">Detecting NNG v2</a></h2>
<p>For applications that need to detect NNG v2 versus older code, the <code>NNG_MAJOR_VERSION</code> macro
can be used. This will have numeric value 2 for version 2, and 1 for earlier versions.</p>
<div class="mdbook-alerts mdbook-alerts-note">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  note
</p>
<p>NNG version 2.0 is not stabilized yet, and while it is in development there is no compatibility guarantee
between releases or builds of NNG 2.</p>
</div>
<h2 id="nanomsg-compatibility"><a class="header" href="#nanomsg-compatibility">Nanomsg Compatibility</a></h2>
<p>Applications using the legacy <code>libnanomsg</code> API will have to be updated to native NNG interfaces.
See the <a href="migrate/nanomsg.html">Migrating From libnanomsg</a> chapter for details.</p>
<h2 id="library-initialization"><a class="header" href="#library-initialization">Library Initialization</a></h2>
<p>It is now required for applications to initialize the library explicitly before using it.
This is done using the <a href="migrate//api/init.html#initialization"><code>nng_init</code></a> function.</p>
<h2 id="removed-headers"><a class="header" href="#removed-headers">Removed Headers</a></h2>
<p>The following header files are removed, and the declarations they provided are now provided by including <code>&lt;nng/nng.h&gt;</code>.
Simply remove any references to them.</p>
<ul>
<li><code>nng/protocol/bus0/bus.h</code></li>
<li><code>nng/protocol/pair0/pair.h</code></li>
<li><code>nng/protocol/pair1/pair.h</code></li>
<li><code>nng/protocol/pipeline0/pull.h</code></li>
<li><code>nng/protocol/pipeline0/push.h</code></li>
<li><code>nng/protocol/pubsub0/pub.h</code></li>
<li><code>nng/protocol/pubsub0/sub.h</code></li>
<li><code>nng/protocol/reqrep0/rep.h</code></li>
<li><code>nng/protocol/reqrep0/req.h</code></li>
<li><code>nng/protocol/survey0/respond.h</code></li>
<li><code>nng/protocol/survey0/survey.h</code></li>
<li><code>nng/supplemental/tls/tls.h</code></li>
<li><code>nng/supplemental/util/idhash.h</code></li>
<li><code>nng/supplemental/util/platform.h</code></li>
<li><code>nng/transport/inproc/inproc.h</code></li>
<li><code>nng/transport/ipc/ipc.h</code></li>
<li><code>nng/transport/tcp/tcp.h</code></li>
<li><code>nng/transport/tls/tls.h</code></li>
<li><code>nng/transport/ws/websocket.h</code></li>
<li><code>nng/transport/zerotier/zerotier.h</code></li>
</ul>
<h2 id="renamed-functions"><a class="header" href="#renamed-functions">Renamed Functions</a></h2>
<p>The following functions have been renamed as described by the following table.
The old names are available by defining the macro <code>NNG1_TRANSITION</code> in your compilation environment.</p>
<div class="table-wrapper"><table><thead><tr><th>Old Name</th><th>New Name</th></tr></thead><tbody>
<tr><td><code>nng_close</code></td><td><a href="migrate//api/sock.html#closing-a-socket"><code>nng_socket_close</code></a></td></tr>
<tr><td><code>nng_recv_aio</code></td><td><a href="migrate//api/sock.html#nng_socket_recv"><code>nng_socket_recv</code></a></td></tr>
<tr><td><code>nng_send_aio</code></td><td><a href="migrate//api/sock.html#nng_socket_send"><code>nng_socket_send</code></a></td></tr>
</tbody></table>
</div>
<h2 id="removed-protocol-aliases"><a class="header" href="#removed-protocol-aliases">Removed Protocol Aliases</a></h2>
<p>The following macro aliases are removed, unless <code>NNG1_TRANSITION</code> is defined in your compilation environment.</p>
<ul>
<li><code>nng_bus_open</code></li>
<li><code>nng_pair_open</code></li>
<li><code>nng_pub_open</code></li>
<li><code>nng_pull_open</code></li>
<li><code>nng_push_open</code></li>
<li><code>nng_rep_open</code></li>
<li><code>nng_req_open</code></li>
<li><code>nng_respondent_open</code></li>
<li><code>nng_sub_open</code></li>
<li><code>nng_surveyor_open</code></li>
</ul>
<p>Just add either <code>0</code> or <code>1</code> (in the case of PAIRv1) to get the protocol desired. (Forcing the version number to
be supplied should avoid surprises later as new versions of protocols are added.)</p>
<h2 id="nng_flag_alloc-removed"><a class="header" href="#nng_flag_alloc-removed">NNG_FLAG_ALLOC Removed</a></h2>
<p>The <code>NNG_FLAG_ALLOC</code> flag that allowed a zero copy semantic with <a href="migrate//api/sock.html#nng_send"><code>nng_send</code></a> and <a href="migrate//TODO.html"><code>nng_recv</code></a> is removed.
This was implemented mostly to aid legacy nanomsg applications, and it was both error prone and still a bit
suboptimal in terms of performance.</p>
<p>Modern code should use one of <a href="migrate//api/sock.html#nng_sendmsg"><code>nng_sendmsg</code></a>, <a href="migrate//api/sock.html#nng_recvmsg"><code>nng_recvmsg</code></a>, <a href="migrate//api/sock.html#nng_socket_send"><code>nng_socket_send</code></a>, or <a href="migrate//api/sock.html#nng_socket_recv"><code>nng_socket_recv</code></a> to get the maximum performance benefit.
Working directly with <a href="migrate//api/msg.html#message-structure"><code>nng_msg</code></a> structures gives more control, reduces copies, and reduces allocation activity.</p>
<h2 id="error-code-changes"><a class="header" href="#error-code-changes">Error Code Changes</a></h2>
<p>When an operation fails with <a href="migrate//api/errors.html#NNG_ESTOPPED"><code>NNG_ESTOPPED</code></a>, it means that the associated [<code>nni_aio</code>] object has
been permanently stopped and must not be reused. Applications must watch for this error code, and
not resubmit an operation that returns it. This is particularly important for callbacks that automatically
resubmit operations. Failure to observe this rule will lead to an infinite loop
as any further operations on the object will fail immediately with <code>NNG_ESTOPPED</code>.</p>
<p>The error codes <code>NNG_EAMBIGUOUS</code> and <code>NNG_ENOARG</code> have been removed.</p>
<h2 id="aio-provider-api-changes"><a class="header" href="#aio-provider-api-changes">AIO Provider API changes</a></h2>
<p>The API used for providers for asynchronous I/O operations has changed slightly.</p>
<ul>
<li>The <code>nng_aio_begin</code> function is removed. However a new <a href="migrate//TODO.html"><code>nng_aio_reset</code></a> function should be called
instead, before performing any other operations on an <em>aio</em> object. (This simply clears certain fields.)</li>
<li>The <code>nng_aio_defer</code> function is replaced, with a very <a href="migrate//TODO.html"><code>nng_aio_start</code></a> function. However, this function
has slightly different semantics. It will automatically call the callback if the operation cannot be
scheduled.</li>
<li>Be aware of the new <code>NNG_ESTOPPED</code> error code, for operations on a handle that is being torn down by
the consumer.</li>
</ul>
<h2 id="transport-specific-functions"><a class="header" href="#transport-specific-functions">Transport Specific Functions</a></h2>
<p>Transports have not needed to be registered for a long time now,
and the functions for doing so have been removed. These functions
can be simply removed from your application:</p>
<ul>
<li><code>nng_inproc_register</code></li>
<li><code>nng_ipc_register</code></li>
<li><code>nng_tls_register</code></li>
<li><code>nng_tcp_register</code></li>
<li><code>nng_ws_register</code></li>
<li><code>nng_wss_register</code></li>
<li><code>nng_zt_register</code></li>
</ul>
<p>Additionally, the header files containing these functions have been removed, such as
<code>nng/transport/ipc/ipc.h</code>. Simply remove <code>#include</code> references to those files.</p>
<h2 id="tls-configuration-1"><a class="header" href="#tls-configuration-1">TLS Configuration</a></h2>
<p>The support for configuring TLS via <code>NNG_OPT_TLS_CONFIG</code>, <code>NNG_TLS_AUTH_MODE</code>, <code>NNG_OPT_TLS_CA_FILE</code>,
<code>NNG_OPT_TLS_SERVER_NAME</code>, and similar has been removed.</p>
<p>Instead configuration must be performed by allocating
a <code>nng_tls_config</code> object, and then setting fields on it using the appropriate functions,
after which it may be configured on a listener or dialer using the <a href="migrate//TODO.html"><code>nng_listener_set_tls</code></a>
or <a href="migrate//TODO.html"><code>nng_dialer_set_tls</code></a> functions.</p>
<p>Likewise, when using the streams API, use the <a href="migrate//api/stream.html#tls-configuration"><code>nng_stream_listener_set_tls</code></a> or
<a href="migrate//api/stream.html#tls-configuration"><code>nng_stream_dialer_set_tls</code></a> functions.</p>
<p>Note that the declarations needed for TLS configuration are now available in <code>&lt;nng/nng.h&gt;</code>,
rather than the supplemental header.</p>
<h2 id="old-tls-versions-removed"><a class="header" href="#old-tls-versions-removed">Old TLS Versions Removed</a></h2>
<p>Support for very old TLS versions 1.0 and 1.1 is removed.
Further, the <code>NNG_TLS_1_0</code> and <code>NNG_TLS_1_1</code> constants are also removed.
Applications should use <code>NNG_TLS_1_2</code> or even <code>NNG_TLS_1_3</code> instead.</p>
<h2 id="only-one-tls-keycert-per-configuration"><a class="header" href="#only-one-tls-keycert-per-configuration">Only One TLS Key/Cert Per Configuration</a></h2>
<p>The ability to configure multiple keys and certificates for a given TLS configuration object is removed.
(The <a href="migrate//TODO.html"><code>nng_tls_config_own_cert</code></a> will return <a href="migrate//api/errors.html#NNG_EBUSY"><code>NNG_EBUSY</code></a> if it has already been called for the configuration.)
The intended purpose was to support alternative cryptographic algorithms, but this is not necessary, was never
used, and was error prone.</p>
<h2 id="tls-peer-certificate-apis-replaced"><a class="header" href="#tls-peer-certificate-apis-replaced">TLS Peer Certificate APIs Replaced</a></h2>
<p>The <code>NNG_OPT_TLS_PEER_CN</code> and <code>NNG_OPT_TLS_PEER_ALT_NAMES</code> properties have been removed.
They are replaced with functions like [<code>nng_pipe_peer_cert</code>], [<code>nng_stream_peer_cert</code>],
and [<code>nng_http_peer_cert</code>] which return a new <code>nng_tls_cert</code> object.</p>
<p>This object supports methods to get additional information about the certificate, as well
as to obtain the raw DER content so that it can be imported for use in other APIs.</p>
<h2 id="support-for-local-addresses-in-dial-urls-removed"><a class="header" href="#support-for-local-addresses-in-dial-urls-removed">Support for Local Addresses in Dial URLs Removed</a></h2>
<p>NNG 1.x had an undocumented ability to specify the local address to bind
to when dialing, by using the local address in front of the destination
address separated by a semicolon. This was provided for legacy libnanomsg
compatibility, and is no longer offered. The correct way to specify a
local address is by setting <code>NNG_OPT_LOCADDR</code> on the dialer.</p>
<h2 id="ipc-option-type-changes"><a class="header" href="#ipc-option-type-changes">IPC Option Type Changes</a></h2>
<p>The types of <a href="migrate//tran/ipc.html#NNG_OPT_PEER_GID"><code>NNG_OPT_PEER_GID</code></a>, <a href="migrate//tran/ipc.html#NNG_OPT_PEER_PID"><code>NNG_OPT_PEER_PID</code></a>, <a href="migrate//tran/ipc.html#NNG_OPT_PEER_UID"><code>NNG_OPT_PEER_UID</code></a>, and <a href="migrate//tran/ipc.html#NNG_OPT_PEER_ZONEID"><code>NNG_OPT_PEER_ZONEID</code></a>
have changed from <code>uint64_t</code> to <code>int</code>. The underlying platforms all use 32-bit quantities for these.</p>
<h2 id="option-functions"><a class="header" href="#option-functions">Option Functions</a></h2>
<p>The previously deprecated <code>nng_pipe_getopt_xxx</code> family of functions is removed.
Applications should use <code>nng_pipe_get</code> and related functions instead.</p>
<p>The socket option function families for <code>nng_getopt</code> and <code>nng_setopt</code> have been removed as well.
In this case, use the <code>nng_socket_get</code> and <code>nng_socket_set</code> functions as appropriate.</p>
<p>The <code>_getopt</code> and <code>_setopt</code> functions for contexts, listeners, and dialers are no longer
present. Simply changing <code>_getopt</code> to <code>_get</code> or <code>_setopt</code> to <code>_set</code> in the function name
should be sufficient in most cases.</p>
<p>The following functions served no useful purpose (after other changes described in this document),
and are thus removed:</p>
<ul>
<li><code>nng_ctx_get_string</code></li>
<li><code>nng_ctx_set_string</code></li>
<li><code>nng_ctx_get_uint64</code></li>
<li><code>nng_dialer_get_ptr</code></li>
<li><code>nng_dialer_set_ptr</code></li>
<li><code>nng_dialer_get_uint64</code></li>
<li><code>nng_dialer_set_uint64</code></li>
<li><code>nng_listener_get_ptr</code></li>
<li><code>nng_listener_set_ptr</code></li>
<li><code>nng_listener_get_uint64</code></li>
<li><code>nng_listener_set_uint64</code></li>
<li><code>nng_socket_get_ptr</code></li>
<li><code>nng_socket_set_ptr</code></li>
<li><code>nng_socket_get_string</code></li>
<li><code>nng_socket_set_string</code></li>
<li><code>nng_socket_get_uint64</code></li>
<li><code>nng_socket_set_uint64</code></li>
<li><code>nng_stream_get_ptr</code></li>
<li><code>nng_stream_set_ptr</code></li>
<li><code>nng_stream_get_uint64</code></li>
<li><code>nng_stream_dialer_get_ptr</code></li>
<li><code>nng_stream_dialer_set_ptr</code></li>
<li><code>nng_stream_dialer_get_uint64</code></li>
<li><code>nng_stream_dialer_set_uint64</code></li>
<li><code>nng_stream_listener_get_ptr</code></li>
<li><code>nng_stream_listener_set_ptr</code></li>
<li><code>nng_stream_listener_get_uint64</code></li>
<li><code>nng_stream_listener_set_uint64</code></li>
<li><code>nng_ctx_get_ptr</code> (not documented)</li>
<li><code>nng_ctx_set_ptr</code> (not documented)</li>
</ul>
<h2 id="untyped-option-functions-removed"><a class="header" href="#untyped-option-functions-removed">Untyped Option Functions Removed</a></h2>
<p>The following functions are removed. To access options, use a proper typed access function,
such as one ending in a suffix like <code>_bool</code> (to access a <code>bool</code> typed option).</p>
<ul>
<li><code>nng_ctx_get</code></li>
<li><code>nng_ctx_set</code></li>
<li><code>nng_dialer_get</code></li>
<li><code>nng_dialer_set</code></li>
<li><code>nng_listener_get</code></li>
<li><code>nng_listener_set</code></li>
<li><code>nng_pipe_get</code></li>
<li><code>nng_socket_get</code></li>
<li><code>nng_socket_set</code></li>
<li><code>nng_stream_get</code></li>
<li><code>nng_stream_set</code></li>
<li><code>nng_stream_dialer_get</code></li>
<li><code>nng_stream_dialer_set</code></li>
<li><code>nng_stream_listener_get</code></li>
<li><code>nng_stream_listener_set</code></li>
</ul>
<h2 id="stream-options"><a class="header" href="#stream-options">Stream Options</a></h2>
<p>The ability to set options on streams after they have been created is no longer present.
(It turns out that this was not very useful.) All functions <code>nng_stream_set_xxx</code> are removed.
For tuning the <code>NNG_OPT_TCP_NODELAY</code> or similar properties, set the option on the listener
or dialer that creates the stream instead.</p>
<h2 id="transport-options-4"><a class="header" href="#transport-options-4">Transport Options</a></h2>
<p>A number of transport options can no longer be set on the socket. Instead these
options must be set on the endpoint (dialer or listener) using the appropriate
<a href="migrate//TODO.html"><code>nng_dialer_set</code></a> or <a href="migrate//TODO.html"><code>nng_listener_set</code></a> option. This likely means that it is necessary
to allocate and configure the endpoint before attaching it to the socket. This will
also afford a much more fine-grained level of control over transport options.</p>
<p>The following options are copied from the socket when creating a dialer or listener,
but afterwards will not be changed on the dialer or listener if the socket
changes. It is recommended to set them properly on the socket before
creating dialers or listeners, or set them explicitly on the dialer or listener
directly:</p>
<ul>
<li><a href="migrate//api/sock.html#NNG_OPT_RECONNMINT"><code>NNG_OPT_RECONNMINT</code></a></li>
<li><a href="migrate//api/sock.html#NNG_OPT_RECONNMAXT"><code>NNG_OPT_RECONNMAXT</code></a></li>
<li><a href="migrate//api/sock.html#NNG_OPT_RECVMAXSZ"><code>NNG_OPT_RECVMAXSZ</code></a></li>
</ul>
<p>The latter option is a hint for transports and intended to facilitate early
detection (and possibly avoidance of extra allocations) of oversize messages,
before bringing them into the socket itself.</p>
<h2 id="socket-options-1"><a class="header" href="#socket-options-1">Socket Options</a></h2>
<p>The <code>NNG_OPT_PROTO</code>, <code>NNG_OPT_PROTONAME</code>, <code>NNG_OPT_PEER</code>, and <code>NNG_OPT_PEERNAME</code> options
have been replaced by functions instead of options.
Use <a href="migrate//api/sock.html#socket-identity"><code>nng_socket_proto_id</code></a>, <a href="migrate//api/sock.html#socket-identity"><code>nng_socket_peer_id</code></a>, <a href="migrate//api/sock.html#socket-identity"><code>nng_socket_proto_name</code></a>, and <a href="migrate//api/sock.html#socket-identity"><code>nng_socket_peer_name</code></a> instead.
Note that the new functions provide a reference to a static string, and thus do not require
allocation, and the returned strings should not be freed. Also the IDs are provided as <code>uint16_t</code>,
matching the actual wire protocol values, instead of <code>int</code>.</p>
<p>The <code>NNG_OPT_RAW</code> option has also been replaced by a function, <a href="migrate//api/sock.html#socket-identity"><code>nng_socket_raw</code></a>.</p>
<p>The <code>NNG_OPT_SENDFD</code> and <code>NNG_OPT_RECVFD</code> options have been replaced by
<a href="migrate//api/sock.html#polling-socket-events"><code>nng_socket_get_send_poll_fd</code></a> and <a href="migrate//api/sock.html#polling-socket-events"><code>nng_socket_get_recv_poll_fd</code></a> respectively.</p>
<p>The <code>NNG_OPT_SOCKNAME</code> function is removed. This was provided for application use, and never used internally by NNG.
Applications should keep track of this information separately.</p>
<h2 id="subscriptions"><a class="header" href="#subscriptions">Subscriptions</a></h2>
<p>The <code>NNG_OPT_SUB_SUBSCRIBE</code> and <code>NNG_OPT_SUB_UNSUBSCRIBE</code> options have been replaced by
the following functions: <a href="migrate//TODO.html"><code>nng_sub0_socket_subscribe</code></a>, <a href="migrate//TODO.html"><code>nng_sub0_socket_unsubscribe</code></a>,
<a href="migrate//TODO.html"><code>nng_sub0_ctx_subscribe</code></a> and <a href="migrate//TODO.html"><code>nng_sub0_ctx_unsubscribe</code></a>. These functions, like the options
they replace, are only applicable to SUB sockets.</p>
<h2 id="statistics-use-constified-pointers"><a class="header" href="#statistics-use-constified-pointers">Statistics Use Constified Pointers</a></h2>
<p>A number of the <a href="migrate//api/stats.html">statistics</a> functions take, or return, <code>const nng_stat *</code> instead
of plain <code>nng_stat *</code>. The ABI has not changed, but it may be necessary to declare
certain methods variables <code>const</code> to avoid warnings about misuse of <code>const</code>.</p>
<h2 id="wildcards-not-valid-in-urls"><a class="header" href="#wildcards-not-valid-in-urls">Wildcards Not Valid in URLs</a></h2>
<p>The use of <code>*</code> to act as a wild card meaning all local interface addresses
is removed. The empty string already performs this function, and unlike
<code>*</code> is RFC compliant.</p>
<h2 id="url-option-removed"><a class="header" href="#url-option-removed">URL Option Removed</a></h2>
<p>The <code>NNG_OPT_URL</code> option has been removed.
It is replaced by the type safe <a href="migrate//TODO.html"><code>nng_dialer_get_url</code></a> and
<a href="migrate//TODO.html"><code>nng_listener_get_url</code></a> functions, which return an <a href="migrate//api/url.html#url-structure"><code>nng_url</code></a>
structure instead of a string.</p>
<h2 id="url-structure-changes"><a class="header" href="#url-structure-changes">URL Structure Changes</a></h2>
<p>The details of <a href="migrate//api/url.html#url-structure"><code>nng_url</code></a> have changed significantly, and direct
access of the structure is no longer permitted. Instead new
accessors functions are provided:</p>
<ul>
<li><code>u_scheme</code> is replaced by <a href="migrate//api/url.html#url-fields"><code>nng_url_scheme</code></a>.</li>
<li><code>u_port</code> is replaced by <a href="migrate//api/url.html#url-fields"><code>nng_url_port</code></a>, but this returns a <code>uint16_t</code>.</li>
<li><code>u_hostname</code> is replaced by <a href="migrate//api/url.html#url-fields"><code>nng_url_hostname</code></a>.</li>
<li><code>u_path</code> is replaced by <a href="migrate//api/url.html#url-fields"><code>nng_url_path</code></a>.</li>
<li><code>u_query</code> is replaced by <a href="migrate//api/url.html#url-fields"><code>nng_url_query</code></a>.</li>
<li><code>u_fragment</code> is replaced by <a href="migrate//api/url.html#url-fields"><code>nng_url_fragment</code></a>.</li>
<li><code>u_userinfo</code> is replaced by <a href="migrate//api/url.html#url-fields"><code>nng_url_userinfo</code></a>.</li>
<li><code>u_requri</code> is removed - it can be easily formulated from the other fields.</li>
<li><code>u_host</code> is removed - use <a href="migrate//api/url.html#url-fields"><code>nng_url_hostname</code></a> and <a href="migrate//api/url.html#url-fields"><code>nng_url_port</code></a> to construct if needed</li>
<li><code>u_rawurl</code> is removed - a “cooked” URL can be obtained from the new <a href="migrate//api/url.html#format-a-url"><code>nng_url_sprintf</code></a> function.</li>
</ul>
<h2 id="http-api"><a class="header" href="#http-api">HTTP API</a></h2>
<p>The entire HTTP API has been refactored and should be much simpler to use and more efficient.
Applications directly using the HTTP API will need to be fully modified.</p>
<p>A few limits on string lengths of certain values are now applied, which allows us to preallocate values
and eliminate certain unreasonable error paths. If values longer than these are supplied in certain APIs
they may be silently truncated to the limit:</p>
<ul>
<li>Hostnames are limited per RFC 1035 to 253 characters (not including terminating “.” or zero byte.)</li>
<li>HTTP Method names are limited to 32 bytes (the longest IANA registered method is currently 18 bytes, used for WebDAV.)</li>
<li>The fixed part of URI pathnames used with HTTP handlers is limited to 1024 bytes. (Longer URIs may be accepted
by using [<code>nng_http_handler_set_tree</code>] and matching a parent of the directory component.)</li>
</ul>
<p>The following API calls have changed so that they are <code>void</code> returns, and cannot fail.
They may silently truncate data.</p>
<ul>
<li>[<code>nng_http_req_set_method</code>]</li>
<li>[<code>nng_http_res_set_status</code>]</li>
<li>[<code>nng_http_handler_collect_body</code>]</li>
<li>[<code>nng_http_handler_set_data</code>]</li>
<li>[<code>nng_http_handler_set_host</code>]</li>
<li>[<code>nng_http_handler_set_method</code>]</li>
<li>[<code>nng_http_handler_set_tree</code>]</li>
</ul>
<p>The HTTP handler objects may not be modified once in use. Previously this would fail with <code>NNG_EBUSY</code>.
These checks are removed now, but debug builds will assert if an application tries to do so.</p>
<h2 id="websocket-api"><a class="header" href="#websocket-api">WebSocket API</a></h2>
<p>The <code>NNG_OPT_WSS_REQUEST_HEADERS</code>, <code>NNG_OPT_WSS_RESPONSE_HEADERS</code> and
<code>NNG_OPT_WS_OPT_WS_REQUEST_HEADERS</code>, <code>NNG_OPT_WS_RESPONSE_HEADERS</code> have been removed.</p>
<p>The <code>NNG_OPT_WS_REQUEST_HEADER</code> and <code>NNG_OPT_WS_RESPONSE_HEADER</code> option prefixes have been
collapsed into just <code>NNG_OPT_WS_HEADER</code>, with slightly different semantics. It still is
a prefix (append the name of the header of interest), but setting it can only affect
outbound headers (request header for dialers, response header for listeners), and when
reading it on a pipe, the value returned is the header sent by the remote peer.</p>
<p>The undocumented hook function signature has changed to reflect changes in the HTTP API.</p>
<h2 id="security-descriptors-windows-only"><a class="header" href="#security-descriptors-windows-only">Security Descriptors (Windows Only)</a></h2>
<p>The <code>NNG_OPT_IPC_SECURITY_DESCRIPTOR</code> option is removed, and replaced
with the functions [<code>nng_listener_get_security_descriptor</code>] and
[<code>nng_stream_listener_get_security_descriptor</code>].</p>
<p>Security descriptor support is only relevant to Windows,
and is presently only supported for IPC when Named Pipes are used.
Planned future changes to switch to UNIX domain sockets may eliminate
support for security descriptors altogether in NNG.</p>
<h2 id="command-line-argument-parser-changes"><a class="header" href="#command-line-argument-parser-changes">Command Line Argument Parser Changes</a></h2>
<p>The supplemental function <code>nng_opts_parse</code> and supporting definitions have moved.
This functionality is now supplied by a header only library, available in <code>nng/args.h</code>.
See <a href="migrate//api/args.html#parse-command-line-arguments"><code>nng_args_parse</code></a> for more information.</p>
<h2 id="zerotier-support-removed"><a class="header" href="#zerotier-support-removed">ZeroTier Support Removed</a></h2>
<p>The Layer 2 special ZeroTier transport has been removed.
It is possible to use NNG with ZeroTier using TCP/IP, and a future update
is planned to provided coexistence between ZeroTier &amp; the native stack’s TCP/IP using lwIP.</p>
<!-- Symbol cross reference -->
<!-- HTTP -->
<!-- Macros -->
<!-- Protocols -->
<!-- Transports -->
<!-- Concept index -->
<div style="break-before: page; page-break-before: always;"></div><style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="migrating-from-libnanomsg"><a class="header" href="#migrating-from-libnanomsg">Migrating from libnanomsg</a></h1>
<p>Previous version of NNG offered direct API compatibility with <em>libnanomsg</em>,
but that support is no longer offered in this version.</p>
<p>If your application is still using legacy <em>libnanomsg</em> APIs, you will need to
update it for this version of NNG.</p>
<h2 id="header-files"><a class="header" href="#header-files">Header Files</a></h2>
<p>Most applications can replace all <code>#include &lt;nn/*.h&gt;</code> statements with <code>#include &lt;nng/nng.h&gt;</code>.</p>
<h2 id="link-libraries"><a class="header" href="#link-libraries">Link Libraries</a></h2>
<p>Replace <code>-lnanomsg</code> with <code>-lnng</code>.
It may be necessary to include additional system libraries, such as <code>-lpthread</code>, depending on your system.</p>
<h2 id="initialization-2"><a class="header" href="#initialization-2">Initialization</a></h2>
<p>It is necessary to explicitly initialize the library, using the <a href="migrate//api/init.html#initialization"><code>nng_init</code></a> function.
This must be called before any other function.</p>
<h2 id="types"><a class="header" href="#types">Types</a></h2>
<p>Sockets, dialers, and listeners in <em>libnanomsg</em> are simple integers.
In NNG, these are <code>struct</code> types.</p>
<p>Messages are quite different in NNG, with the absence of the POSIX message control
headers.</p>
<p>The <code>struct nn_msghdr</code> structure has no equivalent. See <code>nng_msg</code> for the
NNG approach to messages. Likewise there is no <code>struct nn_cmsghdr</code> equivalent.</p>
<h2 id="api-conversions"><a class="header" href="#api-conversions">API Conversions</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Nanomsg API</th><th>NNG Equivalent</th><th>Notes</th></tr></thead><tbody>
<tr><td><code>nn_strerror</code></td><td><a href="migrate//api/errors.html#human-readable-error-message"><code>nng_strerror</code></a></td><td></td></tr>
<tr><td><code>nn_errno</code></td><td>None</td><td>Errors are returned directly rather than through <code>errno</code>.</td></tr>
<tr><td><code>nn_socket</code></td><td>Various</td><td>Use the appropriate protocol constructor, such as <code>nng_req0_open</code>.</td></tr>
<tr><td><code>nn_close</code></td><td><a href="migrate//api/sock.html#closing-a-socket"><code>nng_socket_close</code> </a></td><td></td></tr>
<tr><td><code>nn_bind</code></td><td><a href="migrate//TODO.html"><code>nng_listen</code></a>, <a href="migrate//TODO.html"><code>nng_listener_create</code></a></td><td>Allocating a listener with <code>nng_lister_create</code> and configuring it offers more capabilities.</td></tr>
<tr><td><code>nn_connect</code></td><td><a href="migrate//TODO.html"><code>nng_dial</code></a>, <a href="migrate//TODO.html"><code>nng_dialer_create</code></a></td><td>Allocating a dialer with <code>nng_dialer_create</code> and configuring it offers more capabilities.</td></tr>
<tr><td><code>nn_shutdown</code></td><td><a href="migrate//TODO.html"><code>nng_listener_close</code></a>, <a href="migrate//TODO.html"><code>nng_dialer_close</code></a></td><td></td></tr>
<tr><td><code>nn_allocmsg</code></td><td><a href="migrate//api/msg.html#create-a-message"><code>nng_msg_alloc</code></a></td><td>There are significant semantic differences.</td></tr>
<tr><td><code>nn_freemsg</code></td><td><a href="migrate//api/msg.html#destroy-a-message"><code>nng_msg_free</code></a></td><td></td></tr>
<tr><td><code>nn_reallocmsg</code></td><td><a href="migrate//api/msg.html#message-size-and-capacity"><code>nng_msg_realloc</code></a></td><td></td></tr>
<tr><td><code>nn_send</code></td><td><a href="migrate//api/sock.html#nng_send"><code>nng_send</code></a></td><td></td></tr>
<tr><td><code>nn_recv</code></td><td><a href="migrate//TODO.html"><code>nng_recv</code></a></td><td></td></tr>
<tr><td><code>nn_sendmsg</code></td><td><a href="migrate//api/sock.html#nng_sendmsg"><code>nng_sendmsg</code></a></td><td></td></tr>
<tr><td><code>nn_getsockopt</code></td><td><a href="migrate//api/sock.html#socket-options"><code>nng_socket_get</code></a></td><td>NNG has typed accessors for options, and also separate functions for dialers and listeners.</td></tr>
<tr><td><code>nn_setsockopt</code></td><td><a href="migrate//api/sock.html#socket-options"><code>nng_socket_set</code></a></td><td></td></tr>
<tr><td><code>nn_device</code></td><td><a href="migrate//TODO.html"><code>nng_device</code></a></td><td></td></tr>
<tr><td><code>nn_poll</code></td><td>None</td><td>Can be constructed using <code>nng_aio</code>. Few if any applications ever used this API.</td></tr>
<tr><td><code>nn_term</code></td><td><a href="migrate//api/init.html#finalization"><code>nng_fini</code></a></td><td>The <code>nng_fini</code> API can do this, but is not recommended except when debugging memory leaks.</td></tr>
<tr><td><code>nn_get_statistic</code></td><td><a href="migrate//api/stats.html#collecting-a-snapshot"><code>nng_stats_get</code></a></td><td>The statistics in NNG are completely different, with different semantics and no stability guarantees.</td></tr>
<tr><td><code>NN_POLLIN</code></td><td>None</td><td>Used only with <code>nn_poll</code>.</td></tr>
<tr><td><code>NN_POLLOUT</code></td><td>None</td><td>Used only with <code>nn_poll</code>.</td></tr>
<tr><td><code>NN_MSG</code></td><td><a href="migrate//api/sock.html#nng_sendmsg"><code>nng_sendmsg</code></a>, <a href="migrate//api/sock.html#nng_recvmsg"><code>nng_recvmsg</code></a></td><td>There are differences as a separate <a href="migrate//api/msg.html#message-structure"><code>nng_msg</code></a> structure is involved.</td></tr>
<tr><td><code>NN_CMSG_ALIGN</code></td><td>None</td><td></td></tr>
<tr><td><code>NN_CMSG_FIRSTHDR</code></td><td>None</td><td></td></tr>
<tr><td><code>NN_CMSG_NXTHDR</code></td><td>None</td><td></td></tr>
<tr><td><code>NN_CMSG_DATA</code></td><td>None</td><td></td></tr>
<tr><td><code>NN_CMSG_LEN</code></td><td>None</td><td></td></tr>
<tr><td><code>NN_CMSG_SPACE</code></td><td>None</td><td></td></tr>
<tr><td><code>struct nn_iovec</code></td><td><a href="migrate//api/aio.html#scatter-gather-vectors"><code>nng_iov</code></a></td><td></td></tr>
<tr><td><code>struct nn_msghdr</code></td><td><a href="migrate//api/msg.html#message-structure"><code>nng_msg</code></a></td><td></td></tr>
<tr><td><code>struct nn_cmsghdr</code></td><td><a href="migrate//api/msg.html#message-structure"><code>nng_msg</code></a> and <a href="migrate//api/msg.html#message-header"><code>nng_msg_header</code></a></td><td></td></tr>
</tbody></table>
</div>
<h2 id="options"><a class="header" href="#options">Options</a></h2>
<p>The following options are changed.</p>
<div class="table-wrapper"><table><thead><tr><th>Nanomsg Option</th><th>NNG Eqvaivalent</th><th>Notes</th></tr></thead><tbody>
<tr><td><code>NN_LINGER</code></td><td>None</td><td>NNG does not support tuning this.</td></tr>
<tr><td><code>NN_SNDBUF</code></td><td><a href="migrate//api/sock.html#NNG_OPT_SENDBUF"><code>NNG_OPT_SENDBUF</code></a></td><td>NNG value is given in messages, not bytes.</td></tr>
<tr><td><code>NN_RCVBUF</code></td><td><a href="migrate//api/sock.html#NNG_OPT_RECVBUF"><code>NNG_OPT_RECVBUF</code></a></td><td>NNG value is given in messages, not bytes.</td></tr>
<tr><td><code>NN_SNDTIMEO</code></td><td><a href="migrate//api/sock.html#NNG_OPT_SENDTIMEO"><code>NNG_OPT_SENDTIMEO</code></a></td><td></td></tr>
<tr><td><code>NN_RCVTIMEO</code></td><td><a href="migrate//api/sock.html#NNG_OPT_RECVTIMEO"><code>NNG_OPT_RECVTIMEO</code></a></td><td></td></tr>
<tr><td><code>NN_RECONNECT_IVL</code></td><td><a href="migrate//api/sock.html#NNG_OPT_RECONNMINT"><code>NNG_OPT_RECONNMINT</code></a></td><td></td></tr>
<tr><td><code>NN_RECONNECT_IVL_MAX</code></td><td><a href="migrate//api/sock.html#NNG_OPT_RECONNMAXT"><code>NNG_OPT_RECONNMAXT</code></a></td><td></td></tr>
<tr><td><code>NN_SNDPRIO</code></td><td>None</td><td>Not supported in NNG yet.</td></tr>
<tr><td><code>NN_RCVPRIO</code></td><td>None</td><td>Not supported in NNG yet.</td></tr>
<tr><td><code>NN_RCVFD</code></td><td><a href="migrate//api/sock.html#polling-socket-events"><code>nng_socket_get_recv_poll_fd</code></a></td><td>No longer an option, use a function call.</td></tr>
<tr><td><code>NN_SNDFD</code></td><td><a href="migrate//api/sock.html#polling-socket-events"><code>nng_socket_get_send_poll_fd</code></a></td><td>No longer an option, use a function call.</td></tr>
<tr><td><code>NN_DOMAIN</code></td><td>None</td><td>NNG options are not divided by domain or protocol.</td></tr>
<tr><td><code>NN_PROTOCOL</code></td><td><a href="migrate//api/sock.html#socket-identity"><code>nng_socket_proto_id</code></a></td><td>No longer an option. See also <code>nng_socket_proto_name</code>.</td></tr>
<tr><td><code>NN_IPV4ONLY</code></td><td>None</td><td>Use URL such as <code>tcp4://</code> to obtain this functionality.</td></tr>
<tr><td><code>NN_SOCKET_NAME</code></td><td>None</td><td>Removed from NNG.</td></tr>
<tr><td><code>NN_MAXTTL</code></td><td><a href="migrate//api/sock.html#NNG_OPT_MAXTTL"><code>NNG_OPT_MAXTTL</code></a></td><td></td></tr>
<tr><td><code>NN_SUB_SUBSCRIBE</code></td><td><a href="migrate//TODO.html"><code>nng_sub0_socket_subscribe</code></a></td><td>No longer an option, use a function call.</td></tr>
<tr><td><code>NN_SUB_UNSUBSCRIBE</code></td><td><a href="migrate//TODO.html"><code>nng_sub0_socket_unsubscribe</code></a></td><td>No longer an option, use a function call.</td></tr>
</tbody></table>
</div>
<h2 id="error-codes"><a class="header" href="#error-codes">Error Codes</a></h2>
<p>Most of the error codes have similar names in NNG, just prefixed with <code>NNG_</code>.
There are some exceptions. Be aware that the numeric values are <em>not</em> the same.</p>
<div class="table-wrapper"><table><thead><tr><th>Nanomsg Error</th><th>NNG Error</th><th>Notes</th></tr></thead><tbody>
<tr><td><code>EINTR</code></td><td><a href="migrate//api/errors.html#NNG_EINTR"><code>NNG_EINTR</code></a></td><td></td></tr>
<tr><td><code>ENOMEM</code></td><td><a href="migrate//api/errors.html#NNG_ENOMEM"><code>NNG_ENOMEM</code></a></td><td></td></tr>
<tr><td><code>EINVAL</code></td><td><a href="migrate//api/errors.html#NNG_EINVAL"><code>NNG_EINVAL</code></a>, <a href="migrate//api/errors.html#NNG_EADDRINVAL"><code>NNG_EADDRINVAL</code></a>, <a href="migrate//api/errors.html#NNG_EBADTYPE"><code>NNG_EBADTYPE</code></a></td><td>NNG discrimates between different types of errors.</td></tr>
<tr><td><code>EBUSY</code></td><td><a href="migrate//api/errors.html#NNG_EBUSY"><code>NNG_EBUSY</code></a></td><td></td></tr>
<tr><td><code>ETIMEDOUT</code></td><td><a href="migrate//api/errors.html#NNG_ETIMEDOUT"><code>NNG_ETIMEDOUT</code></a></td><td></td></tr>
<tr><td><code>ECONNREFUSED</code></td><td><a href="migrate//api/errors.html#NNG_ECONNREFUSED"><code>NNG_ECONNREFUSED</code></a></td><td></td></tr>
<tr><td><code>EBADF</code></td><td><a href="migrate//api/errors.html#NNG_ECLOSED"><code>NNG_ECLOSED</code></a>, <a href="migrate//api/errors.html#NNG_ECANCELED"><code>NNG_ECANCELED</code></a></td><td>Canceling an operation returns differently than using an invalid or closed object.</td></tr>
<tr><td><code>EAGAIN</code></td><td><a href="migrate//api/errors.html#NNG_EAGAIN"><code>NNG_EAGAIN</code></a></td><td></td></tr>
<tr><td><code>ENOTSUP</code></td><td><a href="migrate//api/errors.html#NNG_ENOTSUP"><code>NNG_ENOTSUP</code></a></td><td></td></tr>
<tr><td><code>EADDRINUSE</code></td><td><a href="migrate//api/errors.html#NNG_EADDRINUSE"><code>NNG_EADDRINUSE</code></a></td><td></td></tr>
<tr><td><code>EFSM</code></td><td><a href="migrate//api/errors.html#NNG_ESTATE"><code>NNG_ESTATE</code></a></td><td>Not a legal POSIX <em>errno</em> value.</td></tr>
<tr><td><code>ENOENT</code></td><td><a href="migrate//api/errors.html#NNG_ENOENT"><code>NNG_ENOENT</code></a></td><td></td></tr>
<tr><td><code>EPROTO</code></td><td><a href="migrate//api/errors.html#NNG_EPROTO"><code>NNG_EPROTO</code></a></td><td></td></tr>
<tr><td><code>EHOSTUNREACH</code></td><td><a href="migrate//api/errors.html#NNG_EUNREACHABLE"><code>NNG_EUNREACHABLE</code></a></td><td></td></tr>
<tr><td><code>EACCCES</code></td><td><a href="migrate//api/errors.html#NNG_EPERM"><code>NNG_EPERM</code></a>, <a href="migrate//api/errors.html#NNG_EWRITEONLY"><code>NNG_EWRITEONLY</code></a>, <a href="migrate//api/errors.html#NNG_EREADONLY"><code>NNG_EREADONLY</code></a>, <a href="migrate//api/errors.html#NNG_ECRYPTO"><code>NNG_ECRYPTO</code></a>, <a href="migrate//api/errors.html#NNG_EPEERAUTH"><code>NNG_EPEERAUTH</code></a></td><td>NNG has more fine grained reasons for access failures.</td></tr>
<tr><td><code>EMSGSIZE</code></td><td><a href="migrate//api/errors.html#NNG_EMSGSIZE"><code>NNG_EMSGSIZE</code></a></td><td></td></tr>
<tr><td><code>ECONNABORTED</code></td><td><a href="migrate//api/errors.html#NNG_ECONNABORTED"><code>NNG_ECONNABORTED</code></a></td><td></td></tr>
<tr><td><code>ECONNRESET</code></td><td><a href="migrate//api/errors.html#NNG_ECONNRESET"><code>NNG_ECONNRESET</code></a></td><td></td></tr>
<tr><td><code>EEXIST</code></td><td><a href="migrate//api/errors.html#NNG_EEXIST"><code>NNG_EEXIST</code></a></td><td></td></tr>
<tr><td><code>EMFILE</code></td><td><a href="migrate//api/errors.html#NNG_ENOFILES"><code>NNG_ENOFILES</code></a></td><td></td></tr>
<tr><td><code>ENOSPC</code></td><td><a href="migrate//api/errors.html#NNG_ENOSPC"><code>NNG_ENOSPC</code></a></td><td></td></tr>
</tbody></table>
</div>
<h2 id="local-addresses-for-dialing"><a class="header" href="#local-addresses-for-dialing">Local Addresses for Dialing</a></h2>
<p>The ability to specify the source address in the URL,to use when
using <code>nn_dial</code> inside the URL is not present in NNG. The correct
way to specify the local address is using the <code>NNG_OPT_LOCADDR</code> option on the
dialer before starting to dial.</p>
<!-- Symbol cross reference -->
<!-- HTTP -->
<!-- Macros -->
<!-- Protocols -->
<!-- Transports -->
<!-- Concept index -->
<div style="break-before: page; page-break-before: always;"></div><h1 id="index"><a class="header" href="#index">Index</a></h1>
<p>ABI, <a href="api/misc.html#a010">1</a><br/>
abstract sockets, <a href="tran/ipc.html#a007">1</a><br/>
<code>abstract://</code>, <a href="tran/ipc.html#a008">1</a><br/>
<code>accept</code>, <a href="api/stream.html#a019">1</a><br/>
<code>AF_UNIX</code>, <a href="api/misc.html#a004">1</a><br/>
aio, <a href="api/aio.html#a002">1</a><br/>
allocations, <a href="api/memory.html#a002">1</a><br/>
application binary interface, <a href="api/misc.html#a011">1</a><br/>
asynchronous I/O, <a href="api/aio.html#a003">1</a><br/>
back-pressure, <a href="proto/index.html#a005">1</a><br/>
backtrace, <a href="proto/rep.html#a004">1</a>, <a href="proto/req.html#a008">2</a>, <a href="proto/respondent.html#a004">3</a>, <a href="proto/surveyor.html#a008">4</a><br/>
best-effort, <a href="proto/bus.html#a003">1</a><br/>
<code>bind</code>, <a href="api/stream.html#a017">1</a><br/>
body, <a href="api/msg.html#a002">1</a><br/>
<em>BUS</em>, <a href="proto/bus.html#a002">1</a><br/>
<em>BUS</em> protocol, <a href="proto/bus.html#a001">1</a><br/>
callback, <a href="api/aio.html#a005">1</a><br/>
clock, <a href="api/time.html#a008">1</a><br/>
command-line arguments, <a href="api/args.html#a002">1</a><br/>
concurrency, <a href="api/thread.html#a002">1</a><br/>
concurrent, <a href="api/ctx.html#a002">1</a><br/>
condition variable, <a href="api/synch.html#a009">1</a><br/>
<code>connect</code>, <a href="api/stream.html#a021">1</a><br/>
connection, <a href="api/pipe.html#a003">1</a><br/>
context, <a href="api/ctx.html#a001">1</a><br/>
CPU-bound, <a href="api/thread.html#a003">1</a><br/>
duration, <a href="api/time.html#a003">1</a><br/>
error message, <a href="api/errors.html#a002">1</a><br/>
event loop, <a href="api/sock.html#a042">1</a><br/>
flow control, <a href="proto/index.html#a006">1</a><br/>
gather, <a href="api/aio.html#a024">1</a><br/>
<code>getopt</code>, <a href="api/args.html#a003">1</a><br/>
half-duplex, <a href="proto/index.html#a004">1</a><br/>
header, <a href="api/msg.html#a003">1</a><br/>
idempotent, <a href="proto/req.html#a004">1</a><br/>
<code>INADDR_ANY</code>, <a href="tran/udp.html#a007">1</a><br/>
<em>inproc</em>, <a href="tran/inproc.html#a002">1</a><br/>
<em>inproc</em> transport, <a href="tran/inproc.html#a001">1</a><br/>
<code>inproc://</code>, <a href="tran/inproc.html#a004">1</a><br/>
intra-process, <a href="tran/inproc.html#a003">1</a><br/>
<em>ipc</em>, <a href="tran/ipc.html#a002">1</a><br/>
<em>ipc</em> transport, <a href="tran/ipc.html#a001">1</a><br/>
<code>ipc://</code>, <a href="tran/ipc.html#a005">1</a><br/>
IPv4, <a href="tran/udp.html#a003">1</a><br/>
IPv6, <a href="tran/udp.html#a004">1</a><br/>
leader election, <a href="proto/surveyor.html#a005">1</a><br/>
<code>listen</code>, <a href="api/stream.html#a018">1</a><br/>
load-balancing, <a href="proto/pull.html#a004">1</a>, <a href="proto/push.html#a004">2</a>, <a href="proto/req.html#a005">3</a><br/>
Log handlers, <a href="api/logging.html#a007">1</a><br/>
memory, <a href="api/memory.html#a001">1</a><br/>
messages, <a href="api/msg.html#a001">1</a><br/>
MTU, <a href="tran/udp.html#a008">1</a><br/>
mutex, <a href="api/synch.html#a002">1</a><br/>
named pipes, <a href="tran/ipc.html#a004">1</a><br/>
<code>NNG_AF_UNSPEC</code>, <a href="tran/socket.html#a004">1</a><br/>
<code>nng_aio</code>, <a href="api/aio.html#a001">1</a><br/>
<code>nng_aio_abort</code>, <a href="api/aio.html#a008">1</a><br/>
<code>nng_aio_alloc</code>, <a href="api/aio.html#a004">1</a><br/>
<code>nng_aio_busy</code>, <a href="api/aio.html#a015">1</a><br/>
<code>nng_aio_cancel</code>, <a href="api/aio.html#a009">1</a><br/>
<code>nng_aio_count</code>, <a href="api/aio.html#a017">1</a><br/>
<code>nng_aio_free</code>, <a href="api/aio.html#a006">1</a><br/>
<code>nng_aio_get_msg</code>, <a href="api/aio.html#a018">1</a><br/>
<code>nng_aio_reap</code>, <a href="api/aio.html#a007">1</a><br/>
<code>nng_aio_result</code>, <a href="api/aio.html#a016">1</a><br/>
<code>nng_aio_set_expire</code>, <a href="api/aio.html#a013">1</a><br/>
<code>nng_aio_set_iov</code>, <a href="api/aio.html#a021">1</a>, <a href="api/aio.html#a025">2</a><br/>
<code>nng_aio_set_msg</code>, <a href="api/aio.html#a019">1</a><br/>
<code>nng_aio_stop</code>, <a href="api/aio.html#a011">1</a><br/>
<code>nng_aio_wait</code>, <a href="api/aio.html#a014">1</a><br/>
<code>nng_alloc</code>, <a href="api/memory.html#a003">1</a><br/>
<code>nng_arg_spec</code>, <a href="api/args.html#a004">1</a><br/>
<code>nng_args_parse</code>, <a href="api/args.html#a001">1</a><br/>
<code>nng_bus0_open</code>, <a href="api/sock.html#a009">1</a><br/>
<code>nng_bus0_open_raw</code>, <a href="api/sock.html#a022">1</a><br/>
<code>nng_clock</code>, <a href="api/time.html#a007">1</a><br/>
<code>nng_ctx</code>, <a href="api/ctx.html#a004">1</a><br/>
<code>nng_ctx_close</code>, <a href="api/ctx.html#a008">1</a><br/>
<code>nng_ctx_id</code>, <a href="api/ctx.html#a007">1</a><br/>
<code>NNG_CTX_INITIALIZER</code>, <a href="api/ctx.html#a005">1</a><br/>
<code>nng_ctx_open</code>, <a href="api/ctx.html#a006">1</a><br/>
<code>nng_ctx_recv</code>, <a href="api/ctx.html#a012">1</a><br/>
<code>nng_ctx_recvmsg</code>, <a href="api/ctx.html#a011">1</a><br/>
<code>nng_ctx_send</code>, <a href="api/ctx.html#a010">1</a><br/>
<code>nng_ctx_sendmsg</code>, <a href="api/ctx.html#a009">1</a><br/>
<code>nng_cv</code>, <a href="api/synch.html#a008">1</a><br/>
<code>nng_cv_alloc</code>, <a href="api/synch.html#a010">1</a><br/>
<code>nng_cv_free</code>, <a href="api/synch.html#a011">1</a><br/>
<code>nng_cv_until</code>, <a href="api/synch.html#a012">1</a><br/>
<code>nng_cv_wait</code>, <a href="api/synch.html#a013">1</a><br/>
<code>nng_cv_wake</code>, <a href="api/synch.html#a014">1</a><br/>
<code>nng_cv_wake1</code>, <a href="api/synch.html#a015">1</a><br/>
<code>nng_duration</code>, <a href="api/time.html#a002">1</a><br/>
<code>NNG_DURATION_DEFAULT</code>, <a href="api/time.html#a005">1</a><br/>
<code>NNG_DURATION_INFINITE</code>, <a href="api/time.html#a004">1</a><br/>
<code>NNG_DURATION_ZERO</code>, <a href="api/time.html#a006">1</a><br/>
<code>NNG_ECANCELED</code>, <a href="api/aio.html#a010">1</a><br/>
<code>nng_fini</code>, <a href="api/init.html#a002">1</a><br/>
<code>NNG_FLAG_NONBLOCK</code>, <a href="api/sock.html#a037">1</a>, <a href="api/sock.html#a041">2</a><br/>
<code>nng_free</code>, <a href="api/memory.html#a004">1</a><br/>
<code>nng_http</code>, <a href="api/http.html#a001">1</a><br/>
<code>nng_http_add_header</code>, <a href="api/http.html#a015">1</a><br/>
<code>nng_http_client</code>, <a href="api/http.html#a029">1</a><br/>
<code>nng_http_client_alloc</code>, <a href="api/http.html#a030">1</a><br/>
<code>nng_http_client_connect</code>, <a href="api/http.html#a035">1</a><br/>
<code>nng_http_client_free</code>, <a href="api/http.html#a031">1</a><br/>
<code>nng_http_client_get_tls</code>, <a href="api/http.html#a032">1</a><br/>
<code>nng_http_client_set_tls</code>, <a href="api/http.html#a033">1</a><br/>
<code>nng_http_close</code>, <a href="api/http.html#a021">1</a><br/>
<code>nng_http_copy_data</code>, <a href="api/http.html#a020">1</a><br/>
<code>nng_http_del_header</code>, <a href="api/http.html#a017">1</a><br/>
<code>nng_http_get_data</code>, <a href="api/http.html#a018">1</a><br/>
<code>nng_http_get_header</code>, <a href="api/http.html#a013">1</a><br/>
<code>nng_http_get_method</code>, <a href="api/http.html#a003">1</a><br/>
<code>nng_http_get_reason</code>, <a href="api/http.html#a011">1</a><br/>
<code>nng_http_get_status</code>, <a href="api/http.html#a009">1</a><br/>
<code>nng_http_get_version</code>, <a href="api/http.html#a008">1</a><br/>
<code>nng_http_handler</code>, <a href="api/http.html#a040">1</a><br/>
<code>nng_http_handler_alloc</code>, <a href="api/http.html#a041">1</a><br/>
<code>nng_http_handler_alloc_directory</code>, <a href="api/http.html#a042">1</a><br/>
<code>nng_http_handler_alloc_file</code>, <a href="api/http.html#a043">1</a><br/>
<code>nng_http_handler_alloc_redirect</code>, <a href="api/http.html#a045">1</a><br/>
<code>nng_http_handler_alloc_static</code>, <a href="api/http.html#a044">1</a><br/>
<code>nng_http_handler_collect_body</code>, <a href="api/http.html#a046">1</a><br/>
<code>nng_http_handler_set_data</code>, <a href="api/http.html#a047">1</a><br/>
<code>nng_http_handler_set_host</code>, <a href="api/http.html#a049">1</a><br/>
<code>nng_http_handler_set_method</code>, <a href="api/http.html#a048">1</a><br/>
<code>nng_http_handler_set_tree</code>, <a href="api/http.html#a050">1</a><br/>
<code>nng_http_hijack</code>, <a href="api/http.html#a027">1</a><br/>
<code>nng_http_next_header</code>, <a href="api/http.html#a014">1</a><br/>
<code>nng_http_peer_cert</code>, <a href="api/http.html#a028">1</a><br/>
<code>nng_http_read</code>, <a href="api/http.html#a023">1</a><br/>
<code>nng_http_read_all</code>, <a href="api/http.html#a025">1</a><br/>
<code>nng_http_read_response</code>, <a href="api/http.html#a037">1</a><br/>
<code>nng_http_reset</code>, <a href="api/http.html#a022">1</a><br/>
<code>nng_http_set_data</code>, <a href="api/http.html#a019">1</a><br/>
<code>nng_http_set_header</code>, <a href="api/http.html#a016">1</a><br/>
<code>nng_http_set_method</code>, <a href="api/http.html#a002">1</a><br/>
<code>nng_http_set_status</code>, <a href="api/http.html#a012">1</a><br/>
<code>nng_http_set_uri</code>, <a href="api/http.html#a004">1</a><br/>
<code>nng_http_set_version</code>, <a href="api/http.html#a007">1</a><br/>
<code>nng_http_status</code>, <a href="api/http.html#a010">1</a><br/>
<code>nng_http_transact</code>, <a href="api/http.html#a038">1</a>, <a href="api/http.html#a039">2</a><br/>
<code>nng_http_write</code>, <a href="api/http.html#a024">1</a><br/>
<code>nng_http_write_all</code>, <a href="api/http.html#a026">1</a><br/>
<code>nng_http_write_request</code>, <a href="api/http.html#a036">1</a><br/>
<code>nng_http_write_response</code>, <a href="api/http.html#a051">1</a><br/>
<code>nng_id_alloc</code>, <a href="api/id_map.html#a006">1</a><br/>
<code>nng_id_get</code>, <a href="api/id_map.html#a005">1</a><br/>
<code>nng_id_map</code>, <a href="api/id_map.html#a001">1</a><br/>
<code>nng_id_map_alloc</code>, <a href="api/id_map.html#a002">1</a><br/>
<code>nng_id_map_free</code>, <a href="api/id_map.html#a003">1</a><br/>
<code>nng_id_map_set</code>, <a href="api/id_map.html#a004">1</a><br/>
<code>nng_id_remove</code>, <a href="api/id_map.html#a007">1</a><br/>
<code>nng_id_visit</code>, <a href="api/id_map.html#a008">1</a><br/>
<code>nng_init</code>, <a href="api/init.html#a001">1</a><br/>
<code>nng_iov</code>, <a href="api/aio.html#a020">1</a>, <a href="api/aio.html#a022">2</a><br/>
<code>nng_log</code>, <a href="api/logging.html#a001">1</a><br/>
<code>nng_log_auth</code>, <a href="api/logging.html#a002">1</a><br/>
<code>nng_log_get_level</code>, <a href="api/logging.html#a005">1</a><br/>
<code>nng_log_level</code>, <a href="api/logging.html#a003">1</a><br/>
<code>nng_log_set_facility</code>, <a href="api/logging.html#a006">1</a><br/>
<code>nng_log_set_level</code>, <a href="api/logging.html#a004">1</a><br/>
<code>nng_log_set_logger</code>, <a href="api/logging.html#a008">1</a><br/>
<code>nng_logger</code>, <a href="api/logging.html#a009">1</a><br/>
<code>NNG_MAJOR_VERSION</code>, <a href="api/misc.html#a007">1</a><br/>
<code>NNG_MINOR_VERSION</code>, <a href="api/misc.html#a008">1</a><br/>
<code>nng_msg</code>, <a href="api/msg.html#a004">1</a><br/>
<code>nng_msg_alloc</code>, <a href="api/msg.html#a005">1</a><br/>
<code>nng_msg_append</code>, <a href="api/msg.html#a014">1</a><br/>
<code>nng_msg_body</code>, <a href="api/msg.html#a011">1</a><br/>
<code>nng_msg_capacity</code>, <a href="api/msg.html#a008">1</a><br/>
<code>nng_msg_chop</code>, <a href="api/msg.html#a016">1</a><br/>
<code>nng_msg_clear</code>, <a href="api/msg.html#a013">1</a><br/>
<code>nng_msg_dup</code>, <a href="api/msg.html#a007">1</a><br/>
<code>nng_msg_free</code>, <a href="api/msg.html#a006">1</a><br/>
<code>nng_msg_get_pipe</code>, <a href="api/msg.html#a026">1</a><br/>
<code>nng_msg_header</code>, <a href="api/msg.html#a018">1</a><br/>
<code>nng_msg_header_append</code>, <a href="api/msg.html#a021">1</a><br/>
<code>nng_msg_header_chop</code>, <a href="api/msg.html#a024">1</a><br/>
<code>nng_msg_header_clear</code>, <a href="api/msg.html#a020">1</a><br/>
<code>nng_msg_header_insert</code>, <a href="api/msg.html#a022">1</a><br/>
<code>nng_msg_header_len</code>, <a href="api/msg.html#a019">1</a><br/>
<code>nng_msg_header_trim</code>, <a href="api/msg.html#a023">1</a><br/>
<code>nng_msg_insert</code>, <a href="api/msg.html#a015">1</a><br/>
<code>nng_msg_len</code>, <a href="api/msg.html#a012">1</a><br/>
<code>nng_msg_realloc</code>, <a href="api/msg.html#a009">1</a><br/>
<code>nng_msg_reserve</code>, <a href="api/msg.html#a010">1</a><br/>
<code>nng_msg_set_pipe</code>, <a href="api/msg.html#a025">1</a><br/>
<code>nng_msg_trim</code>, <a href="api/msg.html#a017">1</a><br/>
<code>nng_msleep</code>, <a href="api/time.html#a009">1</a><br/>
<code>nng_mtx</code>, <a href="api/synch.html#a003">1</a><br/>
<code>nng_mtx_free</code>, <a href="api/synch.html#a005">1</a><br/>
<code>nng_mtx_lock</code>, <a href="api/synch.html#a004">1</a>, <a href="api/synch.html#a006">2</a><br/>
<code>nng_mtx_unlock</code>, <a href="api/synch.html#a007">1</a><br/>
<code>nng_null_logger</code>, <a href="api/logging.html#a010">1</a><br/>
<code>NNG_OPT_LISTEN_FD</code>, <a href="api/stream.html#a061">1</a><br/>
<code>NNG_OPT_REQ_RESENDTICK</code>, <a href="proto/req.html#a007">1</a><br/>
<code>NNG_OPT_REQ_RESENDTIME</code>, <a href="proto/req.html#a006">1</a><br/>
<code>NNG_OPT_SOCKET_FD</code>, <a href="tran/socket.html#a002">1</a><br/>
<code>NNG_OPT_SUB_PREFNEW</code>, <a href="proto/sub.html#a004">1</a><br/>
<code>NNG_OPT_SURVEYOR_SURVEYTIME</code>, <a href="proto/surveyor.html#a007">1</a><br/>
<code>nng_pair0_open</code>, <a href="api/sock.html#a010">1</a><br/>
<code>nng_pair0_open_raw</code>, <a href="api/sock.html#a023">1</a><br/>
<code>nng_pair1_open</code>, <a href="api/sock.html#a011">1</a><br/>
<code>nng_pair1_open_poly</code>, <a href="api/sock.html#a012">1</a><br/>
<code>nng_pair1_open_raw</code>, <a href="api/sock.html#a024">1</a><br/>
<code>NNG_PATCH_VERSION</code>, <a href="api/misc.html#a009">1</a><br/>
<code>nng_pipe</code>, <a href="api/pipe.html#a001">1</a><br/>
<code>nng_pipe_close</code>, <a href="api/pipe.html#a006">1</a><br/>
<code>nng_pipe_dialer</code>, <a href="api/pipe.html#a007">1</a><br/>
<code>NNG_PIPE_EV_ADD_POST</code>, <a href="api/pipe.html#a020">1</a><br/>
<code>NNG_PIPE_EV_ADD_PRE</code>, <a href="api/pipe.html#a019">1</a><br/>
<code>NNG_PIPE_EV_REM_POST</code>, <a href="api/pipe.html#a021">1</a><br/>
<code>nng_pipe_get_addr</code>, <a href="api/pipe.html#a014">1</a><br/>
<code>nng_pipe_get_bool</code>, <a href="api/pipe.html#a010">1</a><br/>
<code>nng_pipe_get_int</code>, <a href="api/pipe.html#a011">1</a><br/>
<code>nng_pipe_get_ms</code>, <a href="api/pipe.html#a012">1</a><br/>
<code>nng_pipe_get_size</code>, <a href="api/pipe.html#a013">1</a><br/>
<code>nng_pipe_get_strcpy</code>, <a href="api/pipe.html#a016">1</a><br/>
<code>nng_pipe_get_strdup</code>, <a href="api/pipe.html#a017">1</a><br/>
<code>nng_pipe_get_string</code>, <a href="api/pipe.html#a015">1</a><br/>
<code>nng_pipe_id</code>, <a href="api/pipe.html#a005">1</a><br/>
<code>NNG_PIPE_INITIALIZER</code>, <a href="api/pipe.html#a004">1</a><br/>
<code>nng_pipe_listener</code>, <a href="api/pipe.html#a008">1</a><br/>
<code>nng_pipe_notify</code>, <a href="api/pipe.html#a018">1</a><br/>
<code>nng_pipe_socket</code>, <a href="api/pipe.html#a009">1</a><br/>
<code>nng_pub0_open</code>, <a href="api/sock.html#a013">1</a><br/>
<code>nng_pub0_open_raw</code>, <a href="api/sock.html#a025">1</a><br/>
<code>nng_pull0_open</code>, <a href="api/sock.html#a014">1</a><br/>
<code>nng_pull0_open_raw</code>, <a href="api/sock.html#a026">1</a><br/>
<code>nng_push0_open</code>, <a href="api/sock.html#a015">1</a><br/>
<code>nng_push0_open_raw</code>, <a href="api/sock.html#a027">1</a><br/>
<code>nng_random</code>, <a href="api/misc.html#a001">1</a><br/>
<code>nng_recv</code>, <a href="api/sock.html#a038">1</a><br/>
<code>nng_recvmsg</code>, <a href="api/sock.html#a039">1</a><br/>
<code>nng_rep0_open</code>, <a href="api/sock.html#a016">1</a><br/>
<code>nng_rep0_open_raw</code>, <a href="api/sock.html#a028">1</a><br/>
<code>nng_req0_open</code>, <a href="api/sock.html#a017">1</a><br/>
<code>nng_req0_open_raw</code>, <a href="api/sock.html#a029">1</a><br/>
<code>nng_respondent0_open</code>, <a href="api/sock.html#a018">1</a><br/>
<code>nng_respondent0_open_raw</code>, <a href="api/sock.html#a030">1</a><br/>
<code>nng_send</code>, <a href="api/sock.html#a034">1</a><br/>
<code>nng_sendmsg</code>, <a href="api/sock.html#a035">1</a><br/>
<code>nng_sleep_aio</code>, <a href="api/time.html#a011">1</a><br/>
<code>nng_socket</code>, <a href="api/sock.html#a002">1</a><br/>
<code>nng_socket_close</code>, <a href="api/sock.html#a033">1</a><br/>
<code>nng_socket_get_recv_poll_fd</code>, <a href="api/sock.html#a043">1</a><br/>
<code>nng_socket_get_send_poll_fd</code>, <a href="api/sock.html#a044">1</a><br/>
<code>nng_socket_id</code>, <a href="api/sock.html#a003">1</a><br/>
<code>nng_socket_pair</code>, <a href="api/misc.html#a003">1</a><br/>
<code>nng_socket_peer_id</code>, <a href="api/sock.html#a005">1</a><br/>
<code>nng_socket_peer_name</code>, <a href="api/sock.html#a007">1</a><br/>
<code>nng_socket_proto_id</code>, <a href="api/sock.html#a004">1</a><br/>
<code>nng_socket_proto_name</code>, <a href="api/sock.html#a006">1</a><br/>
<code>nng_socket_raw</code>, <a href="api/sock.html#a008">1</a><br/>
<code>nng_socket_recv</code>, <a href="api/sock.html#a040">1</a><br/>
<code>nng_socket_send</code>, <a href="api/sock.html#a036">1</a><br/>
<code>nng_stat</code>, <a href="api/stats.html#a002">1</a><br/>
<code>nng_stat_bool</code>, <a href="api/stats.html#a022">1</a><br/>
<code>NNG_STAT_BOOLEAN</code>, <a href="api/stats.html#a019">1</a><br/>
<code>nng_stat_child</code>, <a href="api/stats.html#a005">1</a><br/>
<code>NNG_STAT_COUNTER</code>, <a href="api/stats.html#a016">1</a><br/>
<code>nng_stat_desc</code>, <a href="api/stats.html#a013">1</a><br/>
<code>nng_stat_find</code>, <a href="api/stats.html#a008">1</a><br/>
<code>nng_stat_find_dialer</code>, <a href="api/stats.html#a009">1</a><br/>
<code>nng_stat_find_listener</code>, <a href="api/stats.html#a010">1</a><br/>
<code>nng_stat_find_socket</code>, <a href="api/stats.html#a011">1</a><br/>
<code>NNG_STAT_ID</code>, <a href="api/stats.html#a020">1</a><br/>
<code>NNG_STAT_LEVEL</code>, <a href="api/stats.html#a017">1</a><br/>
<code>nng_stat_name</code>, <a href="api/stats.html#a012">1</a><br/>
<code>nng_stat_next</code>, <a href="api/stats.html#a006">1</a><br/>
<code>nng_stat_parent</code>, <a href="api/stats.html#a007">1</a><br/>
<code>NNG_STAT_SCOPE</code>, <a href="api/stats.html#a015">1</a><br/>
<code>NNG_STAT_STRING</code>, <a href="api/stats.html#a018">1</a><br/>
<code>nng_stat_string</code>, <a href="api/stats.html#a023">1</a><br/>
<code>nng_stat_timestamp</code>, <a href="api/stats.html#a030">1</a><br/>
<code>nng_stat_type</code>, <a href="api/stats.html#a014">1</a><br/>
<code>nng_stat_unit</code>, <a href="api/stats.html#a024">1</a><br/>
<code>nng_stat_value</code>, <a href="api/stats.html#a021">1</a><br/>
<code>nng_stats_free</code>, <a href="api/stats.html#a004">1</a><br/>
<code>nng_stats_get</code>, <a href="api/stats.html#a003">1</a><br/>
<code>nng_stderr_logger</code>, <a href="api/logging.html#a011">1</a><br/>
<code>nng_strdup</code>, <a href="api/memory.html#a005">1</a><br/>
<code>nng_stream</code>, <a href="api/stream.html#a002">1</a><br/>
<code>nng_stream_close</code>, <a href="api/stream.html#a005">1</a><br/>
<code>nng_stream_dialer_alloc</code>, <a href="api/stream.html#a022">1</a><br/>
<code>nng_stream_dialer_alloc_url</code>, <a href="api/stream.html#a023">1</a><br/>
<code>nng_stream_dialer_close</code>, <a href="api/stream.html#a027">1</a><br/>
<code>nng_stream_dialer_dial</code>, <a href="api/stream.html#a033">1</a><br/>
<code>nng_stream_dialer_free</code>, <a href="api/stream.html#a031">1</a><br/>
<code>nng_stream_dialer_get_addr</code>, <a href="api/stream.html#a040">1</a><br/>
<code>nng_stream_dialer_get_bool</code>, <a href="api/stream.html#a036">1</a><br/>
<code>nng_stream_dialer_get_int</code>, <a href="api/stream.html#a037">1</a><br/>
<code>nng_stream_dialer_get_ms</code>, <a href="api/stream.html#a038">1</a><br/>
<code>nng_stream_dialer_get_size</code>, <a href="api/stream.html#a039">1</a><br/>
<code>nng_stream_dialer_get_string</code>, <a href="api/stream.html#a041">1</a><br/>
<code>nng_stream_dialer_get_tls</code>, <a href="api/stream.html#a065">1</a><br/>
<code>nng_stream_dialer_set_addr</code>, <a href="api/stream.html#a046">1</a><br/>
<code>nng_stream_dialer_set_bool</code>, <a href="api/stream.html#a042">1</a><br/>
<code>nng_stream_dialer_set_int</code>, <a href="api/stream.html#a043">1</a><br/>
<code>nng_stream_dialer_set_ms</code>, <a href="api/stream.html#a044">1</a><br/>
<code>nng_stream_dialer_set_size</code>, <a href="api/stream.html#a045">1</a><br/>
<code>nng_stream_dialer_set_string</code>, <a href="api/stream.html#a047">1</a><br/>
<code>nng_stream_dialer_set_tls</code>, <a href="api/stream.html#a063">1</a><br/>
<code>nng_stream_dialer_stop</code>, <a href="api/stream.html#a029">1</a><br/>
<code>nng_stream_free</code>, <a href="api/stream.html#a007">1</a><br/>
<code>nng_stream_get_addr</code>, <a href="api/stream.html#a012">1</a><br/>
<code>nng_stream_get_bool</code>, <a href="api/stream.html#a008">1</a><br/>
<code>nng_stream_get_int</code>, <a href="api/stream.html#a009">1</a><br/>
<code>nng_stream_get_ms</code>, <a href="api/stream.html#a010">1</a><br/>
<code>nng_stream_get_size</code>, <a href="api/stream.html#a011">1</a><br/>
<code>nng_stream_get_string</code>, <a href="api/stream.html#a013">1</a><br/>
<code>nng_stream_listener</code>, <a href="api/stream.html#a015">1</a>, <a href="api/stream.html#a016">2</a><br/>
<code>nng_stream_listener_accept</code>, <a href="api/stream.html#a035">1</a><br/>
<code>nng_stream_listener_alloc</code>, <a href="api/stream.html#a025">1</a><br/>
<code>nng_stream_listener_alloc_url</code>, <a href="api/stream.html#a026">1</a><br/>
<code>nng_stream_listener_close</code>, <a href="api/stream.html#a028">1</a><br/>
<code>nng_stream_listener_free</code>, <a href="api/stream.html#a032">1</a><br/>
<code>nng_stream_listener_get_addr</code>, <a href="api/stream.html#a052">1</a><br/>
<code>nng_stream_listener_get_bool</code>, <a href="api/stream.html#a048">1</a><br/>
<code>nng_stream_listener_get_int</code>, <a href="api/stream.html#a049">1</a><br/>
<code>nng_stream_listener_get_ms</code>, <a href="api/stream.html#a050">1</a><br/>
<code>nng_stream_listener_get_size</code>, <a href="api/stream.html#a051">1</a><br/>
<code>nng_stream_listener_get_string</code>, <a href="api/stream.html#a053">1</a><br/>
<code>nng_stream_listener_get_tls</code>, <a href="api/stream.html#a066">1</a><br/>
<code>nng_stream_listener_listen</code>, <a href="api/stream.html#a034">1</a><br/>
<code>nng_stream_listener_set_addr</code>, <a href="api/stream.html#a058">1</a><br/>
<code>nng_stream_listener_set_bool</code>, <a href="api/stream.html#a054">1</a><br/>
<code>nng_stream_listener_set_int</code>, <a href="api/stream.html#a055">1</a><br/>
<code>nng_stream_listener_set_ms</code>, <a href="api/stream.html#a056">1</a><br/>
<code>nng_stream_listener_set_size</code>, <a href="api/stream.html#a057">1</a><br/>
<code>nng_stream_listener_set_string</code>, <a href="api/stream.html#a059">1</a><br/>
<code>nng_stream_listener_set_tls</code>, <a href="api/stream.html#a064">1</a><br/>
<code>nng_stream_listener_stop</code>, <a href="api/stream.html#a030">1</a><br/>
<code>nng_stream_recv</code>, <a href="api/stream.html#a004">1</a><br/>
<code>nng_stream_send</code>, <a href="api/stream.html#a003">1</a><br/>
<code>nng_stream_stop</code>, <a href="api/stream.html#a006">1</a><br/>
<code>nng_strerror</code>, <a href="api/errors.html#a001">1</a><br/>
<code>nng_strfree</code>, <a href="api/memory.html#a006">1</a><br/>
<code>nng_sub0_open</code>, <a href="api/sock.html#a019">1</a><br/>
<code>nng_sub0_open_raw</code>, <a href="api/sock.html#a031">1</a><br/>
<code>nng_surveyor0_open</code>, <a href="api/sock.html#a020">1</a><br/>
<code>nng_surveyor0_open_raw</code>, <a href="api/sock.html#a032">1</a><br/>
<code>nng_system_logger</code>, <a href="api/logging.html#a012">1</a><br/>
<code>nng_thread</code>, <a href="api/thread.html#a004">1</a><br/>
<code>nng_thread_create</code>, <a href="api/thread.html#a005">1</a><br/>
<code>nng_thread_destroy</code>, <a href="api/thread.html#a006">1</a><br/>
<code>nng_thread_set_name</code>, <a href="api/thread.html#a007">1</a><br/>
<code>nng_time</code>, <a href="api/time.html#a001">1</a><br/>
<code>NNG_UNIT_BYTES</code>, <a href="api/stats.html#a026">1</a><br/>
<code>NNG_UNIT_EVENTS</code>, <a href="api/stats.html#a029">1</a><br/>
<code>NNG_UNIT_MESSAGES</code>, <a href="api/stats.html#a027">1</a><br/>
<code>NNG_UNIT_MILLIS</code>, <a href="api/stats.html#a028">1</a><br/>
<code>NNG_UNIT_NONE</code>, <a href="api/stats.html#a025">1</a><br/>
<code>nng_url_clone</code>, <a href="api/url.html#a012">1</a><br/>
<code>nng_url_fragment</code>, <a href="api/url.html#a009">1</a><br/>
<code>nng_url_free</code>, <a href="api/url.html#a013">1</a><br/>
<code>nng_url_hostname</code>, <a href="api/url.html#a005">1</a><br/>
<code>nng_url_parse</code>, <a href="api/url.html#a011">1</a><br/>
<code>nng_url_path</code>, <a href="api/url.html#a007">1</a><br/>
<code>nng_url_port</code>, <a href="api/url.html#a006">1</a><br/>
<code>nng_url_query</code>, <a href="api/url.html#a008">1</a><br/>
<code>nng_url_resolve_port</code>, <a href="api/url.html#a014">1</a><br/>
<code>nng_url_scheme</code>, <a href="api/url.html#a003">1</a><br/>
<code>nng_url_sprintf</code>, <a href="api/url.html#a010">1</a><br/>
<code>nng_url_userinfo</code>, <a href="api/url.html#a004">1</a><br/>
<code>nng_version</code>, <a href="api/misc.html#a005">1</a><br/>
<code>nni_http_get_uri</code>, <a href="api/http.html#a006">1</a><br/>
<em>PAIR</em>, <a href="proto/pair.html#a002">1</a><br/>
<em>PAIR</em> protocol, <a href="proto/pair.html#a001">1</a><br/>
pipe, <a href="api/pipe.html#a002">1</a><br/>
pipeline pattern, <a href="proto/pull.html#a003">1</a>, <a href="proto/push.html#a003">2</a>, <a href="proto/index.html#a003">3</a><br/>
polyamorous mode, <a href="proto/pair.html#a003">1</a><br/>
port number, <a href="tran/udp.html#a006">1</a><br/>
protocol, <a href="proto/index.html#a001">1</a><br/>
<em>PUB</em>, <a href="proto/pub.html#a002">1</a><br/>
<em>PUB</em> protocol, <a href="proto/pub.html#a001">1</a><br/>
publisher, <a href="proto/pub.html#a003">1</a><br/>
<em>PULL</em>, <a href="proto/pull.html#a002">1</a><br/>
<em>PULL</em> protocol, <a href="proto/pull.html#a001">1</a><br/>
<em>PUSH</em>, <a href="proto/push.html#a002">1</a><br/>
<em>PUSH</em> protocol, <a href="proto/push.html#a001">1</a><br/>
random number, <a href="api/misc.html#a002">1</a><br/>
raw mode, <a href="api/sock.html#a021">1</a><br/>
<em>REP</em>, <a href="proto/rep.html#a002">1</a><br/>
<em>REP</em> protocol, <a href="proto/rep.html#a001">1</a><br/>
<em>REQ</em>, <a href="proto/req.html#a002">1</a><br/>
<em>REQ</em> protocol, <a href="proto/req.html#a001">1</a><br/>
request/reply pattern, <a href="proto/rep.html#a003">1</a>, <a href="proto/req.html#a003">2</a>, <a href="proto/index.html#a002">3</a><br/>
<em>RESPONDENT</em>, <a href="proto/respondent.html#a002">1</a><br/>
<em>RESPONDENT</em> protocol, <a href="proto/respondent.html#a001">1</a><br/>
scatter, <a href="api/aio.html#a023">1</a><br/>
scheduling, <a href="api/time.html#a010">1</a><br/>
service discovery, <a href="proto/surveyor.html#a006">1</a><br/>
<code>socket</code>, <a href="api/stream.html#a020">1</a><br/>
socket, <a href="api/sock.html#a001">1</a><br/>
socket activation, <a href="api/stream.html#a060">1</a><br/>
<em>socket</em> transport, <a href="tran/socket.html#a001">1</a><br/>
<code>socket://</code>, <a href="tran/socket.html#a003">1</a><br/>
state machines, <a href="api/ctx.html#a003">1</a><br/>
statistics, <a href="api/stats.html#a001">1</a><br/>
stream factory, <a href="api/stream.html#a014">1</a><br/>
streams, <a href="api/stream.html#a001">1</a><br/>
<em>SUB</em>, <a href="proto/sub.html#a002">1</a><br/>
<em>SUB</em> protocol, <a href="proto/sub.html#a001">1</a><br/>
subscriber, <a href="proto/sub.html#a003">1</a><br/>
survey pattern, <a href="proto/respondent.html#a003">1</a>, <a href="proto/surveyor.html#a003">2</a><br/>
<em>SURVEYOR</em>, <a href="proto/surveyor.html#a002">1</a><br/>
<em>SURVEYOR</em> protocol, <a href="proto/surveyor.html#a001">1</a><br/>
synchronization primitives, <a href="api/synch.html#a001">1</a><br/>
threads, <a href="api/thread.html#a001">1</a><br/>
thundering herd, <a href="api/synch.html#a016">1</a><br/>
timeout, <a href="api/aio.html#a012">1</a><br/>
TLS, <a href="api/stream.html#a062">1</a>, <a href="api/http.html#a034">2</a><br/>
UDP, <a href="tran/udp.html#a002">1</a><br/>
<em>udp</em> transport, <a href="tran/udp.html#a001">1</a><br/>
<code>udp://</code>, <a href="tran/udp.html#a005">1</a><br/>
Universal Resource Locator, <a href="api/url.html#a001">1</a><br/>
UNIX domain sockets, <a href="tran/ipc.html#a003">1</a><br/>
<code>unix://</code>, <a href="tran/ipc.html#a006">1</a><br/>
URI, <a href="api/http.html#a005">1</a><br/>
URL, <a href="api/url.html#a002">1</a>, <a href="api/stream.html#a024">2</a><br/>
version number, <a href="api/misc.html#a006">1</a><br/>
voting, <a href="proto/surveyor.html#a004">1</a><br/></p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->
        <script src="theme/pagetoc.js"></script>

        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>


    </div>
    </body>
</html>
